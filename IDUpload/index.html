<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ID & Document Upload ‚Ä¢ Barbie's Bail Bonds</title>
  <style>
    :root {
      --brand: #F28C00;
      --brand-dark: #D67700;
      --dark: #111;
      --muted: #666;
      --light-gray: #eee;
      --white: #fff;
      --cream: #fff2d1;
      --black: #000;
      --success: #28a745;
      --error: #dc3545;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      line-height: 1.6;
      color: var(--white);
      background: transparent;
    }

    /* Remove focus outline and prevent text editing cursor */
    * { outline: none; cursor: default; }
    a, button, .btn { cursor: pointer; }

    .container { width: 100%; max-width: 1200px; margin: 0 auto; padding: 40px 20px; }
    .header { text-align: center; margin-bottom: 30px; }
    .title { font-size: 38px; font-weight: 800; margin-bottom: 10px; }
    .subtitle { font-size: 18px; opacity: 0.9; }

    .help-banner {
      background: var(--cream);
      color: var(--black);
      padding: 30px 24px;
      border-radius: 12px;
      margin: 24px 0 34px;
      box-shadow: 0 8px 24px rgba(255, 242, 209, 0.2);
      text-align: center;
    }
    .help-banner .phone { font-size: 28px; font-weight: 800; letter-spacing: .5px; }
    .help-banner .phone a { color: var(--brand); text-decoration: none; }
    .help-banner .phone a:hover { color: var(--brand-dark); }

    .card {
      background: var(--white);
      color: var(--dark);
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 6px 20px rgba(0,0,0,.15);
      margin-bottom: 20px;
    }
    .section-title { font-size: 20px; font-weight: 700; margin-bottom: 14px; }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
    .full { grid-column: 1/-1; }
    label { display: block; font-weight: 600; font-size: 14px; margin-bottom: 6px; }
    input[type="text"], input[type="tel"], input[type="email"], input[type="file"] {
      width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px; font-size: 15px; background:#fff; color:#111;
    }
    .hint { color: #555; font-size: 13px; margin-top: 6px; }

    .dropzone {
      border: 2px dashed #bbb; border-radius: 12px; padding: 18px; text-align: center; background: #fafafa;
      transition: all .15s ease;
      position: relative;
      max-width: 100%;
      margin: 0 auto;
    }
    .dropzone.dragover { border-color: var(--brand); background: #fff8ec; }
    .drop-hint { color:#444; font-size: 14px; }
    .file-list { margin-top: 10px; font-size: 14px; color: #333; }

    .actions { display:flex; gap:10px; justify-content:center; margin-top: 18px; }
    .btn { border:0; border-radius: 10px; padding: 12px 16px; font-weight: 700; }
    .btn-primary { background: var(--black); color:#fff; }
    .btn-primary:hover { background: #333; }
    .btn-ghost { background:#eee; color:#111; }

    .note { font-size: 13px; color: #555; margin-top: 8px; }
    .success { color: var(--success); font-weight: 700; display:none; }
    .error { color: var(--error); font-weight: 700; display:none; }

    /* Language Selection Styles */
    .language-cards {
      display: flex;
      gap: 30px;
      justify-content: space-between;
      flex-wrap: wrap;
      margin-top: 20px;
      width: 100%;
    }

    .language-option {
      background: var(--white);
      border: 1px solid #ddd;
      border-radius: 16px;
      padding: 40px 30px;
      transition: all 0.3s ease;
      text-decoration: none;
      color: var(--dark);
      flex: 1;
      max-width: calc(50% - 15px);
      box-shadow: 0 4px 16px rgba(0,0,0,.08);
      text-align: center;
      cursor: pointer;
    }

    .language-option:hover {
      border-color: var(--brand);
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(242,140,0,.15);
    }

    .language-flag {
      font-size: 48px;
      margin-bottom: 16px;
      display: block;
    }

    .language-name {
      font-size: 22px;
      font-weight: 600;
      color: var(--dark);
      margin-bottom: 8px;
    }

    .language-desc {
      font-size: 14px;
      color: var(--dark);
    }

    @media (max-width: 768px) {
      .title { font-size: 30px; }
      .grid { grid-template-columns: 1fr; }
      
      .language-cards {
        flex-direction: column;
        gap: 20px;
      }
      
      .language-option {
        padding: 30px 80px;
        min-width: 300px;
        max-width: 100%;
      }
    }

    @media (max-width: 480px) {
      .language-option {
        padding: 40px 40px;
        min-width: auto;
        width: 100%;
        height: 280px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }
      
      .language-flag {
        font-size: 40px;
      }
      
      .language-name {
        font-size: 20px;
      }
    }

    /* How to Get to Us Section */
    .location-section {
      padding: 80px 20px;
      background: var(--dark);
      width: 100%;
    }
    
    .location-container {
      max-width: 1200px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 60px;
      align-items: center;
    }
    
    .location-content h2 {
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 20px;
      color: var(--white);
    }
    
    .location-text {
      font-size: 18px;
      line-height: 1.6;
      margin-bottom: 25px;
      color: var(--white);
    }
    
    .location-link {
      color: var(--brand);
      text-decoration: none;
      font-weight: 600;
      font-size: 16px;
    }
    
    .location-link:hover {
      text-decoration: underline;
    }
    
    .location-map {
      background: var(--light-gray);
      border-radius: 12px;
      height: 400px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--muted);
      font-style: italic;
    }

    /* About Us Section */
    .about-section {
      background: var(--white);
      color: var(--dark);
      padding: 60px 20px 30px;
      width: 100%;
    }
    
    .about-container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .about-content {
      font-size: 16px;
      line-height: 1.8;
      margin-bottom: 30px;
    }
    
    .about-contact {
      font-size: 18px;
      font-weight: 600;
      color: var(--brand);
      text-decoration: none;
      white-space: nowrap;
    }
    
    .about-contact:hover {
      color: var(--brand-dark);
    }

    /* Footer Section */
    .footer {
      background: var(--black);
      color: var(--white);
      padding: 20px;
      text-align: center;
      width: 100%;
      font-size: 14px;
    }

    .footer-content {
      max-width: 1200px;
      margin: 0 auto;
    }

    @media (max-width: 768px) {
      .location-container {
        grid-template-columns: 1fr;
        gap: 40px;
      }
      
      .location-section {
        padding: 60px 20px;
      }
    }


    /* File list preview thumbnails */
    .file-item {
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 5px 0;
      padding: 8px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    .file-item:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .file-thumbnail {
      width: 40px;
      height: 40px;
      object-fit: cover;
      border-radius: 6px;
      border: 1px solid #ddd;
    }

    .file-info {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .file-name {
      font-weight: 600;
      font-size: 14px;
      color: #333;
    }

    .file-size {
      font-size: 12px;
      color: #666;
    }

    .remove-file {
      background: var(--error);
      color: white;
      border: none;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 14px;
      margin-left: 10px;
    }

    .remove-file:hover {
      background: #c82333;
    }

    /* Add Document Button Styles */
    .add-doc-button {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      padding: 20px;
      border: 2px dashed #ccc;
      border-radius: 8px;
      background: #f9f9f9;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
    }

    .add-doc-button:hover {
      border-color: #007bff;
      background: #f0f8ff;
    }

    .plus-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: #007bff;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      font-weight: bold;
    }

    .add-doc-button span {
      font-weight: 500;
      color: #333;
    }

    /* Document Type Dropdown */
    .doc-dropdown {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: white;
      border: 1px solid #ddd;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      z-index: 1000;
      display: none;
      max-height: 300px;
      overflow-y: auto;
    }

    .doc-dropdown.show {
      display: block;
    }

    .doc-option {
      padding: 12px 16px;
      cursor: pointer;
      border-bottom: 1px solid #eee;
      transition: background 0.2s ease;
    }

    .doc-option:hover {
      background: #f8f9fa;
    }

    .doc-option:last-child {
      border-bottom: none;
    }

    /* Dynamic Document Section */
    .dynamic-doc-section {
      margin-bottom: 20px;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 15px;
      background: #fafafa;
      position: relative;
    }

    .doc-section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
    }

    .doc-section-title {
      font-weight: 500;
      color: #333;
      flex-grow: 1;
    }

    .remove-doc-btn {
      background: #dc3545;
      color: white;
      border: none;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      transition: background 0.2s ease;
      margin-left: 10px;
    }

    .remove-doc-btn:hover {
      background: #c82333;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="title">Upload ID & Documents</div>
      <div class="subtitle">Securely send your government ID and paperwork to speed up your bond approval.</div>
    </div>

    <!-- Language Selection -->
    <div id="languageSelection" class="language-selection">
      <div class="subtitle" style="text-align: center; margin-bottom: 30px; color: var(--white);">Please select your language to continue</div>
      
      <div class="language-cards">
        <div class="language-option" onclick="showUploadForm('en')">
          <span class="language-flag">üá∫üá∏</span>
          <div class="language-name">English</div>
          <div class="language-desc">Upload documents in English</div>
        </div>
        
        <div class="language-option" onclick="showUploadForm('es')">
          <span class="language-flag">üá™üá∏</span>
          <div class="language-name">Espa√±ol</div>
          <div class="language-desc">Subir documentos en Espa√±ol</div>
        </div>
      </div>
    </div>

    <!-- DEBUG SECTION -->
    <div style="background: rgba(0,0,0,0.9); color: #00ff00; font-family: monospace; font-size: 12px; padding: 10px; max-height: 150px; overflow-y: auto; border: 2px solid #00ff00; border-radius: 8px; margin: 20px 0;">
      <div style="margin-bottom: 5px; font-weight: bold; color: #ffff00;">DEBUG OUTPUT:</div>
      <div id="debugOutput">Ready for debugging...</div>
    </div>

    <!-- English Upload Form -->
    <form id="uploadFormEn" class="upload-form card" style="display: none;" novalidate>
      <div class="section-title">Your Information</div>
      <div class="grid">
        <div>
          <label for="yourNameEn">Your Full Name<span style="color:#dc3545">*</span></label>
          <input id="yourNameEn" name="yourName" required />
        </div>
        <div>
          <label for="yourPhoneEn">Your Phone<span style="color:#dc3545">*</span></label>
          <input id="yourPhoneEn" name="yourPhone" type="tel" inputmode="tel" required />
          <div class="hint">Format: (123) 456-7890 or 123-456-7890</div>
        </div>
        <div>
          <label for="defendantNameEn">Defendant's Name</label>
          <input id="defendantNameEn" name="defendantName" />
        </div>
        <div>
          <label for="caseNumberEn">Case / Booking # (if known)</label>
          <input id="caseNumberEn" name="caseNumber" />
        </div>
      </div>

      <div class="section-title" style="margin-top:18px;">Upload Files</div>
      <div class="grid">
        <div class="full">
          <label for="idFrontEn">Government ID ‚Äì Front</label>
          <div class="dropzone" data-target="idFrontEn" style="position: relative;">
            <div class="drop-hint">Drag & drop image/PDF here or click to select</div>
            <input id="idFrontEn" name="idFront" type="file" accept="image/*,application/pdf" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer;" />
          </div>
          <div class="file-list" id="idFrontEnList"></div>
        </div>
        <div class="full">
          <label for="idBackEn">Government ID ‚Äì Back</label>
          <div class="dropzone" data-target="idBackEn" style="position: relative;">
            <div class="drop-hint">Drag & drop image/PDF here or click to select</div>
            <input id="idBackEn" name="idBack" type="file" accept="image/*,application/pdf" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer;" />
          </div>
          <div class="file-list" id="idBackEnList"></div>
        </div>
        <div class="full" id="additionalDocsContainerEn">
          <div id="addDocButtonEn" class="add-doc-button" onclick="showDocumentDropdown('En')">
            <div class="plus-icon">+</div>
            <span>Add Document</span>
          </div>
        </div>
      </div>

      <div class="actions">
        <button type="button" class="btn btn-ghost" onclick="showLanguageSelection()">Back to Language</button>
        <button type="button" class="btn btn-ghost" id="resetBtnEn">Reset</button>
        <button type="submit" class="btn btn-primary" id="submitBtnEn">Submit</button>
      </div>
      <div class="note" style="text-align:center; margin-top:10px;">
        If the uploader has issues, text photos to <span style="color: var(--brand); white-space: nowrap;">561-247-0018</span> or call <a href="tel:+15612470018" style="color: var(--brand); text-decoration:none; white-space: nowrap;">561-247-0018</a>.
      </div>
      <div class="success" id="successMsgEn" style="text-align:center; margin-top:10px;">Thanks! We received your info. We'll reach out shortly.</div>
      <div class="error" id="errorMsgEn" style="text-align:center; margin-top:10px;">Upload not configured yet. Please text your photos to <span style="white-space: nowrap;">561-247-0018</span>.</div>
    </form>

    <!-- Spanish Upload Form -->
    <form id="uploadFormEs" class="upload-form card" style="display: none;" novalidate>
      <div class="section-title">Su Informaci√≥n</div>
      <div class="grid">
        <div>
          <label for="yourNameEs">Su Nombre Completo<span style="color:#dc3545">*</span></label>
          <input id="yourNameEs" name="yourName" required />
        </div>
        <div>
          <label for="yourPhoneEs">Su Tel√©fono<span style="color:#dc3545">*</span></label>
          <input id="yourPhoneEs" name="yourPhone" type="tel" inputmode="tel" required />
          <div class="hint">Formato: (123) 456-7890 o 123-456-7890</div>
        </div>
        <div>
          <label for="defendantNameEs">Nombre del Detenido</label>
          <input id="defendantNameEs" name="defendantName" />
        </div>
        <div>
          <label for="caseNumberEs">N√∫mero de Caso (si lo conoce)</label>
          <input id="caseNumberEs" name="caseNumber" />
        </div>
      </div>

      <div class="section-title" style="margin-top:18px;">Subir Archivos</div>
      <div class="grid">
        <div class="full">
          <label for="idFrontEs">ID Gubernamental ‚Äì Frente</label>
          <div class="dropzone" data-target="idFrontEs" style="position: relative;">
            <div class="drop-hint">Arrastre y suelte imagen/PDF aqu√≠ o haga clic para seleccionar</div>
            <input id="idFrontEs" name="idFront" type="file" accept="image/*,application/pdf" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer;" />
          </div>
          <div class="file-list" id="idFrontEsList"></div>
        </div>
        <div class="full">
          <label for="idBackEs">ID Gubernamental ‚Äì Reverso</label>
          <div class="dropzone" data-target="idBackEs" style="position: relative;">
            <div class="drop-hint">Arrastre y suelte imagen/PDF aqu√≠ o haga clic para seleccionar</div>
            <input id="idBackEs" name="idBack" type="file" accept="image/*,application/pdf" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer;" />
          </div>
          <div class="file-list" id="idBackEsList"></div>
        </div>
        <div class="full" id="additionalDocsContainerEs">
          <div id="addDocButtonEs" class="add-doc-button" onclick="showDocumentDropdown('Es')">
            <div class="plus-icon">+</div>
            <span>Agregar Documento</span>
          </div>
        </div>
      </div>

      <div class="actions">
        <button type="button" class="btn btn-ghost" onclick="showLanguageSelection()">Volver al Idioma</button>
        <button type="button" class="btn btn-ghost" id="resetBtnEs">Restablecer</button>
        <button type="submit" class="btn btn-primary" id="submitBtnEs">Enviar</button>
      </div>
      <div class="note" style="text-align:center; margin-top:10px;">
        Si el cargador tiene problemas, env√≠e fotos por texto a <span style="color: var(--brand); white-space: nowrap;">561-247-0018</span> o llame al <a href="tel:+15612470018" style="color: var(--brand); text-decoration:none; white-space: nowrap;">561-247-0018</a>.
      </div>
      <div class="success" id="successMsgEs" style="text-align:center; margin-top:10px;">¬°Gracias! Recibimos su informaci√≥n. Nos comunicaremos pronto.</div>
      <div class="error" id="errorMsgEs" style="text-align:center; margin-top:10px;">Carga a√∫n no configurada. Por favor env√≠e sus fotos por texto a <span style="white-space: nowrap;">561-247-0018</span>.</div>
    </form>

  </div>

  <!-- How to Get to Us Section -->
  <section class="location-section">
    <div class="location-container">
      <div class="location-content">
        <h2>How to Get to Us</h2>
        <p class="location-text">Find Barbie's Bail Bonds at 1015 S Congress Ave #1, West Palm Beach. After hours use the front door buzzer or call.</p>
        <a href="https://www.google.com/url?q=https%3A%2F%2Fyoutu.be%2FK6WxiOXH4XQ%3Fsi%3DojtFf2Q4ZpYMpeL9&sa=D" 
           class="location-link" target="_blank">
          Click HERE to watch a video showing how to get to the jail from our office
        </a>
      </div>
      <div class="location-map">
        <a href="https://www.google.com/maps/place/1015+S+Congress+Ave+%231,+West+Palm+Beach,+FL+33406" target="_blank" style="display: block; width: 100%; height: 100%; text-decoration: none;">
          <iframe 
            src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3574.8165962158!2d-80.06932368489576!3d26.368123083362943!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x88d92bdd7f1e7d9f%3A0x6e1b77e1f0b6e2c7!2s1015+S+Congress+Ave+%231%2C+West+Palm+Beach%2C+FL+33406!5e0!3m2!1sen!2sus!4v1693920000000!5m2!1sen!2sus"
            width="100%" 
            height="100%" 
            style="border:0; border-radius: 12px;" 
            allowfullscreen="" 
            loading="lazy" 
            referrerpolicy="no-referrer-when-downgrade"
            title="Barbies Bail Bonds Location">
          </iframe>
        </a>
      </div>
    </div>
  </section>

  <!-- About Us Section -->
  <section class="about-section">
    <div class="about-container">
      <div class="about-content">
        <p>Since 1993, Jerry & Barbie's Bail Bonds has been a trusted, family-owned agency committed to those in need of a bail bondsman in South Florida. We specialize in a wide range of Bail Bonds and in handling Warrants through our Walkthrough Bonds Service. Our service is 100% confidential and you will be dealing with experienced bail bonds agents the entire time.</p>
        
        <p>Our office is located just a few minutes south of the Palm Beach County Jail where we provide service in Palm Beach County, Broward County, Miami Dade County, Martin County, St Lucie County, Indian River County, and most other Florida counties.</p>
        
        <p>If a family member, friend, or any other loved one has been arrested and is in need of a bail bondsman, contact us at <a href="tel:+15612470018" class="about-contact">561-247-0018</a> for immediate service. Our experienced agents are bilingual and available for bail bond service in English and Spanish!</p>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="footer">
    <div class="footer-content">
      <p>Copyright ¬© 2024 Barbie's Bail Bonds | Bail Bond Services</p>
    </div>
  </footer>

  <script>
    // DEBUG FUNCTIONALITY
    let debugOutput = null;
    let debugCount = 0;
    
    function debugLog(message) {
      if (!debugOutput) {
        debugOutput = document.getElementById('debugOutput');
      }
      if (debugOutput) {
        debugCount++;
        const timestamp = new Date().toLocaleTimeString();
        debugOutput.innerHTML += `<div>[${debugCount}] ${timestamp}: ${message}</div>`;
        debugOutput.scrollTop = debugOutput.scrollHeight;
      }
      console.log(message);
    }

    // Global click listener to debug all clicks
    document.addEventListener('click', function(e) {
      debugLog(`CLICK: ${e.target.tagName} ${e.target.className ? '.' + e.target.className.replace(/\s+/g, '.') : ''} ${e.target.id ? '#' + e.target.id : ''}`);
    }, true);

    // Global change listener for form inputs
    document.addEventListener('change', function(e) {
      if (e.target.type === 'file') {
        debugLog(`FILE CHANGE: ${e.target.id} - ${e.target.files.length} files selected`);
      } else {
        debugLog(`INPUT CHANGE: ${e.target.id} = "${e.target.value}"`);
      }
    });

    // Language selection functionality
    function showUploadForm(language) {
      debugLog(`showUploadForm called with: ${language}`);
      // Hide language selection
      document.getElementById('languageSelection').style.display = 'none';
      
      // Hide both forms first
      document.getElementById('uploadFormEn').style.display = 'none';
      document.getElementById('uploadFormEs').style.display = 'none';
      
      // Update page content based on language
      updatePageLanguage(language);
      
      // Show the selected language form
      if (language === 'en') {
        document.getElementById('uploadFormEn').style.display = 'block';
      } else if (language === 'es') {
        document.getElementById('uploadFormEs').style.display = 'block';
      }
    }

    function updatePageLanguage(language) {
      const isSpanish = language === 'es';
      
      // Update page title and header
      document.querySelector('.title').textContent = isSpanish ? 
        'Subir ID y Documentos' : 'Upload ID & Documents';
      document.querySelector('.subtitle').textContent = isSpanish ? 
        'Env√≠e de forma segura su ID gubernamental y documentos para acelerar la aprobaci√≥n de su fianza.' : 
        'Securely send your government ID and paperwork to speed up your bond approval.';
      
      // Update debug panel title
      const debugTitle = document.querySelector('#debugOutput').parentElement.querySelector('div');
      if (debugTitle) {
        debugTitle.textContent = isSpanish ? 'SALIDA DE DEPURACI√ìN:' : 'DEBUG OUTPUT:';
      }
      
      // Update How to Get to Us section
      const locationSection = document.querySelector('.location-content h2');
      const locationText = document.querySelector('.location-text');
      const locationLink = document.querySelector('.location-link');
      
      if (locationSection) {
        locationSection.textContent = isSpanish ? 'C√≥mo Llegar a Nosotros' : 'How to Get to Us';
      }
      if (locationText) {
        locationText.textContent = isSpanish ? 
          'Encuentre Barbie\'s Bail Bonds en 1015 S Congress Ave #1, West Palm Beach. Despu√©s del horario use el timbre de la puerta principal o llame.' :
          'Find Barbie\'s Bail Bonds at 1015 S Congress Ave #1, West Palm Beach. After hours use the front door buzzer or call.';
      }
      if (locationLink) {
        locationLink.textContent = isSpanish ? 
          'Haga clic AQU√ç para ver un video que muestra c√≥mo llegar a la c√°rcel desde nuestra oficina' :
          'Click HERE to watch a video showing how to get to the jail from our office';
      }
      
      // Update About Us section
      const aboutSection = document.querySelector('.about-section');
      if (aboutSection) {
        const aboutContent = aboutSection.querySelector('.about-content');
        if (aboutContent) {
          aboutContent.innerHTML = isSpanish ? 
            `<p>Desde 1993, Jerry & Barbie's Bail Bonds ha sido una agencia familiar confiable comprometida con aquellos que necesitan un fiancista en el Sur de Florida. Nos especializamos en una amplia gama de Fianzas y en manejar √ìrdenes de Arresto a trav√©s de nuestro Servicio de Fianzas de Entrega Voluntaria. Nuestro servicio es 100% confidencial y estar√° tratando con agentes de fianzas experimentados todo el tiempo.</p>
            
            <p>Nuestra oficina est√° ubicada a solo unos minutos al sur de la C√°rcel del Condado de Palm Beach donde proporcionamos servicio en el Condado de Palm Beach, Condado de Broward, Condado de Miami Dade, Condado de Martin, Condado de St Lucie, Condado de Indian River, y la mayor√≠a de otros condados de Florida.</p>
            
            <p>Si un miembro de la familia, amigo, o cualquier otro ser querido ha sido arrestado y necesita un fiancista, cont√°ctenos al <a href="tel:+15612470018" class="about-contact">561-247-0018</a> para servicio inmediato. ¬°Nuestros agentes experimentados son biling√ºes y est√°n disponibles para servicio de fianzas en ingl√©s y espa√±ol!</p>` :
            `<p>Since 1993, Jerry & Barbie's Bail Bonds has been a trusted, family-owned agency committed to those in need of a bail bondsman in South Florida. We specialize in a wide range of Bail Bonds and in handling Warrants through our Walkthrough Bonds Service. Our service is 100% confidential and you will be dealing with experienced bail bonds agents the entire time.</p>
            
            <p>Our office is located just a few minutes south of the Palm Beach County Jail where we provide service in Palm Beach County, Broward County, Miami Dade County, Martin County, St Lucie County, Indian River County, and most other Florida counties.</p>
            
            <p>If a family member, friend, or any other loved one has been arrested and is in need of a bail bondsman, contact us at <a href="tel:+15612470018" class="about-contact">561-247-0018</a> for immediate service. Our experienced agents are bilingual and available for bail bond service in English and Spanish!</p>`;
        }
      }
      
      // Update footer
      const footer = document.querySelector('.footer-content p');
      if (footer) {
        footer.textContent = isSpanish ? 
          'Copyright ¬© 2024 Barbie\'s Bail Bonds | Servicios de Fianzas' :
          'Copyright ¬© 2024 Barbie\'s Bail Bonds | Bail Bond Services';
      }
      
      debugLog(`Page language updated to: ${isSpanish ? 'Spanish' : 'English'}`);
    }
    
    function showLanguageSelection() {
      debugLog('showLanguageSelection called');
      // Hide both forms
      document.getElementById('uploadFormEn').style.display = 'none';
      document.getElementById('uploadFormEs').style.display = 'none';
      
      // Reset page language to English
      updatePageLanguage('en');
      
      // Show language selection
      document.getElementById('languageSelection').style.display = 'block';
      
      // Reset forms
      document.getElementById('uploadFormEn').reset();
      document.getElementById('uploadFormEs').reset();
      
      // Clear file lists
      document.querySelectorAll('.file-list').forEach(el => el.textContent = '');
      
      // Hide messages
      ['successMsgEn', 'errorMsgEn', 'successMsgEs', 'errorMsgEs'].forEach(id => {
        const el = document.getElementById(id);
        if (el) el.style.display = 'none';
      });
      debugLog('Language selection shown, forms reset, page language reset to English');
    }

    // Document types for dropdown
    const documentTypes = {
      'en': [
        'Court Papers',
        'Proof of Income',
        'Property Documents',
        'Bank Statements',
        'Insurance Documents',
        'Employment Documents',
        'Tax Returns',
        'Utility Bills',
        'Other Documents'
      ],
      'es': [
        'Documentos de la Corte',
        'Comprobante de Ingresos',
        'Documentos de Propiedad',
        'Estados de Cuenta Bancarios',
        'Documentos de Seguro',
        'Documentos de Empleo',
        'Declaraciones de Impuestos',
        'Facturas de Servicios',
        'Otros Documentos'
      ]
    };

    // Global function to show document dropdown
    window.showDocumentDropdown = function(suffix) {
      debugLog(`showDocumentDropdown called for ${suffix}`);
      
      const container = document.getElementById(`additionalDocsContainer${suffix}`);
      if (!container) {
        debugLog(`Container not found: additionalDocsContainer${suffix}`);
        return;
      }

      // Remove existing dropdown if any
      const existingDropdown = container.querySelector('.doc-dropdown');
      if (existingDropdown) {
        existingDropdown.remove();
      }

      // Create dropdown
      const dropdown = document.createElement('div');
      dropdown.className = 'doc-dropdown show';
      
      const language = suffix === 'Es' ? 'es' : 'en';
      const types = documentTypes[language];
      
      types.forEach(type => {
        const option = document.createElement('div');
        option.className = 'doc-option';
        option.textContent = type;
        option.onclick = (e) => {
          e.stopPropagation();
          addDocumentSection(suffix, type);
          dropdown.remove();
        };
        dropdown.appendChild(option);
      });

      // Position dropdown relative to button
      const button = document.getElementById(`addDocButton${suffix}`);
      button.appendChild(dropdown);
      
      // Close dropdown when clicking outside
      const closeDropdown = (e) => {
        if (!button.contains(e.target)) {
          dropdown.remove();
          document.removeEventListener('click', closeDropdown);
        }
      };
      
      setTimeout(() => {
        document.addEventListener('click', closeDropdown);
      }, 10);
    };

    // Global function to add document section
    window.addDocumentSection = function(suffix, documentType) {
      debugLog(`addDocumentSection called: ${suffix}, ${documentType}`);
      
      const container = document.getElementById(`additionalDocsContainer${suffix}`);
      const addButton = document.getElementById(`addDocButton${suffix}`);
      
      if (!container || !addButton) {
        debugLog(`Container or button not found for ${suffix}`);
        return;
      }

      // Generate unique ID for this section
      const sectionId = `dynamicDoc${suffix}_${Date.now()}`;
      const inputId = `${sectionId}_input`;
      
      // Create new document section
      const section = document.createElement('div');
      section.className = 'dynamic-doc-section';
      section.innerHTML = `
        <div class="doc-section-header">
          <span class="doc-section-title">${documentType}</span>
          <button type="button" class="remove-doc-btn" onclick="removeDocumentSection('${sectionId}')" title="Remove">‚àí</button>
        </div>
        <div class="dropzone" data-target="${inputId}" style="position: relative;">
          <div class="drop-hint">Drag & drop files here or click to select</div>
          <input id="${inputId}" name="dynamic_docs[]" type="file" accept="image/*,application/pdf" multiple style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer;" />
        </div>
        <div class="file-list" id="${inputId}List"></div>
      `;

      // Insert before the add button
      container.insertBefore(section, addButton);
      
      // Initialize dropzone functionality for the new section using the original system
      setTimeout(() => {
        // Find the new dropzone and initialize it using the original system's method
        const zone = document.querySelector(`.dropzone[data-target="${inputId}"]`);
        const input = document.getElementById(inputId);
        const list = document.getElementById(inputId + 'List');
        
        if (zone && input && list) {
          debugLog(`Using original system initialization for: ${inputId}`);
          
          // Call the original system's dropzone initialization logic
          initializeOriginalDropzone(inputId, zone, input, list);
        } else {
          debugLog(`Failed to find elements for original system init: ${inputId}`);
        }
      }, 50);
      
      debugLog(`Document section added: ${sectionId}`);
    };

    // Global function to remove document section
    window.removeDocumentSection = function(sectionId) {
      debugLog(`removeDocumentSection called: ${sectionId}`);
      
      // Find by the input ID within the section since that contains our sectionId
      const input = document.getElementById(`${sectionId}_input`);
      const section = input?.closest('.dynamic-doc-section');
      
      if (section) {
        section.remove();
        debugLog(`Document section removed: ${sectionId}`);
      } else {
        debugLog(`Could not find section to remove: ${sectionId} (input found: ${!!input})`);
      }
    };

    // Initialize dropzone using the original system's exact logic
    function initializeOriginalDropzone(targetId, zone, input, list) {
      debugLog(`Initializing original dropzone for: ${targetId}`);
      
      // This is the exact logic from the original initializeAllDropzones function
      const updateList = (files) => {
        if (!files || files.length === 0) { 
          // Reset dropzone to original state
          const isSpanish = targetId.endsWith('Es');
          const isMultiple = input.multiple;
          
          let hintText;
          if (isSpanish) {
            hintText = isMultiple ? 'Arrastre y suelte archivos aqu√≠ o haga clic para seleccionar' : 'Arrastre y suelte imagen/PDF aqu√≠ o haga clic para seleccionar';
          } else {
            hintText = isMultiple ? 'Drag & drop files here or click to select' : 'Drag & drop image/PDF here or click to select';
          }
          
          zone.innerHTML = `
            <div class="drop-hint">${hintText}</div>
            <input id="${targetId}" name="${input.name}" type="file" accept="${input.accept}" ${input.multiple ? 'multiple' : ''} style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer;" />
          `;
          
          // Reset zone styles
          zone.style.width = '';
          zone.style.height = '';
          zone.style.padding = '20px';
          zone.style.border = '2px dashed #ccc';
          zone.style.position = 'relative';
          
          list.innerHTML = '';
          debugLog(`${targetId} reset to original state`);
          return;
        }

        // Handle file preview using original system logic
        const file = files[0]; // Take first file
        const isImage = file.type.startsWith('image/');
        const isPdf = file.type === 'application/pdf';
        
        if (isImage) {
          const url = URL.createObjectURL(file);
          zone.innerHTML = `
            <img src="${url}" style="width: 100%; height: 100%; object-fit: contain; border-radius: 8px;" alt="Preview">
            <input id="${targetId}" name="${input.name}" type="file" accept="${input.accept}" ${input.multiple ? 'multiple' : ''} style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer;" />
          `;
          
          list.innerHTML = `
            <div class="file-item">
              <img src="${url}" class="file-thumbnail" alt="Preview">
              <div class="file-info">
                <div class="file-name">${file.name}</div>
                <div class="file-size">${(file.size/1024/1024).toFixed(2)} MB</div>
              </div>
              <button type="button" class="remove-file" onclick="removeFile('${targetId}', 0)" title="Remove">√ó</button>
            </div>
          `;
        } else if (isPdf) {
          zone.innerHTML = `
            <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px; color: white; font-weight: bold; font-size: 18px;">PDF</div>
            <input id="${targetId}" name="${input.name}" type="file" accept="${input.accept}" ${input.multiple ? 'multiple' : ''} style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer;" />
          `;
          
          list.innerHTML = `
            <div class="file-item">
              <div class="pdf-preview">
                <div class="pdf-gradient"></div>
                <div class="pdf-text">PDF</div>
              </div>
              <div class="file-info">
                <div class="file-name">${file.name}</div>
                <div class="file-size">${(file.size/1024/1024).toFixed(2)} MB</div>
              </div>
              <button type="button" class="remove-file" onclick="removeFile('${targetId}', 0)" title="Remove">√ó</button>
            </div>
          `;
        }
        
        debugLog(`FILE INPUT CHANGED: ${targetId} - ${files.length} files`);
        debugLog(`File preview updated for ${targetId}: ${file.name}`);
        
        // Re-attach event listeners to the new input
        const newInput = document.getElementById(targetId);
        if (newInput) {
          newInput.addEventListener('change', () => {
            updateList(newInput.files);
          });
        }
      };

      // Set up initial event listeners
      input.addEventListener('change', () => {
        updateList(input.files);
      });

      // Drag and drop
      zone.addEventListener('dragover', (e) => {
        e.preventDefault();
        zone.classList.add('dragover');
      });

      zone.addEventListener('dragleave', (e) => {
        if (!zone.contains(e.relatedTarget)) {
          zone.classList.remove('dragover');
        }
      });

      zone.addEventListener('drop', (e) => {
        e.preventDefault();
        zone.classList.remove('dragover');
        
        const files = e.dataTransfer.files;
        if (input.multiple) {
          input.files = files;
        } else {
          const dt = new DataTransfer();
          if (files[0]) {
            dt.items.add(files[0]);
          }
          input.files = dt.files;
        }
        updateList(input.files);
      });
      
      debugLog(`Original system dropzone initialized for: ${targetId}`);
    }

    // Update file list display - supports both calling patterns
    function updateList(targetIdOrFiles, filesParam) {
      let targetId, files;
      
      // Handle both calling patterns: updateList(targetId, files) and updateList(files)
      if (typeof targetIdOrFiles === 'string') {
        targetId = targetIdOrFiles;
        files = filesParam;
      } else {
        // This means it was called as updateList(files) - need to find the targetId
        files = targetIdOrFiles;
        // Find the targetId by looking at the currently active input
        const activeInput = document.activeElement;
        if (activeInput && activeInput.type === 'file') {
          targetId = activeInput.id;
        } else {
          debugLog('ERROR: Could not determine targetId for updateList call');
          return;
        }
      }
      
      debugLog(`updateList called for ${targetId} with ${files ? files.length : 0} files`);
      
      const list = document.getElementById(targetId + 'List');
      if (!list) {
        debugLog(`ERROR: Could not find list element: ${targetId}List`);
        return;
      }

      if (!files || files.length === 0) {
        debugLog(`Clearing file list for ${targetId}`);
        list.innerHTML = '';
        return;
      }

      debugLog(`Creating previews for ${files.length} files in ${targetId}`);

      // Create preview elements using the original system's CSS classes
      const previews = Array.from(files).map((file, index) => {
        let thumbnail = '';
        if (file.type.startsWith('image/')) {
          const url = URL.createObjectURL(file);
          thumbnail = `<img src="${url}" class="file-thumbnail" alt="Preview">`;
        } else if (file.type === 'application/pdf') {
          thumbnail = `<div class="pdf-preview">
            <div class="pdf-gradient"></div>
            <div class="pdf-text">PDF</div>
          </div>`;
        }

        return `<div class="file-item">
          ${thumbnail}
          <div class="file-info">
            <div class="file-name">${file.name}</div>
            <div class="file-size">${(file.size/1024/1024).toFixed(2)} MB</div>
          </div>
          <button type="button" class="remove-file" onclick="removeFile('${targetId}', ${index})" title="Remove">√ó</button>
        </div>`;
      }).join('');

      list.innerHTML = previews;
      debugLog(`File previews updated for ${targetId}: ${files[0].name}`);
    }

    // Global function to remove files
    window.removeFile = function(targetId, fileIndex) {
      debugLog(`Removing file ${fileIndex} from ${targetId}`);
      
      // Find the dropzone and list elements
      const zone = document.querySelector(`.dropzone[data-target="${targetId}"]`);
      const list = document.getElementById(targetId + 'List');
      
      if (!zone) {
        debugLog(`Could not find dropzone for ${targetId}`);
        return;
      }
      
      // Create a temporary input to find the original input configuration
      const originalInputs = document.querySelectorAll(`input[id="${targetId}"]`);
      let inputConfig = { accept: 'image/*,application/pdf', multiple: false, name: 'file' };
      
      if (originalInputs.length > 0) {
        const firstInput = originalInputs[0];
        inputConfig.accept = firstInput.accept || inputConfig.accept;
        inputConfig.multiple = firstInput.multiple || false;
        inputConfig.name = firstInput.name || inputConfig.name;
      }
      
      // Clear the files by triggering updateList with empty files
      const mockEvent = {
        target: {
          files: []
        }
      };
      
      // Reset the dropzone using the same logic as updateList
      const isSpanish = targetId.endsWith('Es');
      const isMultiple = inputConfig.multiple;
      
      let hintText;
      if (isSpanish) {
        hintText = isMultiple ? 'Arrastre y suelte archivos aqu√≠ o haga clic para seleccionar' : 'Arrastre y suelte imagen/PDF aqu√≠ o haga clic para seleccionar';
      } else {
        hintText = isMultiple ? 'Drag & drop files here or click to select' : 'Drag & drop image/PDF here or click to select';
      }
      
      zone.innerHTML = `
        <div class="drop-hint">${hintText}</div>
        <input id="${targetId}" name="${inputConfig.name}" type="file" accept="${inputConfig.accept}" ${inputConfig.multiple ? 'multiple' : ''} style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer;" />
      `;
      
      // Reset zone styles
      zone.style.width = '';
      zone.style.height = '';
      zone.style.padding = '18px';
      zone.style.border = '2px dashed #bbb';
      
      // Clear file list
      if (list) {
        list.innerHTML = '';
      }
      
      // Clean up any blob URLs from removed previews
      const existingPreviews = zone.querySelectorAll('img[src^="blob:"], iframe[src^="blob:"]');
      existingPreviews.forEach(preview => {
        if (preview.src && preview.src.startsWith('blob:')) {
          URL.revokeObjectURL(preview.src);
        }
      });
      
      // Re-attach event listeners to the new input immediately
      const newInput = document.getElementById(targetId);
      const newList = document.getElementById(targetId + 'List');
      if (newInput && newList) {
        // Find the dropzone to get the updateList function
        const newZone = document.querySelector(`.dropzone[data-target="${targetId}"]`);
        if (newZone) {
          // Re-create the updateList function for this specific input
          const updateList = (files) => {
            if (!files || files.length === 0) { 
              // Already in reset state, no need to do anything
              return; 
            }
            
            // For now, handle single file (first file if multiple)
            const file = files[0];
            const fileSize = (file.size/1024/1024).toFixed(2);
            const isImage = file.type.startsWith('image/');
            const isPdf = file.type === 'application/pdf';
            
            if (isImage) {
              // Create image preview that fills the dropzone
              const url = URL.createObjectURL(file);
              const img = new Image();
              
              img.onload = function() {
                // Calculate responsive dimensions
                const maxWidth = newZone.clientWidth || 300;
                const maxHeight = Math.min(window.innerHeight * 0.4, 400); // Max 40% of viewport height or 400px
                
                const aspectRatio = img.naturalWidth / img.naturalHeight;
                let displayWidth, displayHeight;
                
                if (aspectRatio > maxWidth / maxHeight) {
                  // Image is wider - fit to width
                  displayWidth = maxWidth;
                  displayHeight = maxWidth / aspectRatio;
                } else {
                  // Image is taller - fit to height
                  displayHeight = Math.min(maxHeight, maxWidth / aspectRatio);
                  displayWidth = displayHeight * aspectRatio;
                }
                
                newZone.style.width = displayWidth + 'px';
                newZone.style.height = displayHeight + 'px';
                newZone.style.padding = '0';
                newZone.style.border = '2px solid var(--brand)';
                newZone.style.position = 'relative';
                newZone.style.overflow = 'hidden';
                
                newZone.innerHTML = `
                  <img id="${targetId}_preview" src="${url}" data-target-id="${targetId}" style="
                    width: 100%; 
                    height: 100%; 
                    object-fit: cover; 
                    cursor: grab;
                    transition: transform 0.3s ease;
                    transform-origin: center center;
                  " alt="Preview" />
                  <input id="${targetId}" name="${newInput.name}" type="file" accept="${newInput.accept}" ${newInput.multiple ? 'multiple' : ''} style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer; z-index: 5;" />
                  <div style="position: absolute; top: 8px; right: 8px; display: flex; gap: 8px; z-index: 10;">
                    <button onclick="event.stopPropagation(); event.preventDefault(); changeFile('${targetId}')" style="
                      background: rgba(0, 123, 255, 0.9); 
                      color: white; 
                      border: none; 
                      border-radius: 50%; 
                      width: 30px; 
                      height: 30px; 
                      font-size: 14px; 
                      cursor: pointer; 
                      display: flex; 
                      align-items: center; 
                      justify-content: center;
                      box-shadow: 0 2px 4px rgba(0,0,0,0.3);
                    " title="Change file">üìÅ</button>
                    <button onclick="event.stopPropagation(); event.preventDefault(); removeFile('${targetId}', 0)" style="
                      background: rgba(220, 53, 69, 0.9); 
                      color: white; 
                      border: none; 
                      border-radius: 50%; 
                      width: 30px; 
                      height: 30px; 
                      font-size: 16px; 
                      cursor: pointer; 
                      display: flex; 
                      align-items: center; 
                      justify-content: center;
                      box-shadow: 0 2px 4px rgba(0,0,0,0.3);
                    " title="Remove file">√ó</button>
                  </div>
                  <div style="
                    position: absolute;
                    bottom: 8px;
                    left: 8px;
                    background: rgba(0,0,0,0.7);
                    color: white;
                    padding: 4px 8px;
                    border-radius: 4px;
                    font-size: 11px;
                    pointer-events: none;
                    z-index: 10;
                  ">Scroll: Zoom ‚Ä¢ Drag: Pan</div>
                `;
                
                // Re-attach change listener after creating new HTML
                const finalInput = document.getElementById(targetId);
                if (finalInput) {
                  finalInput.addEventListener('change', () => {
                    debugLog(`FILE INPUT CHANGED: ${targetId} - ${finalInput.files.length} files`);
                    updateList(finalInput.files);
                  });
                }
                
                URL.revokeObjectURL(url);
              };
              
              img.src = url;
            } else if (isPdf) {
              // Similar code for PDF but I'll keep it shorter
              const fileSize = (file.size/1024/1024).toFixed(2);
              
              const maxWidth = newZone.clientWidth || 300;
              const maxHeight = Math.min(window.innerHeight * 0.4, 200);
              
              newZone.style.width = maxWidth + 'px';
              newZone.style.height = maxHeight + 'px';
              newZone.style.padding = '0';
              newZone.style.border = '2px solid var(--brand)';
              newZone.style.position = 'relative';
              newZone.style.overflow = 'hidden';
              
              newZone.innerHTML = `
                <div id="${targetId}_pdf_preview" style="width: 100%; height: 100%; background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); color: white; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 20px; font-weight: bold; cursor: default; position: relative;">
                  <div style="font-size: 48px; margin-bottom: 8px;">üìÑ</div>
                  <div style="font-size: 16px; margin-bottom: 4px;">PDF Document</div>
                  <div style="font-size: 12px; opacity: 0.9;">${file.name}</div>
                  <div style="font-size: 11px; opacity: 0.7; margin-top: 4px;">${fileSize} MB</div>
                </div>
                <input id="${targetId}" name="${newInput.name}" type="file" accept="${newInput.accept}" ${newInput.multiple ? 'multiple' : ''} style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer; z-index: 5;" />
                <div style="position: absolute; top: 8px; right: 8px; display: flex; gap: 8px; z-index: 10;">
                  <button onclick="event.stopPropagation(); event.preventDefault(); changeFile('${targetId}')" style="background: rgba(0, 123, 255, 0.9); color: white; border: none; border-radius: 50%; width: 30px; height: 30px; font-size: 14px; cursor: pointer; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 4px rgba(0,0,0,0.3);" title="Change file">üìÅ</button>
                  <button onclick="event.stopPropagation(); event.preventDefault(); removeFile('${targetId}', 0)" style="background: rgba(220, 53, 69, 0.9); color: white; border: none; border-radius: 50%; width: 30px; height: 30px; font-size: 16px; cursor: pointer; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 4px rgba(0,0,0,0.3);" title="Remove file">√ó</button>
                </div>
              `;
              
              // Re-attach change listener
              const finalInput = document.getElementById(targetId);
              if (finalInput) {
                finalInput.addEventListener('change', () => {
                  debugLog(`FILE INPUT CHANGED: ${targetId} - ${finalInput.files.length} files`);
                  updateList(finalInput.files);
                });
              }
            }
            
            // Update the file list area below with file info
            newList.innerHTML = `
              <div style="margin-top: 10px; padding: 8px; background: #f0f0f0; border-radius: 6px; color: #333; font-size: 14px;">
                <div style="font-weight: 600;">${file.name}</div>
                <div style="font-size: 12px; color: #666;">${fileSize} MB</div>
              </div>
            `;
            
            debugLog(`File preview updated for ${targetId}: ${file.name}`);
          };
          
          // Attach the change listener
          newInput.addEventListener('change', () => {
            debugLog(`FILE INPUT CHANGED: ${targetId} - ${newInput.files.length} files`);
            updateList(newInput.files);
          });
        }
      }
      
      debugLog(`File removed from ${targetId}. Dropzone reset to original state.`);
    };

    window.changeFile = function(targetId) {
      debugLog(`Changing file for ${targetId}`);
      
      // Get the original input
      const originalInput = document.getElementById(targetId);
      if (!originalInput) {
        debugLog(`Could not find input for ${targetId}`);
        return;
      }
      
      // Clear the current value to allow re-selection of the same file
      originalInput.value = '';
      
      // Create a temporary file input
      const tempInput = document.createElement('input');
      tempInput.type = 'file';
      tempInput.accept = originalInput.accept || 'image/*,application/pdf';
      tempInput.multiple = originalInput.multiple || false;
      tempInput.style.display = 'none';
      
      tempInput.addEventListener('change', function() {
        debugLog(`Temp input changed, ${this.files.length} files selected`);
        if (this.files && this.files.length > 0) {
          // Create a new DataTransfer to copy files
          const dataTransfer = new DataTransfer();
          for (let i = 0; i < this.files.length; i++) {
            dataTransfer.items.add(this.files[i]);
          }
          
          // Set the files on the original input
          originalInput.files = dataTransfer.files;
          
          // Trigger change event
          const changeEvent = new Event('change', { bubbles: true });
          originalInput.dispatchEvent(changeEvent);
          
          debugLog(`Files transferred to original input: ${originalInput.files.length} files`);
        }
        
        // Clean up temp input
        document.body.removeChild(tempInput);
      });
      
      // Add to DOM temporarily and click
      document.body.appendChild(tempInput);
      tempInput.click();
    };

    // Upload functionality - embedded in HTML
    (function () {
      // Initialize when DOM is loaded
      document.addEventListener('DOMContentLoaded', function() {
        debugLog('DOM LOADED - Starting initialization');
        
        // Initialize dropzones for both forms
        initializeAllDropzones();
        
        // Initialize form functionality
        initializeForm('En'); // English form
        initializeForm('Es'); // Spanish form
        
        debugLog('Initialization complete');
      });

      function initializeAllDropzones() {
        // Find all dropzones in the document
        const dropzones = document.querySelectorAll('.dropzone');
        debugLog(`Found ${dropzones.length} dropzones in document`);
        
        dropzones.forEach(zone => {
          const targetId = zone.getAttribute('data-target');
          const input = document.getElementById(targetId);
          const list = document.getElementById(targetId + 'List');
          
          debugLog(`Initializing dropzone: ${targetId}, Input: ${!!input}, List: ${!!list}`);
          
          if (!input || !list) {
            debugLog(`SKIPPING ${targetId} - missing input or list element`);
            return;
          }

          const updateList = (files) => {
            if (!files || files.length === 0) { 
              // Reset dropzone to original state
              const isSpanish = targetId.endsWith('Es');
              const isMultiple = input.multiple;
              
              let hintText;
              if (isSpanish) {
                hintText = isMultiple ? 'Arrastre y suelte archivos aqu√≠ o haga clic para seleccionar' : 'Arrastre y suelte imagen/PDF aqu√≠ o haga clic para seleccionar';
              } else {
                hintText = isMultiple ? 'Drag & drop files here or click to select' : 'Drag & drop image/PDF here or click to select';
              }
              
              zone.innerHTML = `
                <div class="drop-hint">${hintText}</div>
                <input id="${targetId}" name="${input.name}" type="file" accept="${input.accept}" ${input.multiple ? 'multiple' : ''} style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer;" />
              `;
              
              // Reset zone styles
              zone.style.width = '';
              zone.style.height = '';
              zone.style.padding = '18px';
              zone.style.border = '2px dashed #bbb';
              
              // Clear file list
              list.innerHTML = '';
              
              // Re-attach event listeners to the new input
              const newInput = document.getElementById(targetId);
              newInput.addEventListener('change', () => {
                debugLog(`File input changed for: ${targetId}`, 'Files:', newInput.files.length);
                updateList(newInput.files);
              });
              
              debugLog(`File list cleared for ${targetId}`);
              return; 
            }
            
            // For now, handle single file (first file if multiple)
            const file = files[0];
            const fileSize = (file.size/1024/1024).toFixed(2);
            const isImage = file.type.startsWith('image/');
            const isPdf = file.type === 'application/pdf';
            
            if (isImage) {
              // Create image preview that fills the dropzone
              const url = URL.createObjectURL(file);
              const img = new Image();
              
              img.onload = function() {
                // Calculate responsive dimensions
                const maxWidth = zone.clientWidth || 300;
                const maxHeight = Math.min(window.innerHeight * 0.4, 400); // Max 40% of viewport height or 400px
                
                const aspectRatio = img.naturalWidth / img.naturalHeight;
                let displayWidth, displayHeight;
                
                if (aspectRatio > maxWidth / maxHeight) {
                  // Image is wider - fit to width
                  displayWidth = maxWidth;
                  displayHeight = maxWidth / aspectRatio;
                } else {
                  // Image is taller - fit to height
                  displayHeight = Math.min(maxHeight, maxWidth / aspectRatio);
                  displayWidth = displayHeight * aspectRatio;
                }
                
                zone.style.width = displayWidth + 'px';
                zone.style.height = displayHeight + 'px';
                zone.style.padding = '0';
                zone.style.border = '2px solid var(--brand)';
                zone.style.position = 'relative';
                zone.style.overflow = 'hidden';
                
                zone.innerHTML = `
                  <img id="${targetId}_preview" src="${url}" data-target-id="${targetId}" style="
                    width: 100%; 
                    height: 100%; 
                    object-fit: cover; 
                    cursor: grab;
                    transition: transform 0.3s ease;
                    transform-origin: center center;
                  " alt="Preview" />
                  <input id="${targetId}" name="${input.name}" type="file" accept="${input.accept}" ${input.multiple ? 'multiple' : ''} style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer; z-index: 5;" />
                  <div style="position: absolute; top: 8px; right: 8px; display: flex; gap: 8px; z-index: 10;">
                    <button onclick="event.stopPropagation(); event.preventDefault(); changeFile('${targetId}')" style="
                      background: rgba(0, 123, 255, 0.9); 
                      color: white; 
                      border: none; 
                      border-radius: 50%; 
                      width: 30px; 
                      height: 30px; 
                      font-size: 14px; 
                      cursor: pointer; 
                      display: flex; 
                      align-items: center; 
                      justify-content: center;
                      box-shadow: 0 2px 4px rgba(0,0,0,0.3);
                    " title="Change file">üìÅ</button>
                    <button onclick="event.stopPropagation(); event.preventDefault(); removeFile('${targetId}', 0)" style="
                      background: rgba(220, 53, 69, 0.9); 
                      color: white; 
                      border: none; 
                      border-radius: 50%; 
                      width: 30px; 
                      height: 30px; 
                      font-size: 16px; 
                      cursor: pointer; 
                      display: flex; 
                      align-items: center; 
                      justify-content: center;
                      box-shadow: 0 2px 4px rgba(0,0,0,0.3);
                    " title="Remove file">√ó</button>
                  </div>
                  <div style="
                    position: absolute;
                    bottom: 8px;
                    left: 8px;
                    background: rgba(0,0,0,0.7);
                    color: white;
                    padding: 4px 8px;
                    border-radius: 4px;
                    font-size: 11px;
                    pointer-events: none;
                    z-index: 10;
                  ">Scroll: Zoom ‚Ä¢ Drag: Pan</div>
                `;
                
                // Add zoom and pan functionality
                const previewImg = document.getElementById(targetId + '_preview');
                
                // Store the file data on the image element for later use
                previewImg._fileData = file;
                
                // Re-attach change listener to the new input
                const newInput = document.getElementById(targetId);
                if (newInput) {
                  newInput.addEventListener('change', () => {
                    debugLog(`FILE INPUT CHANGED: ${targetId} - ${newInput.files.length} files`);
                    updateList(newInput.files);
                  });
                }
                
                let currentScale = 1;
                let currentTranslateX = 0;
                let currentTranslateY = 0;
                let isDragging = false;
                let startX, startY, initialTranslateX, initialTranslateY;
                
                // Mouse wheel zoom
                previewImg.addEventListener('wheel', (e) => {
                  e.preventDefault();
                  const rect = previewImg.getBoundingClientRect();
                  const centerX = rect.left + rect.width / 2;
                  const centerY = rect.top + rect.height / 2;
                  
                  const zoomFactor = e.deltaY < 0 ? 1.1 : 0.9;
                  const newScale = Math.max(0.5, Math.min(3, currentScale * zoomFactor));
                  
                  if (newScale !== currentScale) {
                    currentScale = newScale;
                    updatePreviewTransform();
                  }
                });
                
                // Mouse drag to pan
                previewImg.addEventListener('mousedown', (e) => {
                  if (currentScale > 1) {
                    isDragging = true;
                    startX = e.clientX;
                    startY = e.clientY;
                    initialTranslateX = currentTranslateX;
                    initialTranslateY = currentTranslateY;
                    previewImg.style.cursor = 'grabbing';
                    e.preventDefault();
                  }
                });
                
                document.addEventListener('mousemove', (e) => {
                  if (isDragging) {
                    currentTranslateX = initialTranslateX + (e.clientX - startX);
                    currentTranslateY = initialTranslateY + (e.clientY - startY);
                    updatePreviewTransform();
                  }
                });
                
                document.addEventListener('mouseup', () => {
                  if (isDragging) {
                    isDragging = false;
                    previewImg.style.cursor = currentScale > 1 ? 'grab' : 'pointer';
                  }
                });
                
                // Double click to reset zoom
                previewImg.addEventListener('dblclick', (e) => {
                  e.preventDefault();
                  currentScale = 1;
                  currentTranslateX = 0;
                  currentTranslateY = 0;
                  updatePreviewTransform();
                  previewImg.style.cursor = 'pointer';
                });
                
                // Single click removed - no modal preview
                
                function updatePreviewTransform() {
                  previewImg.style.transform = `scale(${currentScale}) translate(${currentTranslateX/currentScale}px, ${currentTranslateY/currentScale}px)`;
                  previewImg.style.cursor = currentScale > 1 ? 'grab' : 'pointer';
                }
                
                URL.revokeObjectURL(url); // Clean up
              };
              
              img.src = url;
            } else if (isPdf) {
              // Show PDF info with styled preview (Chrome blocks PDF iframes from blob URLs)
              const fileSize = (file.size/1024/1024).toFixed(2);
              
              // Calculate responsive dimensions
              const maxWidth = zone.clientWidth || 300;
              const maxHeight = Math.min(window.innerHeight * 0.4, 200);
              
              zone.style.width = maxWidth + 'px';
              zone.style.height = maxHeight + 'px';
              zone.style.padding = '0';
              zone.style.border = '2px solid var(--brand)';
              zone.style.position = 'relative';
              zone.style.overflow = 'hidden';
              
              zone.innerHTML = `
                <div id="${targetId}_pdf_preview" style="
                  width: 100%; 
                  height: 100%; 
                  background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
                  color: white; 
                  display: flex; 
                  flex-direction: column;
                  align-items: center; 
                  justify-content: center; 
                  font-size: 20px; 
                  font-weight: bold;
                  cursor: default;
                  position: relative;
                ">
                  <div style="font-size: 48px; margin-bottom: 8px;">üìÑ</div>
                  <div style="font-size: 16px; margin-bottom: 4px;">PDF Document</div>
                  <div style="font-size: 12px; opacity: 0.9;">${file.name}</div>
                  <div style="font-size: 11px; opacity: 0.7; margin-top: 4px;">${fileSize} MB</div>
                </div>
                <input id="${targetId}" name="${input.name}" type="file" accept="${input.accept}" ${input.multiple ? 'multiple' : ''} style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer; z-index: 5;" />
                <div style="position: absolute; top: 8px; right: 8px; display: flex; gap: 8px; z-index: 10;">
                  <button onclick="event.stopPropagation(); event.preventDefault(); changeFile('${targetId}')" style="
                    background: rgba(0, 123, 255, 0.9); 
                    color: white; 
                    border: none; 
                    border-radius: 50%; 
                    width: 30px; 
                    height: 30px; 
                    font-size: 14px; 
                    cursor: pointer; 
                    display: flex; 
                    align-items: center; 
                    justify-content: center;
                    box-shadow: 0 2px 4px rgba(0,0,0,0.3);
                  " title="Change file">üìÅ</button>
                  <button onclick="event.stopPropagation(); event.preventDefault(); removeFile('${targetId}', 0)" style="
                    background: rgba(220, 53, 69, 0.9); 
                    color: white; 
                    border: none; 
                    border-radius: 50%; 
                    width: 30px; 
                    height: 30px; 
                    font-size: 16px; 
                    cursor: pointer; 
                    display: flex; 
                    align-items: center; 
                    justify-content: center;
                    box-shadow: 0 2px 4px rgba(0,0,0,0.3);
                  " title="Remove file">√ó</button>
                </div>
              `;
              
              // Store the file data on the PDF element for later use
              const pdfPreview = document.getElementById(targetId + '_pdf_preview');
              if (pdfPreview) {
                pdfPreview._fileData = file;
              }
              
              // Re-attach change listener to the new input
              const newInput = document.getElementById(targetId);
              if (newInput) {
                newInput.addEventListener('change', () => {
                  debugLog(`FILE INPUT CHANGED: ${targetId} - ${newInput.files.length} files`);
                  updateList(newInput.files);
                });
              }
            }
            
            // Update the file list area below with file info
            list.innerHTML = `
              <div style="margin-top: 10px; padding: 8px; background: #f0f0f0; border-radius: 6px; color: #333; font-size: 14px;">
                <div style="font-weight: 600;">${file.name}</div>
                <div style="font-size: 12px; color: #666;">${fileSize} MB</div>
              </div>
            `;
            
            debugLog(`File preview updated for ${targetId}: ${file.name}`);
          };

          // Simple click handler - no preview modal
          zone.addEventListener('click', (e) => {
            // No preview modal functionality - just log clicks
            if (e.target.classList.contains('preview-thumb') || e.target.id.includes('_preview')) {
              debugLog(`PREVIEW IMAGE CLICKED: ${e.target.id} (no modal)`);
              return;
            }
            debugLog(`DROPZONE CLICKED: ${targetId} (should be handled by file input overlay)`);
          });

          // Drag and drop
          zone.addEventListener('dragover', (e) => {
            e.preventDefault();
            zone.classList.add('dragover');
            debugLog(`DRAGOVER: ${targetId}`);
          });

          zone.addEventListener('dragleave', (e) => {
            // Only remove dragover if we're really leaving the dropzone
            if (!zone.contains(e.relatedTarget)) {
              zone.classList.remove('dragover');
              debugLog(`DRAGLEAVE: ${targetId}`);
            }
          });

          zone.addEventListener('drop', (e) => {
            e.preventDefault();
            zone.classList.remove('dragover');
            
            debugLog(`FILES DROPPED: ${targetId} - ${e.dataTransfer.files.length} files`);
            
            if (input.multiple) {
              input.files = e.dataTransfer.files;
            } else {
              // For single input, take the first file
              const dt = new DataTransfer();
              if (e.dataTransfer.files[0]) {
                dt.items.add(e.dataTransfer.files[0]);
              }
              input.files = dt.files;
            }
            updateList(input.files);
          });

          // File input change
          input.addEventListener('change', () => {
            debugLog(`FILE INPUT CHANGED: ${targetId} - ${input.files.length} files`);
            updateList(input.files);
          });
        });
      }

      function initializeForm(suffix) {
        const form = document.getElementById('uploadForm' + suffix);
        const resetBtn = document.getElementById('resetBtn' + suffix);
        const submitBtn = document.getElementById('submitBtn' + suffix);
        const successMsg = document.getElementById('successMsg' + suffix);
        const errorMsg = document.getElementById('errorMsg' + suffix);

        if (!form) {
          debugLog(`FORM NOT FOUND: uploadForm${suffix}`);
          return;
        }

        debugLog(`INITIALIZING FORM: uploadForm${suffix}`);

        // Simple phone formatting on blur (USA)
        const phone = document.getElementById('yourPhone' + suffix);
        if (phone) {
          phone.addEventListener('blur', () => {
            const digits = (phone.value || '').replace(/[^0-9]/g, '');
            if (digits.length === 10) {
              phone.value = `(${digits.slice(0, 3)}) ${digits.slice(3, 6)}-${digits.slice(6)}`;
            }
          });
        }

        // Reset behavior
        resetBtn?.addEventListener('click', () => {
          form.reset();
          form.querySelectorAll('.file-list').forEach(el => el.textContent = '');
          successMsg.style.display = 'none';
          errorMsg.style.display = 'none';
        });

        // Submit handler - for now just show message that backend isn't configured
        form?.addEventListener('submit', async (e) => {
          e.preventDefault();
          successMsg.style.display = 'none';
          errorMsg.style.display = 'none';

          // Basic required checks
          const requiredIds = ['yourName' + suffix, 'yourPhone' + suffix, 'idFront' + suffix];
          for (const id of requiredIds) {
            const el = document.getElementById(id);
            if (!el || (el.type === 'file' ? el.files.length === 0 : !el.value)) {
              el?.reportValidity?.();
              return;
            }
          }

          // Size/type checks (<=10MB per file)
          const okTypes = ['image/jpeg','image/png','image/webp','image/heic','application/pdf'];
          const fileInputs = ['idFront' + suffix, 'idBack' + suffix, 'docs' + suffix];
          for (const id of fileInputs) {
            const input = document.getElementById(id);
            if (!input || !input.files) continue;
            for (const f of input.files) {
              if (f.size > 10 * 1024 * 1024) { // 10MB
                errorMsg.textContent = suffix === 'Es' 
                  ? `Archivo demasiado grande: ${f.name} (m√°ximo 10MB)`
                  : `File too large: ${f.name} (max 10MB)`;
                errorMsg.style.display = 'block';
                return;
              }
              if (!okTypes.includes(f.type)) {
                errorMsg.textContent = suffix === 'Es'
                  ? `Tipo no soportado: ${f.name}`
                  : `Unsupported type: ${f.name}`;
                errorMsg.style.display = 'block';
                return;
              }
            }
          }

          // For now, just show success message (no backend configured yet)
          errorMsg.textContent = suffix === 'Es'
            ? 'Carga a√∫n no configurada. Por favor env√≠e sus fotos por texto a 561-247-0018.'
            : 'Upload not configured yet. Please text your photos to 561-247-0018.';
          errorMsg.style.display = 'block';
        });
      }
    })();

    // Additional debugging
    window.addEventListener('load', function() {
      console.log('Page fully loaded');
      console.log('Dropzones found:', document.querySelectorAll('.dropzone').length);
      console.log('Upload forms found:', document.querySelectorAll('#uploadFormEn, #uploadFormEs').length);
    });

    // Modal preview functionality removed - keeping only in-box thumbnails
  </script>


</body>
</html>
