<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Upload Documents - Barbie's Bail Bonds</title>
  <style>
    :root {
      --brand: #ff6b00;
      --brand-dark: #e55100;
      --text: #333;
      --bg: #f8f9fa;
      --white: #fff;
      --border: #ddd;
      --success: #28a745;
      --error: #dc3545;
      --shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: system-ui, -apple-system, sans-serif;
      line-height: 1.6;
      color: var(--text);
      background: var(--bg);
      min-height: 100vh;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
      padding: 20px;
      background: var(--white);
      border-radius: 15px;
      box-shadow: var(--shadow);
    }

    .header h1 {
      color: var(--brand);
      font-size: 2.2rem;
      margin-bottom: 10px;
    }

    .header p {
      font-size: 1.1rem;
      color: #666;
    }

    .language-selection {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin: 30px 0;
    }

    .language-btn {
      padding: 15px 30px;
      background: var(--brand);
      color: var(--white);
      border: none;
      border-radius: 10px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-block;
    }

    .language-btn:hover {
      background: var(--brand-dark);
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(255, 107, 0, 0.3);
    }

    .upload-form {
      background: var(--white);
      border-radius: 15px;
      padding: 30px;
      box-shadow: var(--shadow);
      margin-bottom: 30px;
    }

    .section-title {
      font-size: 1.3rem;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid var(--brand);
    }

    .grid {
      display: grid;
      gap: 20px;
      margin-bottom: 25px;
    }

    @media (min-width: 768px) {
      .grid {
        grid-template-columns: 1fr 1fr;
      }
      
      .grid .full {
        grid-column: 1 / -1;
      }
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: var(--text);
    }

    input[type="text"], input[type="tel"], input[type="email"], input[type="file"], input:not([type]), textarea, select {
      width: 100%;
      padding: 12px;
      border: 1px solid var(--border);
      border-radius: 10px;
      font-size: 15px;
      background: var(--white);
      color: var(--text);
      transition: border-color 0.3s ease;
      height: auto;
      min-height: 48px;
    }

    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: var(--brand);
      box-shadow: 0 0 0 3px rgba(255, 107, 0, 0.1);
    }

    .document-section {
      background: #f8f9fa;
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      margin: 15px 0;
      position: relative;
    }

    .document-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .document-title {
      font-weight: 600;
      font-size: 1.1rem;
    }

    .remove-btn {
      background: var(--error);
      color: var(--white);
      border: none;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      cursor: pointer;
      font-size: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }

    .remove-btn:hover {
      background: #c82333;
      transform: scale(1.1);
    }

    .file-upload-area {
      border: 2px dashed var(--border);
      border-radius: 10px;
      padding: 20px;
      text-align: center;
      margin: 10px 0;
      transition: all 0.3s ease;
      background: var(--white);
    }

    .file-upload-area.dragover {
      border-color: var(--brand);
      background: rgba(255, 107, 0, 0.1);
    }

    .file-upload-area p {
      margin: 10px 0;
      color: #666;
    }

    .add-doc-button {
      border: 2px dashed var(--brand);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      background: rgba(255, 107, 0, 0.05);
      margin: 20px 0;
    }

    .add-doc-button:hover {
      background: rgba(255, 107, 0, 0.1);
      border-color: var(--brand-dark);
    }

    .plus-icon {
      font-size: 2rem;
      color: var(--brand);
      margin-bottom: 10px;
    }

    .actions {
      display: flex;
      gap: 15px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .btn {
      padding: 15px 30px;
      border: none;
      border-radius: 10px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-block;
      text-align: center;
      min-width: 140px;
    }

    .btn-primary {
      background: var(--brand);
      color: var(--white);
    }

    .btn-primary:hover:not(:disabled) {
      background: var(--brand-dark);
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(255, 107, 0, 0.3);
    }

    .btn-primary:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }

    .btn-ghost {
      background: transparent;
      color: var(--brand);
      border: 2px solid var(--brand);
    }

    .btn-ghost:hover {
      background: var(--brand);
      color: var(--white);
    }

    .success {
      background: var(--success);
      color: var(--white);
      padding: 15px;
      border-radius: 10px;
      margin: 15px 0;
      font-weight: 500;
      display: none;
    }

    .error {
      background: var(--error);
      color: var(--white);
      padding: 15px;
      border-radius: 10px;
      margin: 15px 0;
      font-weight: 500;
      display: none;
    }

    .note {
      font-size: 0.9rem;
      color: #666;
      text-align: center;
      margin: 15px 0;
    }

    .location-section {
      background: var(--white);
      border-radius: 15px;
      padding: 30px;
      box-shadow: var(--shadow);
      margin: 30px 0;
    }

    .location-container {
      display: grid;
      gap: 30px;
      align-items: center;
    }

    @media (min-width: 768px) {
      .location-container {
        grid-template-columns: 1fr 1fr;
      }
    }

    .location-content h2 {
      color: var(--brand);
      font-size: 1.8rem;
      margin-bottom: 15px;
    }

    .location-text {
      font-size: 1.1rem;
      color: #666;
      margin-bottom: 20px;
    }

    .location-link {
      color: var(--brand);
      text-decoration: none;
      font-weight: 600;
      font-size: 1.1rem;
    }

    .location-link:hover {
      text-decoration: underline;
    }

    .location-map {
      height: 300px;
      border-radius: 12px;
      overflow: hidden;
    }

    .about-section {
      background: var(--white);
      border-radius: 15px;
      padding: 30px;
      box-shadow: var(--shadow);
      margin: 30px 0;
    }

    .about-content p {
      font-size: 1.1rem;
      color: #666;
      margin-bottom: 20px;
      line-height: 1.7;
    }

    .about-contact {
      color: var(--brand);
      text-decoration: none;
      font-weight: 600;
      white-space: nowrap;
    }

    .about-contact:hover {
      text-decoration: underline;
    }

    .footer {
      background: var(--text);
      color: var(--white);
      text-align: center;
      padding: 20px;
      margin-top: 30px;
    }

    .dropdown {
      position: relative;
      display: inline-block;
      width: 100%;
    }

    .dropdown-content {
      display: none;
      position: absolute;
      background: var(--white);
      min-width: 100%;
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
      z-index: 1000;
      border-radius: 8px;
      border: 1px solid var(--border);
      max-height: 200px;
      overflow-y: auto;
    }

    .dropdown-content div {
      padding: 12px 16px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .dropdown-content div:hover {
      background: rgba(255, 107, 0, 0.1);
    }

    .dropdown.active .dropdown-content {
      display: block;
    }

    /* Responsive design */
    @media (max-width: 768px) {
      .container {
        padding: 15px;
      }
      
      .header h1 {
        font-size: 1.8rem;
      }
      
      .language-selection {
        flex-direction: column;
        align-items: center;
      }
      
      .actions {
        flex-direction: column;
      }
      
      .btn {
        width: 100%;
      }
    }

    /* Chatbot Styles */
    .chat-container {
      position: fixed;
      bottom: 20px;
      right: clamp(20px, 5vw, 40px);
      z-index: 1000;
      font-family: system-ui, -apple-system, sans-serif;
    }

    .chat-button {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--brand), var(--brand-dark));
      border: none;
      cursor: pointer;
      box-shadow: 0 4px 20px rgba(255, 107, 0, 0.3);
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    .chat-button:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 25px rgba(255, 107, 0, 0.4);
    }

    .chat-icon {
      font-size: 24px;
      color: white;
    }

    .chat-interface {
      position: absolute;
      bottom: 80px;
      right: 0;
      width: clamp(320px, 90vw, 400px);
      height: 500px;
      background: white;
      border-radius: 16px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
      display: none;
      flex-direction: column;
      overflow: hidden;
      border: 1px solid #e1e8ed;
    }

    .chat-interface.active {
      display: flex;
    }

    .chat-header {
      background: linear-gradient(135deg, var(--brand), var(--brand-dark));
      color: white;
      padding: 16px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .chat-title-area {
      flex-grow: 1;
    }

    .chat-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 2px;
    }

    .chat-subtitle {
      font-size: 12px;
      opacity: 0.9;
    }

    .chat-close {
      background: none;
      border: none;
      color: white;
      font-size: 24px;
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 4px;
      transition: background 0.2s;
    }

    .chat-close:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .chat-messages {
      flex-grow: 1;
      padding: 16px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 12px;
      background: #f8f9fa;
    }

    .welcome-message {
      background: white;
      padding: 16px;
      border-radius: 12px;
      border-left: 4px solid var(--brand);
      font-size: 14px;
      line-height: 1.5;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .message {
      max-width: 85%;
      padding: 12px 16px;
      border-radius: 16px;
      font-size: 14px;
      line-height: 1.4;
      word-wrap: break-word;
    }

    .message.user {
      align-self: flex-end;
      background: var(--brand);
      color: white;
      border-bottom-right-radius: 4px;
    }

    .message.assistant {
      align-self: flex-start;
      background: white;
      color: #333;
      border: 1px solid #e1e8ed;
      border-bottom-left-radius: 4px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .typing-indicator {
      display: none;
      align-self: flex-start;
      background: white;
      padding: 12px 16px;
      border-radius: 16px;
      border-bottom-left-radius: 4px;
      font-size: 14px;
      color: #666;
      border: 1px solid #e1e8ed;
      align-items: center;
      gap: 8px;
    }

    .typing-indicator.show {
      display: flex;
    }

    .typing-dots {
      display: flex;
      gap: 4px;
    }

    .typing-dots span {
      width: 6px;
      height: 6px;
      background: var(--brand);
      border-radius: 50%;
      animation: bounce 1.4s infinite ease-in-out;
    }

    .typing-dots span:nth-child(1) { animation-delay: -0.32s; }
    .typing-dots span:nth-child(2) { animation-delay: -0.16s; }

    @keyframes bounce {
      0%, 80%, 100% { 
        transform: scale(0.8);
        opacity: 0.5;
      } 
      40% { 
        transform: scale(1);
        opacity: 1;
      }
    }

    .chat-input-container {
      padding: 16px;
      border-top: 1px solid #e1e8ed;
      display: flex;
      gap: 8px;
      align-items: center;
      background: white;
    }

    .chat-input {
      flex-grow: 1;
      border: 1px solid #e1e8ed;
      border-radius: 20px;
      padding: 10px 16px;
      font-size: 14px;
      outline: none;
      transition: border-color 0.2s;
      resize: none;
      font-family: inherit;
    }

    .chat-input:focus {
      border-color: var(--brand);
    }

    .chat-send {
      background: var(--brand);
      color: white;
      border: none;
      border-radius: 50%;
      width: 36px;
      height: 36px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      transition: all 0.2s;
    }

    .chat-send:hover:not(:disabled) {
      background: var(--brand-dark);
      transform: scale(1.05);
    }

    .chat-send:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }

    @media (max-width: 768px) {
      .chat-container {
        right: 15px;
        bottom: 15px;
      }
      
      .chat-interface {
        width: calc(100vw - 30px);
        height: 70vh;
        max-height: 500px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    
    <!-- Header -->
    <div class="header">
      <h1>Upload Your Documents</h1>
      <p>Submit required documents for your bail bond application</p>
    </div>

    <!-- Language Selection -->
    <div class="language-selection" id="languageSelection">
      <button class="language-btn" onclick="showUploadForm('en')">
        ðŸ‡ºðŸ‡¸ English
      </button>
      <button class="language-btn" onclick="showUploadForm('es')">
        ðŸ‡ªðŸ‡¸ EspaÃ±ol
      </button>
    </div>

    <!-- English Upload Form -->
    <form id="uploadFormEn" class="upload-form card" style="display: none;" novalidate>
      <div class="section-title">Your Information</div>
      <div class="grid">
        <div>
          <label for="yourNameEn">Your Full Name<span style="color:#dc3545">*</span></label>
          <input id="yourNameEn" name="yourName" required />
        </div>
        <div>
          <label for="yourPhoneEn">Your Phone Number<span style="color:#dc3545">*</span></label>
          <input id="yourPhoneEn" name="yourPhone" type="tel" required />
        </div>
        <div>
          <label for="defendantNameEn">Defendant's Full Name<span style="color:#dc3545">*</span></label>
          <input id="defendantNameEn" name="defendantName" required />
        </div>
        <div>
          <label for="caseNumberEn">Case/Booking Number (if known)</label>
          <input id="caseNumberEn" name="caseNumber" />
        </div>
      </div>

      <div class="section-title" style="margin-top:18px;">Upload Documents</div>
      <div class="grid">
        <div class="full" id="additionalDocsContainerEn">
          <div id="addDocButtonEn" class="add-doc-button" onclick="showDocumentDropdown('En')">
            <div class="plus-icon">+</div>
            <span>Add Document</span>
          </div>
        </div>
      </div>

      <div class="actions">
        <button type="button" class="btn btn-ghost" onclick="showUploadForm('es')">Switch to EspaÃ±ol</button>
        <button type="submit" class="btn btn-primary" id="submitBtnEn">Submit</button>
      </div>
      <div class="note" style="text-align:center; margin-top:10px;">
        If the uploader has issues, text photos to <span style="color: var(--brand); white-space: nowrap;">561-247-0018</span> or call <a href="tel:+15612470018" style="color: var(--brand); text-decoration:none; white-space: nowrap;">561-247-0018</a>.
      </div>
      <div class="success" id="successMsgEn" style="text-align:center; margin-top:10px;">Thanks! We received your info. We'll reach out shortly.</div>
      <div class="error" id="errorMsgEn" style="text-align:center; margin-top:10px;">Upload not configured yet. Please text your photos to <span style="white-space: nowrap;">561-247-0018</span>.</div>
    </form>

    <!-- Spanish Upload Form -->
    <form id="uploadFormEs" class="upload-form card" style="display: none;" novalidate>
      <div class="section-title">Su InformaciÃ³n</div>
      <div class="grid">
        <div>
          <label for="yourNameEs">Su Nombre Completo<span style="color:#dc3545">*</span></label>
          <input id="yourNameEs" name="yourName" required />
        </div>
        <div>
          <label for="yourPhoneEs">Su NÃºmero de TelÃ©fono<span style="color:#dc3545">*</span></label>
          <input id="yourPhoneEs" name="yourPhone" type="tel" required />
        </div>
        <div>
          <label for="defendantNameEs">Nombre Completo del Acusado<span style="color:#dc3545">*</span></label>
          <input id="defendantNameEs" name="defendantName" required />
        </div>
        <div>
          <label for="caseNumberEs">NÃºmero de Caso (si lo conoce)</label>
          <input id="caseNumberEs" name="caseNumber" />
        </div>
      </div>

      <div class="section-title" style="margin-top:18px;">Subir Archivos</div>
      <div class="grid">
        <div class="full" id="additionalDocsContainerEs">
          <div id="addDocButtonEs" class="add-doc-button" onclick="showDocumentDropdown('Es')">
            <div class="plus-icon">+</div>
            <span>Agregar Documento</span>
          </div>
        </div>
      </div>

      <div class="actions">
        <button type="button" class="btn btn-ghost" onclick="showUploadForm('en')">Switch to English</button>
        <button type="submit" class="btn btn-primary" id="submitBtnEs">Enviar</button>
      </div>
      <div class="note" style="text-align:center; margin-top:10px;">
        Si el cargador tiene problemas, envÃ­e fotos por texto a <span style="color: var(--brand); white-space: nowrap;">561-247-0018</span> o llame al <a href="tel:+15612470018" style="color: var(--brand); text-decoration:none; white-space: nowrap;">561-247-0018</a>.
      </div>
      <div class="success" id="successMsgEs" style="text-align:center; margin-top:10px;">Â¡Gracias! Recibimos su informaciÃ³n. Nos comunicaremos pronto.</div>
      <div class="error" id="errorMsgEs" style="text-align:center; margin-top:10px;">Carga aÃºn no configurada. Por favor envÃ­e sus fotos por texto a <span style="white-space: nowrap;">561-247-0018</span>.</div>
    </form>

  </div>

  <!-- How to Get to Us Section -->
  <section class="location-section">
    <div class="location-container">
      <div class="location-content">
        <h2>How to Get to Us</h2>
        <p class="location-text">Find Barbie's Bail Bonds at 1015 S Congress Ave #1, West Palm Beach. After hours use the front door buzzer or call.</p>
        <a href="https://www.google.com/url?q=https%3A%2F%2Fyoutu.be%2FK6WxiOXH4XQ%3Fsi%3DojtFf2Q4ZpYMpeL9&sa=D" 
           class="location-link" target="_blank">
          Click HERE to watch a video showing how to get to the jail from our office
        </a>
      </div>
      <div class="location-map">
        <a href="https://www.google.com/maps/place/1015+S+Congress+Ave+%231,+West+Palm+Beach,+FL+33406" target="_blank" style="display: block; width: 100%; height: 100%; text-decoration: none;">
          <iframe 
            src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3574.8165962158!2d-80.06932368489576!3d26.368123083362943!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x88d92bdd7f1e7d9f%3A0x6e1b77e1f0b6e2c7!2s1015+S+Congress+Ave+%231%2C+West+Palm+Beach%2C+FL+33406!5e0!3m2!1sen!2sus!4v1693920000000!5m2!1sen!2sus"
            width="100%" 
            height="100%" 
            style="border:0; border-radius: 12px;" 
            allowfullscreen="" 
            loading="lazy" 
            referrerpolicy="no-referrer-when-downgrade"
            title="Barbies Bail Bonds Location">
          </iframe>
        </a>
      </div>
    </div>
  </section>

  <!-- About Us Section -->
  <section class="about-section">
    <div class="about-container">
      <div class="about-content">
        <p>Since 1993, Jerry & Barbie's Bail Bonds has been a trusted, family-owned agency committed to those in need of a bail bondsman in South Florida. We specialize in a wide range of Bail Bonds and in handling Warrants through our Walkthrough Bonds Service. Our service is 100% confidential and you will be dealing with experienced bail bonds agents the entire time.</p>
        
        <p>Our office is located just a few minutes south of the Palm Beach County Jail where we provide service in Palm Beach County, Broward County, Miami Dade County, Martin County, St Lucie County, Indian River County, and most other Florida counties.</p>
        
        <p>If a family member, friend, or any other loved one has been arrested and is in need of a bail bondsman, contact us at <a href="tel:+15612470018" class="about-contact">561-247-0018</a> for immediate service. Our experienced agents are bilingual and available for bail bond service in English and Spanish!</p>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="footer">
    <div class="footer-content">
      <p>Copyright Â© 2024 Barbie's Bail Bonds | Bail Bond Services</p>
    </div>
  </footer>

  <script>
    // ======================================
    // GOOGLE APPS SCRIPT CONFIGURATION
    // ======================================
    // DEPLOYMENT URL CONFIGURED
    const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxHNm5r1gnvFbCSQgrGY7NM1EZSuLMATyxTVncn6Q86bHiHCasSvPvypfWn3rbUHsVR/exec';
    // ======================================

    // Language selection functionality
    function showUploadForm(language) {
      // Hide language selection
      document.getElementById('languageSelection').style.display = 'none';
      
      // Hide both forms first
      document.getElementById('uploadFormEn').style.display = 'none';
      document.getElementById('uploadFormEs').style.display = 'none';
      
      // Update page content based on language
      updatePageLanguage(language);
      
      // Show the selected language form
      if (language === 'en') {
        document.getElementById('uploadFormEn').style.display = 'block';
      } else if (language === 'es') {
        document.getElementById('uploadFormEs').style.display = 'block';
      }
    }

    function updatePageLanguage(language) {
      const header = document.querySelector('.header');
      
      if (language === 'es') {
        header.innerHTML = `
          <h1>Subir Sus Documentos</h1>
          <p>EnvÃ­e los documentos requeridos para su solicitud de fianza</p>
        `;
      } else {
        header.innerHTML = `
          <h1>Upload Your Documents</h1>
          <p>Submit required documents for your bail bond application</p>
        `;
      }
    }

    // Document management functionality
    function showDocumentDropdown(suffix) {
      const container = document.getElementById('additionalDocsContainer' + suffix);
      const addButton = document.getElementById('addDocButton' + suffix);
      
      // Create document section
      const section = document.createElement('div');
      section.className = 'document-section';
      
      const sectionId = 'docSection' + Date.now() + suffix;
      section.id = sectionId;
      
      // Document type options
      const documentTypes = ['Government ID', 'Proof of Address', 'Proof of Employment', 'Other'];
      const documentTypesEs = ['IdentificaciÃ³n Gubernamental', 'Comprobante de Domicilio', 'Comprobante de Empleo', 'Otro'];
      
      const types = suffix === 'Es' ? documentTypesEs : documentTypes;
      const typeValues = documentTypes; // Always use English values for backend
      
      let optionsHtml = '';
      types.forEach((type, index) => {
        optionsHtml += `<option value="${typeValues[index]}">${type}</option>`;
      });
      
      const isSpanish = suffix === 'Es';
      
      section.innerHTML = `
        <div class="document-header">
          <div class="document-title">${isSpanish ? 'Tipo de Documento' : 'Document Type'}</div>
          <button type="button" class="remove-btn" onclick="removeDocumentSection('${sectionId}')">Ã—</button>
        </div>
        
        <select onchange="handleDocumentTypeChange(this, '${sectionId}')">
          <option value="">${isSpanish ? 'Seleccionar tipo...' : 'Select type...'}</option>
          ${optionsHtml}
        </select>
        
        <div class="upload-areas" id="uploadAreas_${sectionId}">
          <!-- Upload areas will be inserted here based on selection -->
        </div>
      `;
      
      // Insert before the add button
      container.insertBefore(section, addButton);
    }

    function handleDocumentTypeChange(selectElement, sectionId) {
      const uploadAreas = document.getElementById('uploadAreas_' + sectionId);
      const docType = selectElement.value;
      const isSpanish = sectionId.includes('Es');
      
      if (!docType) {
        uploadAreas.innerHTML = '';
        return;
      }
      
      if (docType === 'Government ID') {
        // Special handling for Government ID - front and back
        uploadAreas.innerHTML = `
          <div style="display: grid; gap: 15px; margin-top: 15px;">
            <div>
              <label>${isSpanish ? 'Frente de la ID' : 'ID Front'}<span style="color:#dc3545">*</span></label>
              <div class="file-upload-area">
                <input type="file" accept="image/*,application/pdf" data-type="front" onchange="handleFileSelect(this)" required />
                <p>${isSpanish ? 'Arrastre o haga clic para subir la parte frontal de la ID' : 'Drag or click to upload ID front'}</p>
              </div>
            </div>
            <div>
              <label>${isSpanish ? 'Parte Trasera de la ID' : 'ID Back'}</label>
              <div class="file-upload-area">
                <input type="file" accept="image/*,application/pdf" data-type="back" onchange="handleFileSelect(this)" />
                <p>${isSpanish ? 'Arrastre o haga clic para subir la parte trasera de la ID' : 'Drag or click to upload ID back'}</p>
              </div>
            </div>
          </div>
        `;
      } else {
        // Single file upload for other document types
        uploadAreas.innerHTML = `
          <div style="margin-top: 15px;">
            <label>${docType}<span style="color:#dc3545">*</span></label>
            <div class="file-upload-area">
              <input type="file" accept="image/*,application/pdf" onchange="handleFileSelect(this)" required />
              <p>${isSpanish ? 'Arrastre o haga clic para subir archivo' : 'Drag or click to upload file'}</p>
            </div>
          </div>
        `;
      }
    }

    function handleFileSelect(input) {
      if (input.files && input.files[0]) {
        const file = input.files[0];
        const uploadArea = input.closest('.file-upload-area');
        const existingPreview = uploadArea.querySelector('.file-preview');
        
        if (existingPreview) {
          existingPreview.remove();
        }
        
        const preview = document.createElement('div');
        preview.className = 'file-preview';
        preview.style.cssText = `
          margin-top: 10px; 
          padding: 10px; 
          background: #e8f5e8; 
          border: 1px solid #4caf50; 
          border-radius: 8px; 
          font-size: 14px;
        `;
        preview.innerHTML = `âœ“ ${file.name} (${Math.round(file.size/1024)} KB)`;
        
        uploadArea.appendChild(preview);
      }
    }

    function removeDocumentSection(sectionId) {
      const section = document.getElementById(sectionId);
      if (section) {
        section.remove();
      }
    }

    // Form submission functionality
    (() => {
      ['En', 'Es'].forEach(suffix => {
        const form = document.getElementById('uploadForm' + suffix);
        const submitBtn = document.getElementById('submitBtn' + suffix);
        const successMsg = document.getElementById('successMsg' + suffix);
        const errorMsg = document.getElementById('errorMsg' + suffix);

        if (!form) {
          return;
        }

        // Simple phone formatting on blur (USA)
        const phone = document.getElementById('yourPhone' + suffix);
        if (phone) {
          phone.addEventListener('blur', () => {
            const digits = (phone.value || '').replace(/[^0-9]/g, '');
            if (digits.length === 10) {
              phone.value = `(${digits.slice(0, 3)}) ${digits.slice(3, 6)}-${digits.slice(6)}`;
            }
          });
        }

        // Submit handler
        form?.addEventListener('submit', async (e) => {
          e.preventDefault();
          successMsg.style.display = 'none';
          errorMsg.style.display = 'none';

          // Basic required checks
          const requiredFields = ['yourName' + suffix, 'yourPhone' + suffix];
          for (const id of requiredFields) {
            const el = document.getElementById(id);
            if (!el || !el.value.trim()) {
              el?.reportValidity?.();
              return;
            }
          }

          // Check that at least one document section has files
          const documentSections = form.querySelectorAll('.document-section');
          let hasFiles = false;
          
          for (const section of documentSections) {
            const fileInputs = section.querySelectorAll('input[type="file"]');
            for (const input of fileInputs) {
              if (input.files && input.files.length > 0) {
                hasFiles = true;
                break;
              }
            }
            if (hasFiles) break;
          }
          
          if (!hasFiles) {
            errorMsg.textContent = suffix === 'Es'
              ? 'Por favor suba al menos un documento.'
              : 'Please upload at least one document.';
            errorMsg.style.display = 'block';
            return;
          }

          // Size/type checks (<=10MB per file)
          const okTypes = ['image/jpeg','image/png','image/webp','image/heic','application/pdf'];
          const allFileInputs = form.querySelectorAll('input[type="file"]');
          for (const input of allFileInputs) {
            if (!input.files) continue;
            for (const f of input.files) {
              if (f.size > 10 * 1024 * 1024) { // 10MB
                errorMsg.textContent = suffix === 'Es' 
                  ? `Archivo demasiado grande: ${f.name} (mÃ¡ximo 10MB)`
                  : `File too large: ${f.name} (max 10MB)`;
                errorMsg.style.display = 'block';
                return;
              }
              if (!okTypes.includes(f.type)) {
                errorMsg.textContent = suffix === 'Es'
                  ? `Tipo no soportado: ${f.name}`
                  : `Unsupported type: ${f.name}`;
                errorMsg.style.display = 'block';
                return;
              }
            }
          }

          // Submit to Google Apps Script
          try {
            if (submitBtn) {
              submitBtn.disabled = true;
              submitBtn.textContent = suffix === 'Es' ? 'Enviando...' : 'Submitting...';
            }

            // Create FormData object
            const formData = new FormData();
            
            // Add basic form fields
            formData.append('yourName', document.getElementById('yourName' + suffix)?.value || '');
            formData.append('yourPhone', document.getElementById('yourPhone' + suffix)?.value || '');
            formData.append('defendantName', document.getElementById('defendantName' + suffix)?.value || '');
            formData.append('caseNumber', document.getElementById('caseNumber' + suffix)?.value || '');
            
            // Add documents from all sections
            documentSections.forEach((section, index) => {
              const typeSelect = section.querySelector('select');
              if (typeSelect && typeSelect.value) {
                const docType = typeSelect.value;
                formData.append(`documentType_${index}`, docType);
                
                if (docType === 'Government ID') {
                  // Handle front/back for Government ID
                  const frontInput = section.querySelector('input[data-type="front"]');
                  const backInput = section.querySelector('input[data-type="back"]');
                  
                  if (frontInput?.files[0]) {
                    formData.append(`document_${index}_front_input`, frontInput.files[0]);
                  }
                  if (backInput?.files[0]) {
                    formData.append(`document_${index}_back_input`, backInput.files[0]);
                  }
                } else {
                  // Handle single file for other document types
                  const fileInput = section.querySelector('input[type="file"]:not([data-type])');
                  if (fileInput?.files[0]) {
                    formData.append(`document_${index}_input`, fileInput.files[0]);
                  }
                }
              }
            });
            
            if (APPS_SCRIPT_URL === 'PASTE_APPS_SCRIPT_URL_HERE') {
              throw new Error('Apps Script URL not configured yet');
            }
            
            const response = await fetch(APPS_SCRIPT_URL, {
              method: 'POST',
              body: formData
            });
            
            const result = await response.json();
            
            if (result.success) {
              successMsg.style.display = 'block';
              form.reset();
              // Reset dynamic sections to initial state
              const additionalSections = form.querySelectorAll('.document-section');
              additionalSections.forEach(section => section.remove());
            } else {
              throw new Error(result.message || 'Upload failed');
            }
            
          } catch (error) {
            console.error('Upload error:', error);
            if (error.message === 'Apps Script URL not configured yet') {
              errorMsg.textContent = suffix === 'Es'
                ? 'Carga aÃºn no configurada. Por favor envÃ­e sus fotos por texto a 561-247-0018.'
                : 'Upload not configured yet. Please text your photos to 561-247-0018.';
            } else {
              errorMsg.textContent = suffix === 'Es'
                ? 'Error al subir archivos. Por favor envÃ­e sus fotos por texto a 561-247-0018.'
                : 'Upload error. Please text your photos to 561-247-0018.';
            }
            errorMsg.style.display = 'block';
          } finally {
            // Re-enable submit button
            if (submitBtn) {
              submitBtn.disabled = false;
              submitBtn.textContent = suffix === 'Es' ? 'Enviar' : 'Submit';
            }
          }
        });
      });
    })();

    // Additional debugging
    window.addEventListener('load', function() {
      console.log('Page fully loaded');
      console.log('Upload forms found:', document.querySelectorAll('#uploadFormEn, #uploadFormEs').length);
    });
  </script>

<!-- Chatbot Widget -->
<div class="chat-container">
  <!-- Floating Chat Button -->
  <button class="chat-button" id="chatButton">
    <span class="chat-icon">ðŸ’¬</span>
  </button>
  
  <!-- Expandable Chat Interface -->
  <div class="chat-interface" id="chatInterface">
    <div class="chat-header">
      <div class="chat-title-area">
        <div class="chat-title">AI Assistant</div>
        <div class="chat-subtitle">Ask about bail bonds</div>
      </div>
      <button class="chat-close" id="chatClose">Ã—</button>
    </div>
    
    <div class="chat-messages" id="chatMessages">
      <div class="welcome-message">
        ðŸ‘‹ Hi! I'm your AI assistant for <strong>Barbie's Bail Bonds</strong>.<br><br>
        Ask me anything about:<br>
        â€¢ Bail costs & processes<br>
        â€¢ Court requirements<br>
        â€¢ Payment options<br>
        â€¢ Release procedures
      </div>
    </div>
    
    <div class="typing-indicator" id="typingIndicator">
      ðŸ¤– Assistant is typing
      <div class="typing-dots">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
    
    <div class="chat-input-container">
      <input 
        type="text" 
        class="chat-input" 
        id="chatInput" 
        placeholder="Type your message..."
        maxlength="500"
      >
      <button class="chat-send" id="chatSend">â–¶</button>
    </div>
  </div>
</div>

<script>
(function() {
  // Get DOM elements
  const chatButton = document.getElementById('chatButton');
  const chatInterface = document.getElementById('chatInterface');
  const chatClose = document.getElementById('chatClose');
  const chatMessages = document.getElementById('chatMessages');
  const chatInput = document.getElementById('chatInput');
  const chatSend = document.getElementById('chatSend');
  const typingIndicator = document.getElementById('typingIndicator');

  // Detect if this page is running inside an embed (e.g., Google Sites)
  const isEmbedded = window.self !== window.top;
  
  // Chat toggle functionality
  chatButton.addEventListener('click', function() {
    chatInterface.classList.toggle('active');
    if (chatInterface.classList.contains('active')) {
      chatInput.focus();
    }
  });

  chatClose.addEventListener('click', function() {
    chatInterface.classList.remove('active');
  });

  // Send message functionality
  function sendMessage() {
    const message = chatInput.value.trim();
    if (!message) return;

    // Add user message to chat
    addMessage(message, 'user');
    chatInput.value = '';
    
    // Show typing indicator
    showTypingIndicator();
    
    // Send to chatbot API
    fetch('https://conversation-context-fixed-796926678831.us-central1.run.app/chat', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        message: message,
        context: "You are a helpful assistant for Barbie's Bail Bonds, a family-owned bail bond agency in South Florida since 1993. You help people understand bail bonds, court processes, and provide information about the services. Be empathetic, professional, and informative. The office is located at 1015 S Congress Ave #1, West Palm Beach, FL. Phone: 561-247-0018. Services include bail bonds and walkthrough bonds for warrants."
      })
    })
    .then(response => response.json())
    .then(data => {
      hideTypingIndicator();
      addMessage(data.response || 'Sorry, I encountered an error. Please call 561-247-0018 for immediate assistance.', 'assistant');
    })
    .catch(error => {
      hideTypingIndicator();
      addMessage('I\'m having trouble connecting right now. For immediate help, please call 561-247-0018.', 'assistant');
      console.error('Chat error:', error);
    });
  }

  // Add message to chat interface
  function addMessage(content, sender) {
    const messageDiv = document.createElement('div');
    messageDiv.className = `message ${sender}`;
    messageDiv.textContent = content;
    
    chatMessages.appendChild(messageDiv);
    chatMessages.scrollTop = chatMessages.scrollHeight;
  }

  // Show/hide typing indicator
  function showTypingIndicator() {
    typingIndicator.classList.add('show');
    chatMessages.scrollTop = chatMessages.scrollHeight;
  }

  function hideTypingIndicator() {
    typingIndicator.classList.remove('show');
  }

  // Event listeners
  chatSend.addEventListener('click', sendMessage);
  
  chatInput.addEventListener('keypress', function(e) {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      sendMessage();
    }
  });

  // Close chat when clicking outside (only if not embedded)
  if (!isEmbedded) {
    document.addEventListener('click', function(e) {
      if (!chatInterface.contains(e.target) && !chatButton.contains(e.target)) {
        chatInterface.classList.remove('active');
      }
    });
  }
})();
</script>

</body>
</html>