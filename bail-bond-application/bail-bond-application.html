<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Barbie's Bail Bonds - Application Form</title>
  <style>
    * { box-sizing: border-box; }
    body { margin:0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background:transparent; color:#fff; overflow: -moz-scrollbars-none; -ms-overflow-style: none; }
    body::-webkit-scrollbar { width: 0px; background: transparent; }
    .invisible-spacer { height: 200vh; width: 100%; background: #000000; visibility: visible; pointer-events: none; }
    .wrap { max-width: 880px; margin: 24px auto 40px; padding: 0 16px; }
    .section { margin: 28px 0; padding: 20px; display:none; background:transparent; }
    .section.active { display:block; }
    .grid { display:grid; grid-template-columns: 1fr 1fr; gap: 14px; }
    .full { grid-column: 1 / -1; }
    label { display:block; font-weight: 600; font-size: 14px; margin-bottom: 6px; }
    .req { color: #ff6666; margin-left: 2px; }
    input, textarea, select { width: 100%; padding: 12px; border: 1px solid #555; border-radius: 10px; font-size: 15px; background:#222; color:#fff; }
    textarea { min-height: 120px; resize: vertical; }
    .actions, .step-actions { display:flex; gap:10px; margin-top:20px; }
    button { border:0; border-radius:10px; padding:12px 16px; font-weight:700; cursor:pointer; }
    .primary { background:#F5A00D; color:#111; }
    .ghost { background:#444; color:#fff; }
    .error { color:#ff6666; font-size:14px; display:none; }
    .hint { color:#bbb; font-size:13px; margin-top:-6px; margin-bottom:10px; }
    .checks { display:flex; flex-direction:column; gap:10px; margin-top: 10px; }
    .checks label { font-weight:500; display:flex; align-items:center; gap:10px; margin:0; cursor:pointer; }
    .checks input[type="checkbox"] { margin: 0; width: auto; flex-shrink: 0; }
    .agreement-text { white-space: pre-line; font-size:14px; line-height:1.4; color:#ddd; padding:20px; border:1px solid #555; border-radius:10px; background:#222; max-height: 400px; overflow-y: auto; }
    input[type="date"]::-webkit-calendar-picker-indicator { filter: invert(1); }
    .loading-indicator { display: none; text-align: center; margin: 20px 0; color: #F5A00D; font-weight: 600; }
    @media (max-width: 880px) { .grid { grid-template-columns: 1fr; } }
    
    /* Chatbot Widget Styles */
    .chat-container { position: fixed !important; top: 550px !important; right: clamp(12px, 3vw, 28px) !important; bottom: auto !important; left: auto !important; transform: none !important; z-index: 1000; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    @media (max-width: 1024px) { .chat-container { top: 525px !important; } }
    @media (max-width: 600px) { .chat-container { top: 500px !important; } }
    .chat-button { width: clamp(60px, 9vw, 84px); height: clamp(60px, 9vw, 84px); background: linear-gradient(135deg, #F28C00, #D67700); border: none; border-radius: 50%; color: white; font-size: clamp(22px, 4vw, 30px); cursor: pointer; display: flex; justify-content: center; align-items: center; box-shadow: 0 4px 15px rgba(242, 140, 0, 0.4); transition: all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1); animation: pulse 2s infinite; }
    .chat-button:hover { transform: scale(1.1); box-shadow: 0 6px 20px rgba(242, 140, 0, 0.6); }
    .chat-button.active { transform: rotate(45deg); background: #666; }
    @keyframes pulse { 0%, 100% { box-shadow: 0 4px 15px rgba(242, 140, 0, 0.4); } 50% { box-shadow: 0 4px 15px rgba(242, 140, 0, 0.8), 0 0 0 10px rgba(242, 140, 0, 0.1); } }
    .chat-interface { display: none; position: absolute; bottom: 80px; right: 0; width: 350px; height: 500px; background: white; border-radius: 12px; box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15); overflow: hidden; opacity: 0; transform: translateY(20px) scale(0.9); transition: all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1); }
    .chat-interface.open { display: flex; flex-direction: column; opacity: 1; transform: translateY(0) scale(1); }
    .chat-header { background: linear-gradient(135deg, #F28C00, #D67700); color: white; padding: 16px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(255,255,255,0.1); }
    .chat-title { font-size: 16px; font-weight: 600; margin: 0; }
    .chat-subtitle { font-size: 12px; opacity: 0.8; margin: 2px 0 0 0; }
    .chat-close { background: none; border: none; color: white; font-size: 18px; cursor: pointer; padding: 4px 8px; border-radius: 4px; transition: background 0.2s; }
    .chat-close:hover { background: rgba(255,255,255,0.2); }
    .chat-messages { flex: 1; overflow-y: auto; padding: 16px; background: #f8f9fa; scrollbar-width: thin; scrollbar-color: #ddd transparent; }
    .chat-messages::-webkit-scrollbar { width: 4px; }
    .chat-messages::-webkit-scrollbar-track { background: transparent; }
    .chat-messages::-webkit-scrollbar-thumb { background: #ddd; border-radius: 2px; }
    .chat-input-container { padding: 12px 16px; background: white; border-top: 1px solid #eee; display: flex; gap: 8px; align-items: flex-end; }
    .chat-input { flex: 1; padding: 8px 12px; border: 2px solid #eee; border-radius: 20px; font-size: 14px; outline: none; resize: none; max-height: 80px; transition: border-color 0.2s; }
    .chat-input:focus { border-color: #F28C00; }
    .chat-send { background: #F28C00; color: white; border: none; width: 36px; height: 36px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; font-size: 16px; }
    .chat-send:hover:not(:disabled) { background: #D67700; transform: scale(1.1); }
    .chat-send:disabled { background: #ccc; cursor: not-allowed; transform: none; }
    .message { margin-bottom: 12px; display: flex; gap: 8px; align-items: flex-end; }
    .message.user { flex-direction: row-reverse; }
    .message-bubble { max-width: 75%; padding: 10px 14px; border-radius: 18px; font-size: 14px; line-height: 1.4; word-wrap: break-word; }
    .message.assistant .message-bubble { background: white; color: #333; border-bottom-left-radius: 4px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .message.user .message-bubble { background: linear-gradient(135deg, #F28C00, #D67700); color: white; border-bottom-right-radius: 4px; }
    .message-avatar { width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; flex-shrink: 0; }
    .message.assistant .message-avatar { background: #F28C00; color: white; }
    .message.user .message-avatar { background: #666; color: white; }
    .welcome-message { text-align: center; color: #666; padding: 30px 20px; font-size: 14px; line-height: 1.6; }
    .typing-indicator { display: none; padding: 8px 16px; color: #666; font-size: 12px; font-style: italic; }
    .typing-dots { display: inline-flex; gap: 2px; margin-left: 4px; }
    .typing-dots span { width: 4px; height: 4px; background: #666; border-radius: 50%; animation: typing 1.4s infinite ease-in-out; }
    .typing-dots span:nth-child(1) { animation-delay: -0.32s; }
    .typing-dots span:nth-child(2) { animation-delay: -0.16s; }
    @keyframes typing { 0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; } 40% { transform: scale(1); opacity: 1; } }
    @media (max-width: 600px) { .chat-interface { height: 400px !important; } }
    @media (max-width: 480px) { .chat-interface { width: calc(100vw - 40px); height: calc(100vh - 120px); bottom: 80px; right: -10px; } .chat-container { bottom: 20px; right: 20px; } }
  </style>
</head>
<body>
  <div class="wrap">
    <!-- Progress Bar -->
    <div style="background:#fff; padding:20px; border-radius:12px; margin-bottom:30px;">
      <div style="color:#333; font-size:16px; font-weight:600; margin-bottom:10px; text-align:center;">Application Progress</div>
      <div style="background:#eee; height:8px; border-radius:4px; overflow:hidden;">
        <div id="progressBar" style="background:#F28C00; height:100%; width:0%; transition:width 0.3s ease;"></div>
      </div>
      <div id="progressText" style="color:#666; font-size:14px; text-align:center; margin-top:8px;">Step 1 of 23</div>
    </div>

    <form id="f" novalidate>

      <!-- STEP 1: ID Upload -->
      <div class="section active" data-step="0">
        <div style="text-align:center; margin-bottom:30px;">
          <h2 style="color:#fff; font-size:28px; margin-bottom:15px; font-weight:700;">ðŸ“¸ Upload Your ID</h2>
          <p style="color:#fff; font-size:16px; line-height:1.5;">
            Please take photos of the front and back of your government-issued ID.
          </p>
        </div>

        <div style="background:#fff; padding:30px; border-radius:12px; margin:20px 0;">
          <div class="grid" style="display:grid; grid-template-columns:1fr 1fr; gap:20px; margin:0 -10px;">
            <style>
              @media (max-width: 768px) {
                .grid { grid-template-columns: 1fr !important; }
              }
            </style>

            <!-- ID Front -->
            <div style="text-align:center;">
              <div style="font-size:18px; font-weight:600; margin-bottom:15px; color:#333;">ID Front</div>
              <div style="border:2px dashed #ddd; padding:30px 20px; border-radius:8px; background:#f9f9f9; min-height:180px; display:flex; flex-direction:column; justify-content:center;">
                <div style="font-size:16px; margin-bottom:10px; color:#666; font-weight:600;">ID FRONT</div>
                <input type="file" id="idFront" accept="image/*" style="display:none;" onchange="handleIDUpload(this, 'front')">
                <button type="button" onclick="document.getElementById('idFront').click()" style="background:#F28C00; color:#fff; border:none; padding:10px 20px; border-radius:6px; font-size:14px; cursor:pointer; margin-bottom:10px;">
                  Upload Front
                </button>
                <div style="font-size:12px; color:#666;">JPG, PNG only</div>
              </div>
              <div id="frontPreview" style="margin-top:10px;"></div>
            </div>

            <!-- ID Back -->
            <div style="text-align:center;">
              <div style="font-size:18px; font-weight:600; margin-bottom:15px; color:#333;">ID Back</div>
              <div style="border:2px dashed #ddd; padding:30px 20px; border-radius:8px; background:#f9f9f9; min-height:180px; display:flex; flex-direction:column; justify-content:center;">
                <div style="font-size:16px; margin-bottom:10px; color:#666; font-weight:600;">ID BACK</div>
                <input type="file" id="idBack" accept="image/*" style="display:none;" onchange="handleIDUpload(this, 'back')">
                <button type="button" onclick="document.getElementById('idBack').click()" style="background:#F28C00; color:#fff; border:none; padding:10px 20px; border-radius:6px; font-size:14px; cursor:pointer; margin-bottom:10px;">
                  Upload Back
                </button>
                <div style="font-size:12px; color:#666;">JPG, PNG only</div>
              </div>
              <div id="backPreview" style="margin-top:10px;"></div>
            </div>

          </div>
        </div>

        <div style="background:#fff2d1; padding:20px; border-radius:8px; margin:20px 0; text-align:center;">
          <div style="color:#333; font-weight:600; margin-bottom:8px;">Having Issues?</div>
          <div style="color:#666;">Text photos directly to <span style="color:#F28C00; font-weight:600; white-space: nowrap;">561-247-0018</span> or call <a href="tel:+15612470018" style="color:#F28C00; text-decoration:none; white-space: nowrap;">561-247-0018</a></div>
        </div>

        <div class="step-actions">
          <button class="primary" type="button" data-next id="uploadNextBtn">Continue</button>
        </div>
      </div>

      <!-- STEP 2: Intake (2 questions) -->
      <div class="section" data-step="1">
        <div class="grid">
          <div class="full">
            <label for="whoAreYou">Who are you?<span class="req">*</span></label>
            <select id="whoAreYou" name="whoAreYou" required>
              <option value="" hidden>Selectâ€¦</option>
              <option value="Indemnitor">Indemnitor â€” financial guarantor who promises the court the defendant will appear</option>
              <option value="Defendant">Defendant â€” the person in jail / being bonded</option>
            </select>
          </div>
          <div class="full">
            <label for="howHeard">How did you hear about us?<span class="req">*</span></label>
            <input id="howHeard" name="howHeard" required />
          </div>
        </div>
        <div class="step-actions">
          <button class="primary" type="button" data-next>Next</button>
        </div>
      </div>

      <!-- STEP 2A: Indemnitor (first 5) -->
      <div class="section" data-step="1">
        <div class="section-info" style="margin-bottom:20px; color:#fff; font-size:14px; line-height:1.4; text-align:center; font-weight:bold;">
          Please provide the following information about the person who is bonding the arrested person out.
        </div>
        <div class="grid">
          <div>
            <label for="indemnitorName">Indemnitor's Complete Name<span class="req">*</span></label>
            <input id="indemnitorName" name="indemnitorName" required />
          </div>
          <div>
            <label for="relation">Your Relation to Person in Jail and/or Being Bonded?<span class="req">*</span></label>
            <input id="relation" name="relation" required />
          </div>
          <div>
            <label for="indemnitorDob">What is Your Date of Birth<span class="req">*</span></label>
            <input id="indemnitorDob" name="indemnitorDob" type="date" required />
          </div>
          <div>
            <label for="indemnitorSsn">Social Security #</label>
            <input id="indemnitorSsn" name="indemnitorSsn" inputmode="numeric" />
          </div>
          <div>
            <label for="indemnitorDl">Driver's License (or ID) #</label>
            <input id="indemnitorDl" name="indemnitorDl" />
          </div>
        </div>
        <div class="step-actions">
          <button class="ghost" type="button" data-back>Back</button>
          <button class="primary" type="button" data-next>Next</button>
        </div>
      </div>

      <!-- STEP 2B: Indemnitor (next 5) -->
      <div class="section" data-step="2">
        <div class="grid">
          <div>
            <label for="indemnitorCell">Cell Phone #<span class="req">*</span></label>
            <input id="indemnitorCell" name="indemnitorCell" type="tel" inputmode="tel" data-phone required />
          </div>
          <div>
            <label for="indemnitorHomePhone">Home Phone #</label>
            <input id="indemnitorHomePhone" name="indemnitorHomePhone" type="tel" inputmode="tel" data-phone />
          </div>
          <div>
            <label for="indemnitorEmail">Email Address</label>
            <input id="indemnitorEmail" name="indemnitorEmail" type="email" />
          </div>
          <div class="full">
            <label for="indemnitorAddress">Home Address<span class="req">*</span></label>
            <input id="indemnitorAddress" name="indemnitorAddress" required />
          </div>
          <div>
            <label for="indemnitorHowLong">How Long Living at Current Address<span class="req">*</span></label>
            <div class="hint">Examples: "2 years", "6 months", "Under 1 year", "Over 3 years"</div>
            <input id="indemnitorHowLong" name="indemnitorHowLong" required />
          </div>
        </div>
        <div class="step-actions">
          <button class="ghost" type="button" data-back>Back</button>
          <button class="primary" type="button" data-next>Next</button>
        </div>
      </div>

      <!-- STEP 2C: Indemnitor (final 5) -->
      <div class="section" data-step="3">
        <div class="grid">
          <div>
            <label for="indemnitorWorkType">Type of Work<span class="req">*</span></label>
            <div class="hint">Examples: "Manager", "Construction Worker", "Nurse", "Self-employed", "Retired"</div>
            <input id="indemnitorWorkType" name="indemnitorWorkType" required />
          </div>
          <div>
            <label for="indemnitorEmployer">Employer Name<span class="req">*</span></label>
            <input id="indemnitorEmployer" name="indemnitorEmployer" required />
          </div>
          <div>
            <label for="indemnitorWorkPhone">Work Phone # (will NOT be called)</label>
            <input id="indemnitorWorkPhone" name="indemnitorWorkPhone" type="tel" inputmode="tel" data-phone />
          </div>
          <div class="full">
            <label for="indemnitorWorkAddress">Work Address</label>
            <input id="indemnitorWorkAddress" name="indemnitorWorkAddress" />
          </div>
          <div class="full">
            <label for="indemnitorVehicle">Indemnitor's Vehicle<span class="req">*</span></label>
            <div class="hint">Examples: "2018 Honda Civic", "2020 Ford F-150", "No vehicle"</div>
            <input id="indemnitorVehicle" name="indemnitorVehicle" required />
          </div>
        </div>
        <div class="step-actions">
          <button class="ghost" type="button" data-back>Back</button>
          <button class="primary" type="button" data-next>Next</button>
        </div>
      </div>

      <!-- STEP 3A: Defendant (first 5) -->
      <div class="section" data-step="4">
        <div class="section-info" style="margin-bottom:20px; color:#fff; font-size:14px; line-height:1.4; text-align:center; font-weight:bold;">
          The following questions are about the defendant (the arrested person or person needing a bond).
        </div>
        <div class="grid">
          <div>
            <label for="defendantName">Defendant's Complete Name<span class="req">*</span></label>
            <input id="defendantName" name="defendantName" required />
          </div>
          <div>
            <label for="defendantNick">Nick Name of Defendant (If not actual name)</label>
            <input id="defendantNick" name="defendantNick" />
          </div>
          <div>
            <label for="defendantDob">Date of Birth<span class="req">*</span></label>
            <input id="defendantDob" name="defendantDob" type="date" required />
          </div>
          <div>
            <label for="defendantSsn">Social Security # (optional)</label>
            <input id="defendantSsn" name="defendantSsn" inputmode="numeric" />
          </div>
          <div>
            <label for="defendantDl">Driver's License or ID # (optional)</label>
            <input id="defendantDl" name="defendantDl" />
          </div>
        </div>
        <div class="step-actions">
          <button class="ghost" type="button" data-back>Back</button>
          <button class="primary" type="button" data-next>Next</button>
        </div>
      </div>

      <!-- STEP 3B: Defendant (next 5) -->
      <div class="section" data-step="5">
        <div class="grid">
          <div>
            <label for="birthCityState">City & State of Birth</label>
            <input id="birthCityState" name="birthCityState" />
          </div>
          <div>
            <label for="citizenship">Country of Citizenship</label>
            <input id="citizenship" name="citizenship" />
          </div>
          <div>
            <label for="race">Race<span class="req">*</span></label>
            <select id="race" name="race" required>
              <option value="" hidden>Selectâ€¦</option>
              <option>White</option>
              <option>Black / African American</option>
              <option>Hispanic / Latino</option>
              <option>Asian</option>
              <option>Native American</option>
              <option>Pacific Islander</option>
              <option>Other</option>
            </select>
          </div>
          <div>
            <label for="defendantCell">Cell Phone #<span class="req">*</span></label>
            <input id="defendantCell" name="defendantCell" type="tel" inputmode="tel" data-phone required />
          </div>
          <div>
            <label for="defendantHomePhone">Home Phone # (Skip if none)</label>
            <input id="defendantHomePhone" name="defendantHomePhone" type="tel" inputmode="tel" data-phone />
          </div>
        </div>
        <div class="step-actions">
          <button class="ghost" type="button" data-back>Back</button>
          <button class="primary" type="button" data-next>Next</button>
        </div>
      </div>

      <!-- STEP 3C: Defendant (next 5) -->
      <div class="section" data-step="6">
        <div class="grid">
          <div>
            <label for="defendantEmail">Email Address</label>
            <input id="defendantEmail" name="defendantEmail" type="email" />
          </div>
          <div class="full">
            <label for="defendantAddress">Home Address<span class="req">*</span></label>
            <input id="defendantAddress" name="defendantAddress" required />
          </div>
          <div>
            <label for="defendantHowLong">How Long has Defendant Lived at Current Address<span class="req">*</span></label>
            <div class="hint">Examples: "2 years", "6 months", "Under 1 year", "Over 3 years"</div>
            <input id="defendantHowLong" name="defendantHowLong" required />
          </div>
          <div>
            <label for="homeStatus">Is This Home Owned or Rented?</label>
            <select id="homeStatus" name="homeStatus">
              <option value="" hidden>Selectâ€¦</option>
              <option>Owned</option>
              <option>Rented</option>
              <option>Other</option>
            </select>
          </div>
          <div class="full">
            <label for="landlordName">Name of Community / Landlord / Owner</label>
            <input id="landlordName" name="landlordName" />
          </div>
        </div>
        <div class="step-actions">
          <button class="ghost" type="button" data-back>Back</button>
          <button class="primary" type="button" data-next>Next</button>
        </div>
      </div>

      <!-- STEP 3D: Defendant (next 5) -->
      <div class="section" data-step="7">
        <div class="grid">
          <div>
            <label for="defendantWorkType">Defendant's Type of Work</label>
            <div class="hint">Examples: "Manager", "Construction Worker", "Nurse", "Self-employed", "Unemployed"</div>
            <input id="defendantWorkType" name="defendantWorkType" />
          </div>
          <div>
            <label for="defendantEmployer">Defendant's Employer Name</label>
            <input id="defendantEmployer" name="defendantEmployer" />
          </div>
          <div>
            <label for="defendantWorkPhone">Defendant's Work Phone # (will NOT be called)</label>
            <input id="defendantWorkPhone" name="defendantWorkPhone" type="tel" inputmode="tel" data-phone />
          </div>
          <div class="full">
            <label for="defendantWorkAddress">Defendant's Work Address</label>
            <input id="defendantWorkAddress" name="defendantWorkAddress" />
          </div>
          <div class="full">
            <label for="recentArrest">Defendant's Most Recent Arrest (Not including the Current Arrest)</label>
            <textarea id="recentArrest" name="recentArrest"></textarea>
          </div>
        </div>
        <div class="step-actions">
          <button class="ghost" type="button" data-back>Back</button>
          <button class="primary" type="button" data-next>Next</button>
        </div>
      </div>

      <!-- STEP 3E: Defendant (final 2) -->
      <div class="section" data-step="8">
        <div class="grid">
          <div class="full">
            <label>Please Select or Tap with your Finger ONLY if the answer is "Yes":</label>
            <div class="hint">These questions are about the person being bonded. Only check boxes if the answer is YES.</div>
            <div class="checks">
              <label><input type="checkbox" id="q_fta" name="q_fta" value="Yes"> Has Failed to Appear for Court in the Past?</label>
              <label><input type="checkbox" id="q_supervision" name="q_supervision" value="Yes"> Is Currently on Probation, Parole, or SOR (Sex Offender Registry)?</label>
              <label><input type="checkbox" id="q_otherBond" name="q_otherBond" value="Yes"> Is Currently on Bond for Another Case?</label>
            </div>
          </div>
          <div class="full">
            <label for="defendantVehicle">Defendant's Vehicle to get to Court<span class="req">*</span></label>
            <div class="hint">Examples: "2018 Honda Civic", "Family member will drive", "Public transportation", "Uber/Taxi"</div>
            <input id="defendantVehicle" name="defendantVehicle" required />
          </div>
        </div>
        <div class="step-actions">
          <button class="ghost" type="button" data-back>Back</button>
          <button class="primary" type="button" data-next>Next</button>
        </div>
      </div>

      <!-- STEP 4A: Relationship (5) -->
      <div class="section" data-step="9">
        <div class="grid">
          <div>
            <label for="relationshipStatus">Relationship Status</label>
            <select id="relationshipStatus" name="relationshipStatus">
              <option value="" hidden>Selectâ€¦</option>
              <option>Single</option>
              <option>Married</option>
              <option>Domestic Partnership</option>
              <option>Separated</option>
              <option>Divorced</option>
              <option>Widowed</option>
            </select>
          </div>
          <div>
            <label for="partnerName">Full Name of Defendant's Partner</label>
            <input id="partnerName" name="partnerName" />
          </div>
          <div>
            <label for="partnerDob">Partner Date of Birth</label>
            <input id="partnerDob" name="partnerDob" type="date" />
          </div>
          <div>
            <label for="partnerCell">Cell Phone # of Partner</label>
            <input id="partnerCell" name="partnerCell" type="tel" inputmode="tel" data-phone />
          </div>
          <div>
            <label for="partnerWorkType">Partner Type of Work</label>
            <div class="hint">Examples: "Manager", "Construction Worker", "Nurse", "Self-employed", "Unemployed"</div>
            <input id="partnerWorkType" name="partnerWorkType" />
          </div>
        </div>
        <div class="step-actions">
          <button class="ghost" type="button" data-back>Back</button>
          <button class="primary" type="button" data-next>Next</button>
        </div>
      </div>

      <!-- STEP 4B: Relationship (1) -->
      <div class="section" data-step="10">
        <div class="grid">
          <div class="full">
            <label for="partnerWorkName">Partner Work Name</label>
            <input id="partnerWorkName" name="partnerWorkName" />
          </div>
        </div>
        <div class="step-actions">
          <button class="ghost" type="button" data-back>Back</button>
          <button class="primary" type="button" data-next>Next</button>
        </div>
      </div>

      <!-- STEP 5A: Parents (5) -->
      <div class="section" data-step="11">
        <div class="grid">
          <div>
            <label for="motherName">Mother's Name</label>
            <input id="motherName" name="motherName" />
          </div>
          <div>
            <label for="motherPhone">Mother's Phone #</label>
            <input id="motherPhone" name="motherPhone" type="tel" inputmode="tel" data-phone />
          </div>
          <div class="full">
            <label for="motherAddress">Mother's Home Address</label>
            <input id="motherAddress" name="motherAddress" />
          </div>
          <div>
            <label for="fatherName">Father's Name</label>
            <input id="fatherName" name="fatherName" />
          </div>
          <div>
            <label for="fatherPhone">Father's Phone #</label>
            <input id="fatherPhone" name="fatherPhone" type="tel" inputmode="tel" data-phone />
          </div>
        </div>
        <div class="step-actions">
          <button class="ghost" type="button" data-back>Back</button>
          <button class="primary" type="button" data-next>Next</button>
        </div>
      </div>

      <!-- STEP 5B: Parents (1) -->
      <div class="section" data-step="12">
        <div class="grid">
          <div class="full">
            <label for="fatherAddress">Father's Home Address</label>
            <input id="fatherAddress" name="fatherAddress" />
          </div>
        </div>
        <div class="step-actions">
          <button class="ghost" type="button" data-back>Back</button>
          <button class="primary" type="button" data-next>Next</button>
        </div>
      </div>

      <!-- STEP 6: Siblings (4) -->
      <div class="section" data-step="13">
        <div class="grid">
          <div>
            <label for="sibling1Name">1. Brother/Sister's Name</label>
            <input id="sibling1Name" name="sibling1Name" />
          </div>
          <div>
            <label for="sibling1Phone">1. Brother/Sister's Phone #</label>
            <input id="sibling1Phone" name="sibling1Phone" type="tel" inputmode="tel" data-phone />
          </div>
          <div>
            <label for="sibling2Name">2. Brother/Sister's Name</label>
            <input id="sibling2Name" name="sibling2Name" />
          </div>
          <div>
            <label for="sibling2Phone">2. Brother/Sister's Phone #</label>
            <input id="sibling2Phone" name="sibling2Phone" type="tel" inputmode="tel" data-phone />
          </div>
        </div>
        <div class="step-actions">
          <button class="ghost" type="button" data-back>Back</button>
          <button class="primary" type="button" data-next>Next</button>
        </div>
      </div>

      <!-- STEP 7A: References (5) -->
      <div class="section" data-step="14">
        <div class="grid">
          <div>
            <label for="ref1Name">Reference #1 - Full Name<span class="req">*</span></label>
            <input id="ref1Name" name="ref1Name" required />
          </div>
          <div>
            <label for="ref1Relation">Reference #1 - Relation<span class="req">*</span></label>
            <input id="ref1Relation" name="ref1Relation" required />
          </div>
          <div>
            <label for="ref1Phone">Reference #1 - Phone #<span class="req">*</span></label>
            <input id="ref1Phone" name="ref1Phone" type="tel" inputmode="tel" data-phone required />
          </div>
          <div>
            <label for="ref2Name">Reference #2 - Full Name<span class="req">*</span></label>
            <input id="ref2Name" name="ref2Name" required />
          </div>
          <div>
            <label for="ref2Relation">Reference #2 - Relation<span class="req">*</span></label>
            <input id="ref2Relation" name="ref2Relation" required />
          </div>
        </div>
        <div class="step-actions">
          <button class="ghost" type="button" data-back>Back</button>
          <button class="primary" type="button" data-next>Next</button>
        </div>
      </div>

      <!-- STEP 7B: References (4) -->
      <div class="section" data-step="15">
        <div class="grid">
          <div>
            <label for="ref2Phone">Reference #2 - Phone #<span class="req">*</span></label>
            <input id="ref2Phone" name="ref2Phone" type="tel" inputmode="tel" data-phone required />
          </div>
          <div>
            <label for="ref3Name">Reference #3 - Full Name<span class="req">*</span></label>
            <input id="ref3Name" name="ref3Name" required />
          </div>
          <div>
            <label for="ref3Relation">Reference #3 - Relation<span class="req">*</span></label>
            <input id="ref3Relation" name="ref3Relation" required />
          </div>
          <div>
            <label for="ref3Phone">Reference #3 - Phone #<span class="req">*</span></label>
            <input id="ref3Phone" name="ref3Phone" type="tel" inputmode="tel" data-phone required />
          </div>
        </div>
        <div class="step-actions">
          <button class="ghost" type="button" data-back>Back</button>
          <button class="primary" type="button" data-next>Next</button>
        </div>
      </div>

      <!-- STEP 8A: Emergency Contacts (5) -->
      <div class="section" data-step="16">
        <div class="grid">
          <div>
            <label for="emergency1Name">Emergency Contact #1<span class="req">*</span></label>
            <input id="emergency1Name" name="emergency1Name" required />
          </div>
          <div>
            <label for="emergency1Phone">Emergency #1 Phone<span class="req">*</span></label>
            <input id="emergency1Phone" name="emergency1Phone" type="tel" inputmode="tel" data-phone required />
          </div>
          <div>
            <label for="emergency2Name">Emergency Contact #2<span class="req">*</span></label>
            <input id="emergency2Name" name="emergency2Name" required />
          </div>
          <div>
            <label for="emergency2Phone">Emergency #2 Phone<span class="req">*</span></label>
            <input id="emergency2Phone" name="emergency2Phone" type="tel" inputmode="tel" data-phone required />
          </div>
        </div>
        <div class="step-actions">
          <button class="ghost" type="button" data-back>Back</button>
          <button class="primary" type="button" data-next>Next</button>
        </div>
      </div>


      <!-- STEP 9: Terms and Conditions -->
      <div class="section" data-step="18">
        <div class="agreement-text">
Terms and Conditions of Application for Appearance Bond

The following terms and conditions for the Appearance Bond for which U.S. Fire Insurance Company (USFIC) or its Agent and the parties agree that said appearance bond is conditioned upon full compliance of all said terms and conditions and is a part of said bond and application therefore.

1. USFIC as the Surety Company, through its duly appointed agent, shall have control and jurisdiction over the principal during the term for which the bond is executed and shall have the right to apprehend, arrest and surrender the principal to the proper officials at any time as provided by law.

2. In the event surrender of principal is made prior to the time set for the principal's appearances, and for reasons other than as enumerated below in paragraph 3, then principal shall be entitled to a refund of the bond premium.

3. It is understood and agreed that the happening of any one of the following events shall constitute a breach of principal's obligation to USFIC hereunder, and USFIC shall have the right to forthwith apprehend, arrest, and surrender principal, and principal shall have no right to any refund of premium whatsoever. Said events which shall constitute a breach of principal's obligations hereunder are:
   (a) If principal shall depart the jurisdiction of the court without the written consent of the court and the Surety Company or its Agent.
   (b) If principal shall move from one address to another without notifying the Surety Company or its Agent in writing prior to such move.
   (c) If principal shall commit any act which shall constitute reasonable evidence of principal's intention to cause a forfeiture of said bond.
   (d) If principal is arrested and incarcerated for any offense other than a minor traffic violation.
   (e) If principal shall make any material false statements in the application for appearance bond.

Under penalties of perjury, I declare that I have read the foregoing, and the information provided is true and correct without reservation. The information and representations made in this Application are for the purpose of inducing the Surety to undertake the bond(s) for which I have applied with the intent that the Surety fully rely upon the information and representations contained herein. I agree to indemnify and hold harmless the Surety Company and its Agents for any and all losses that may arise from the execution of the bond(s) applied for herein, unless prohibited by applicable law or regulation.

***ONLY PROCEED IF YOU AGREE TO THE ABOVE***
        </div>
        <div class="checks">
          <label><input type="checkbox" id="termsRead" name="termsRead" value="Yes" required> I have read and agree to the above Terms and Conditions<span class="req">*</span></label>
        </div>
        <div class="step-actions">
          <button class="ghost" type="button" data-back>Back</button>
          <button class="primary" type="button" data-next>Next</button>
        </div>
      </div>

      <!-- STEP 10: Contingent Promissory Note -->
      <div class="section" data-step="19">
        <div class="agreement-text">
Contingent Promissory Note

For value received the undersigned, jointly and severally promise(s) to pay U.S. FIRE INSURANCE COMPANY or its Agent, Jerry Casal Bail Bonds, LLC on demand the principal sum of the bond if and only if there occurs a breach of the terms and conditions of the surety bail bond or bonds posted on behalf of defendant.

The defendant for which this is being submitted written out previously on this form (hereinafter "Defendant"), together with any continuations and modifications, any extensions, substitutions, increments or appeals thereof (hereinafter "Bond"), or upon payment of any expenses incurred by the payee or holder (hereinafter "Payee") to produce the Defendant before the appropriate court or courts of Competent jurisdiction in the above case, with interest thereon at the rate of FOURTEEN percent (14%), per annum, from the date of occurrence of the above stated Contingency, until fully paid. All makers or endorsers, now or hereafter becoming parties hereto, jointly and severally waive demand, notice of non-payment and protest: and in case this note becomes in default and placed in hands of an attorney for collection, the foregoing agree(s) to pay reasonable attorney's fees and all other costs for making such collection and further agree(s) that courts of original jurisdiction and appellate courts may award reasonable attorney's fees to the Payee in the event of litigation and/or appeals.

It is further agreed and specifically understood between the parties to this Note that there is presently no outstanding loan or debt represented by this Contingent Promissory Note, and that this Note is given to secure advances up to and including the amount set forth above together with interest if and when there is a breach of the terms and conditions, including but not limited to forfeiture or estreature, of the Bond. It is further agreed and specifically understood that this Note shall become null and void at such time as all of the obligations under the Bond posted on behalf of the Defendant have been fulfilled and the Payee has been discharged of all liability and duly exonerated in writing and until such time as same occurs the note shall remain in full force and effect.

(a) Any and all liability, loss, costs, damages, expenses, premiums and attorneys fees arising or incurred by Payee in connection with the above captioned Bond, or any other recognizance, undertaking or other obligation, heretofore or hereafter executed, assumed or procured by Payee at the instance or request or on behalf of either of owner of the property encumbered by the Mortgage securing the Note (hereinafter, "Owner") or of the principal's name; This Note and the Mortgage of even date herewith shall serve to secure:
(b) For the payment of all premiums on such Bonds;
(c) For the performance of every agreement (including continuations or modifications, any extensions, substitutions, increments or appeals thereof, with or without consent of Owner) made by Owner or Defendant in connection with said Bonds;
(d) Against any liability, loss, costs, expenses, and attorneys fees in connection with any claim to the collateral security by person claiming adversely to Owner or to Principals named in the Bonds;
(e) Any and all future advances made with or without consent of the Owner by Payee on behalf of the Defendant including but not necessarily limited to increments, modifications, extensions or substitutions, or the creation of any future obligation by the Payee in connection with the above described matter, or any bail bonds or obligation undertaken by Payee on behalf of Defendant including, without limiting, to the posting of a new bond for and on behalf of the Defendant in the nature of an appeal bond or substitution extension or modification of the existing Bond.

This Promissory Note is Executed on the date this form is submitted.

***ONLY PROCEED IF YOU AGREE TO THE ABOVE***
        </div>
        <div class="checks">
          <label><input type="checkbox" id="promissoryRead" name="promissoryRead" value="Yes" required> I have read and agree to the above Contingent Promissory Note<span class="req">*</span></label>
        </div>
        <div class="step-actions">
          <button class="ghost" type="button" data-back>Back</button>
          <button class="primary" type="button" data-next>Next</button>
        </div>
      </div>

      <!-- STEP 11: Indemnity Agreement -->
      <div class="section" data-step="20">
        <div class="agreement-text">
Indemnity Agreement for Bail Bond

The undersigned Indemnitor(s) ("Indemnitors") make(s) application to U.S. Fire Insurance Company through its duly licensed and appointed Producer Agent Jerry Casal Bail Bonds, LLC (collectively referred to herein as "Surety") for execution of a bail undertaking ("Bail Bond") in the Penal Amount of given bond amount for defendant herein after referred to as the "Principal" and "Indemnitor" and in consideration of Surety arranging for execution or continuance of this Bail Bond, Indemnitor(s) jointly and severally agree(s) as follows:

For good and valuable consideration, the undersigned Principal and Indemnitor(s) hereby agree to indemnify and hold harmless the Surety company and/or its agent(s) for all losses not otherwise prohibited by law or rules of the Florida Department of Financial Institutions and Insurance, and

1) To pay Surety the Florida set premium for this Bail Bond. The premium is earned upon the release of Principal from the detaining facility. The fact that Defendant may have been improperly arrested, or his bail reduced or his case dismissed, shall not obligate the return of any portion of said premium.

2) To reimburse Surety for actual expenses it incurs caused by any breach by the Principal of the terms of the application and Bail Bond, including expenses or liabilities incurred as a result of searching for, recapturing or returning Principal to custody or in apprehending or endeavoring to apprehend Principal, including legal fees for making application to a court for an order to vacate or set aside an order of forfeiture or judgment entered thereon. In the event the Defendant fails to follow any and all instructions or should the court forfeit or revoke the bond and it becomes necessary for the Bail Bondsman or Surety to investigate, apprehend and surrender the Defendant to the court, Fugitive Fees will be governed by a separate Fugitive Fee Contract between Indemnitor and Surety.

3) To pay the Surety a reasonable attorney's fee, no less than Five Hundred Dollars ($500.00), in the event that it is necessary to institute legal action arising from this Agreement.

4) To provide Surety upon demand, a monetary amount equal to the Penal Amount to be held as collateral if Surety discovers any information was concealed or misrepresented by the Indemnitor or Principal, or upon other reasonable cause material to the Surety's assumed risk. If the court increases the penal amount of the Bail Bond over the amount set forth above, Indemnitor(s) and Principal agree to provide additional collateral as Surety may require if Surety, in its sole discretion, desires to remain on the Bail Bond.

5) To pay Surety immediately upon demand the penal amount of the Bail Bond after any breach of bond conditions or entry of Estreature (forfeiture) pursuant to governing statutes.

6) To aid Surety in securing release or exoneration of Surety from all liability under the Bail Bond, including the surrender of the Principal to the Court upon direction of the Surety.

7) Indemnitor(s) and Principal hereby grant to Surety a Security Interest in all money or other property in their possession or hereafter acquired from time to time pursuant to Chapter 679, Florida Statutes and/or Article 9 of the Uniform Commercial Code. The Surety is authorized to lawfully levy upon said money or property in the manner provided by law and to apply any deposit(s) and/or proceeds without notice toward any liabilities, losses, costs, damages and expenses incurred by Surety as provided in this Agreement. If collateral placed with Surety is in excess of the bail forfeited, such excess shall be timely returned to the Indemnitor and/or Principal as appropriate after first applying the collateral to any forfeiture and subject to any claim of Surety for unpaid Premium or other lawful charges, including but not limited to reimbursement of document recording fees and stamps and filing fees, credit card charges, and any electronic monitoring charges.

8) The obligations of the Indemnitor(s) and Principal hereunder are joint and several. Any amounts due shall bear interest at the maximum rate allowed by law. The Surety shall not be first obligated to proceed against the Principal on Bail Bond before having recourse against the Indemnitor(s) or any one of them. Indemnitors expressly waive any benefits of law requiring the Surety to make claim upon or to proceed or enforce its remedies against the Principal before making demand upon or proceeding and/or enforcing its remedies against any one or more of the Indemnitor(s). For good and valuable consideration, the undersigned Principal hereby agrees to indemnify and/or hold harmless the Surety for 100% of any and all losses not otherwise prohibited by law or rules and regulations promulgated under any applicable statute.

9) As an inducement for Surety to underwrite the Bail Bond, Indemnitor(s) and Principal warrant all statements made by them on the Application for Bail be true and agree to advise Surety of any change, including but not limited to change of phone number, address or employment of either the Principal or of any of the Indemnitor(s) or any other material change in circumstances within forty-eight (48) hours after such change shall have occurred. ANY FAILURE BY PRINCIPAL TO SO NOTIFY SURETY SHALL CONSTITUTE GROUNDS TO BELIEVE PRINCIPAL INTENDS TO FLEE AND SHALL BE CAUSE FOR IMMEDIATE SURRENDER OF THE PRINCIPAL.

10) The undersigned agrees that these obligations apply to any and all Bail Bonds executed for the same charge for which the above mentioned Bail Bond was executed or any charge arising out of the same transaction regardless of whether said Bail Bonds are filed before or after conviction, including appeals, but not in a greater amount.

11) The undersigned authorizes any person, agency, partnership or corporation having any information concerning my character, credit, and financial reputation to release such information to Surety, including but not limited to credit reports and background investigations. Such information is to be used to secure the Principal's appearance in court or apprehension in the case of a bond estreature. The undersigned hereby releases such person, agency, partnership or corporation from any liability which may be incurred in releasing this information to Surety including liability under Federal Law.

I HAVE READ THIS INDEMNITY AGREEMENT AND I KNOW ITS CONTENTS. I ACKNOWLEDGE RECEIPT OF A COPY OF THE INDEMNITY AGREEMENT OR HAVE PRINTED OUT A COPY. I AM THE TRUE AND LAWFUL OWNER OF THE PROPERTY, WHETHER REAL OR PERSONAL, SET FORTH IN THE APPLICATION FOR BAIL (WHICH ENTIRE APPLICATION IS MADE A PART HEREOF BY REFERENCE). I OWN SUCH PROPERTY FREE AND CLEAR OF ALL LIENS OR ENCUMBRANCES EXCEPT AS I HAVE DISCLOSED IN WRITING. I PROMISE NOT TO TRANSFER OR ENCUMBER ANY OF SAID PROPERTY UNTIL MY LIABILITY UNDER THIS INDEMNITY AGREEMENT AND THE APPLICATION FOR BAIL HAS BEEN RELEASED. I UNDERSTAND THE SURETY IS PERMITTING THE BAIL BOND TO REMAIN IN FORCE RELYING ON THE STATEMENTS MADE BY ME.
        </div>
        <div class="checks">
          <label><input type="checkbox" id="indemnityRead" name="indemnityRead" value="Yes" required> I have read and agree to the above Indemnity Agreement<span class="req">*</span></label>
        </div>
        <div class="step-actions">
          <button class="ghost" type="button" data-back>Back</button>
          <button class="primary" type="button" data-next>Next</button>
        </div>
      </div>

      <!-- STEP 12: Final Agreement (Signature) -->
      <div class="section" data-step="21">
        <div class="grid">
          <div class="full">
            <label for="agreeName">BY TYPING YOUR NAME AND SUBMITTING BELOW YOU AGREE TO ALL THE ABOVE TERMS AND CONDITIONS AND THAT THE INFORMATION IS ENTIRELY CORRECT AND TRUE AND THAT YOU ARE THE PERSON SUBMITTING THE APPLICATION.<span class="req">*</span></label>
            <input id="agreeName" name="agreeName" required />
          </div>
        </div>
        <div class="actions">
          <button class="ghost" type="button" data-back>Back</button>
          <button class="primary" id="submitBtn" type="submit">Submit Application</button>
          <div class="error" id="err">Please fill the required fields in this step.</div>
        </div>
        <div class="loading-indicator" id="loadingIndicator">
          Submitting your application...
        </div>
      </div>


      <!-- STEP 13: Application Complete -->
      <div class="section" data-step="23" id="completionSection">
        <div style="text-align:center; padding:40px 20px;">
          <div style="font-size:48px; margin-bottom:20px;">âš ï¸</div>
          <h2 style="color:#fff; font-size:24px; margin-bottom:20px; font-weight:700;">Next Step: We'll Call You</h2>
          <p style="color:#fff; font-size:16px; line-height:1.5; margin-bottom:20px;">
            Don't worry, you're all set. We'll call you immediately after receiving to complete your bond process.
          </p>
          <p style="color:#fff; font-size:16px; line-height:1.5; margin-bottom:30px;">
            ðŸ‘‰ If you haven't already spoken with us, send a quick text to <span style="color:#F5A00D; font-weight:bold;">561-247-0018</span> so we know to reach you fast.
          </p>
          <a href="sms:561-247-0018" style="display:inline-block; background:#F5A00D; color:#111; padding:16px 32px; border-radius:10px; font-weight:700; font-size:16px; text-decoration:none; cursor:pointer;">
            TEXT US
          </a>
        </div>
      </div>

    </form>
  </div>

  <script>
    // Wizard logic
    const sections = Array.from(document.querySelectorAll('.section'));
    let userRole = ''; // 'Indemnitor' or 'Defendant'

    function showStep(idx) {
      sections.forEach((s, i) => {
        s.classList.toggle('active', i === idx);
      });

      // Update progress bar
      const totalSteps = 23; // Total steps including upload and completion
      const currentStep = idx + 1;
      const progressPercent = (currentStep / totalSteps) * 100;

      const progressBar = document.getElementById('progressBar');
      const progressText = document.getElementById('progressText');

      if (progressBar) {
        progressBar.style.width = `${progressPercent}%`;
      }

      if (progressText) {
        if (idx === 23) {
          progressText.textContent = 'Application Complete!';
        } else {
          progressText.textContent = `Step ${currentStep} of ${totalSteps}`;
        }
      }

      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // Update labels based on user role
    function updateLabelsForRole(role) {
      userRole = role;
      
      if (role === 'Indemnitor') {
        // Update indemnitor section labels (steps 1-3) to refer to "Your" info
        document.querySelector('label[for="indemnitorName"]').innerHTML = 'Your Complete Name<span class="req">*</span>';
        document.querySelector('label[for="indemnitorDob"]').innerHTML = 'Your Date of Birth<span class="req">*</span>';
        document.querySelector('label[for="indemnitorCell"]').innerHTML = 'Your Cell Phone #<span class="req">*</span>';
        document.querySelector('label[for="indemnitorEmail"]').innerHTML = 'Your Email Address';
        document.querySelector('label[for="indemnitorAddress"]').innerHTML = 'Your Home Address<span class="req">*</span>';
        document.querySelector('label[for="indemnitorHowLong"]').innerHTML = 'How Long Have You Lived at Current Address<span class="req">*</span>';
        document.querySelector('label[for="indemnitorWorkType"]').innerHTML = 'Your Type of Work<span class="req">*</span>';
        document.querySelector('label[for="indemnitorEmployer"]').innerHTML = 'Your Employer Name<span class="req">*</span>';
        document.querySelector('label[for="indemnitorWorkPhone"]').innerHTML = 'Your Work Phone # (will NOT be called)';
        document.querySelector('label[for="indemnitorWorkAddress"]').innerHTML = 'Your Work Address';
        document.querySelector('label[for="indemnitorVehicle"]').innerHTML = 'Your Vehicle<span class="req">*</span>';
        document.querySelector('label[for="indemnitorHomePhone"]').innerHTML = 'Your Home Phone #';
        document.querySelector('label[for="relation"]').innerHTML = 'Your Relation to Person in Jail and/or Being Bonded?<span class="req">*</span>';
        
        // Keep checkbox section hint as default for indemnitors (about defendant)
        const checkboxHint = document.querySelector('.section[data-step="8"] .hint');
        if (checkboxHint) {
          checkboxHint.innerHTML = 'These questions are about the person being bonded';
        }
        
        // Update section info messages for indemnitors
        const indemnitorSectionInfo = document.querySelector('.section[data-step="1"] .section-info');
        if (indemnitorSectionInfo) {
          indemnitorSectionInfo.innerHTML = 'Please provide the following information about yourself (the person bonding the arrested person out).';
        }
        
        const defendantSectionInfo = document.querySelector('.section[data-step="4"] .section-info');
        if (defendantSectionInfo) {
          defendantSectionInfo.innerHTML = 'The following questions are about the defendant (the arrested person or person needing a bond).';
        }
        
        // Defendant section labels remain as "Defendant's"
      } else if (role === 'Defendant') {
        // Update indemnitor section labels (steps 1-3) to refer to "Indemnitor's" info
        document.querySelector('label[for="indemnitorName"]').innerHTML = 'Indemnitor\'s Complete Name<span class="req">*</span>';
        document.querySelector('label[for="indemnitorDob"]').innerHTML = 'Indemnitor\'s Date of Birth<span class="req">*</span>';
        document.querySelector('label[for="indemnitorCell"]').innerHTML = 'Indemnitor\'s Cell Phone #<span class="req">*</span>';
        document.querySelector('label[for="indemnitorEmail"]').innerHTML = 'Indemnitor\'s Email Address';
        document.querySelector('label[for="indemnitorAddress"]').innerHTML = 'Indemnitor\'s Home Address<span class="req">*</span>';
        document.querySelector('label[for="indemnitorHowLong"]').innerHTML = 'How Long Has Indemnitor Lived at Current Address<span class="req">*</span>';
        document.querySelector('label[for="indemnitorWorkType"]').innerHTML = 'Indemnitor\'s Type of Work<span class="req">*</span>';
        document.querySelector('label[for="indemnitorEmployer"]').innerHTML = 'Indemnitor\'s Employer Name<span class="req">*</span>';
        document.querySelector('label[for="indemnitorWorkPhone"]').innerHTML = 'Indemnitor\'s Work Phone # (will NOT be called)';
        document.querySelector('label[for="indemnitorWorkAddress"]').innerHTML = 'Indemnitor\'s Work Address';
        document.querySelector('label[for="indemnitorVehicle"]').innerHTML = 'Indemnitor\'s Vehicle<span class="req">*</span>';
        document.querySelector('label[for="indemnitorHomePhone"]').innerHTML = 'Indemnitor\'s Home Phone #';
        document.querySelector('label[for="relation"]').innerHTML = 'Indemnitor\'s Relation to You?<span class="req">*</span>';
        
        // Update defendant section labels to refer to "Your" info
        document.querySelector('label[for="defendantName"]').innerHTML = 'Your Complete Name<span class="req">*</span>';
        document.querySelector('label[for="defendantNick"]').innerHTML = 'Your Nick Name (If not actual name)';
        document.querySelector('label[for="defendantDob"]').innerHTML = 'Your Date of Birth<span class="req">*</span>';
        document.querySelector('label[for="defendantSsn"]').innerHTML = 'Your Social Security # (optional)';
        document.querySelector('label[for="defendantDl"]').innerHTML = 'Your Driver\'s License or ID # (optional)';
        document.querySelector('label[for="defendantCell"]').innerHTML = 'Your Cell Phone #<span class="req">*</span>';
        document.querySelector('label[for="defendantHomePhone"]').innerHTML = 'Your Home Phone # (Skip if none)';
        document.querySelector('label[for="defendantEmail"]').innerHTML = 'Your Email Address';
        document.querySelector('label[for="defendantAddress"]').innerHTML = 'Your Home Address<span class="req">*</span>';
        document.querySelector('label[for="defendantHowLong"]').innerHTML = 'How Long Have You Lived at Current Address<span class="req">*</span>';
        document.querySelector('label[for="defendantWorkType"]').innerHTML = 'Your Type of Work';
        document.querySelector('label[for="defendantEmployer"]').innerHTML = 'Your Employer Name';
        document.querySelector('label[for="defendantWorkPhone"]').innerHTML = 'Your Work Phone # (will NOT be called)';
        document.querySelector('label[for="defendantWorkAddress"]').innerHTML = 'Your Work Address';
        document.querySelector('label[for="defendantVehicle"]').innerHTML = 'Your Vehicle to get to Court<span class="req">*</span>';
        document.querySelector('label[for="recentArrest"]').innerHTML = 'Your Most Recent Arrest (Not including the Current Arrest)';
        
        // Update checkbox section hint for defendants
        const checkboxHint = document.querySelector('.section[data-step="8"] .hint');
        if (checkboxHint) {
          checkboxHint.innerHTML = 'These questions are about you';
        }
        
        // Update section info messages for defendants
        const indemnitorSectionInfo = document.querySelector('.section[data-step="1"] .section-info');
        if (indemnitorSectionInfo) {
          indemnitorSectionInfo.innerHTML = 'Please provide the following information about your indemnitor (the person bonding you out).';
        }
        
        const defendantSectionInfo = document.querySelector('.section[data-step="4"] .section-info');
        if (defendantSectionInfo) {
          defendantSectionInfo.innerHTML = 'The following questions are about you (the defendant or person needing a bond).';
        }
      }
    }

    function validateStep(idx) {
      const step = sections[idx];

      // Special validation for upload step (step 0) - always allow to continue
      if (idx === 0) {
        return true; // Upload is optional
      }

      // Special validation for intake step (step 1) - ensure role is selected and labels are updated
      if (idx === 1) {
        const whoAreYouSelect = document.getElementById('whoAreYou');
        if (!whoAreYouSelect.value) {
          whoAreYouSelect.reportValidity();
          return false;
        }

        // Ensure labels have been updated for the selected role
        if (whoAreYouSelect.value && !userRole) {
          updateLabelsForRole(whoAreYouSelect.value);
        }
      }
      
      const fields = step.querySelectorAll('input[required], select[required], textarea[required]');
      for (const el of fields) {
        if (!el.checkValidity()) {
          el.reportValidity();
          return false;
        }
      }
      return true;
    }

    // Setup navigation buttons
    sections.forEach((sec, idx) => {
      const nextBtn = sec.querySelector('[data-next]');
      if (nextBtn) {
        nextBtn.addEventListener('click', () => {
          if (!validateStep(idx)) return;
          const next = idx + 1;
          if (next < sections.length) showStep(next);
        });
      }
      
      const backBtn = sec.querySelector('[data-back]');
      if (backBtn) {
        backBtn.addEventListener('click', () => {
          const prev = idx - 1;
          if (prev >= 0) showStep(prev);
        });
      }
    });

    // Add listener to "Who are you?" dropdown to update labels
    const whoAreYouSelect = document.getElementById('whoAreYou');
    whoAreYouSelect.addEventListener('change', function() {
      if (this.value) {
        updateLabelsForRole(this.value);
      }
    });

    // Start at first step
    showStep(0);

    // Phone formatting: (XXX) XXX-XXXX
    document.querySelectorAll('input[data-phone]').forEach(el => {
      el.addEventListener('blur', () => {
        const digits = (el.value || '').replace(/[^0-9]/g, '');
        if (digits.length === 10) {
          el.value = `(${digits.slice(0, 3)}) ${digits.slice(3, 6)}-${digits.slice(6)}`;
        }
      });
    });

    // Form submission
    const form = document.getElementById('f');
    const errorDiv = document.getElementById('err');
    const submitBtn = document.getElementById('submitBtn');
    const loadingIndicator = document.getElementById('loadingIndicator');

    form.addEventListener('submit', (e) => {
      e.preventDefault();
      
      // Validate final step
      if (!validateStep(sections.length - 2)) {
        if (errorDiv) errorDiv.style.display = 'block';
        return;
      }
      
      // Check form validity
      if (!form.checkValidity()) {
        form.reportValidity();
        return;
      }

      // Disable submit button and show loading
      submitBtn.disabled = true;
      loadingIndicator.style.display = 'block';
      
      // Collect form data
      const formData = new FormData(form);
      const data = Object.fromEntries(formData.entries());
      
      // Add timestamp
      data.timestamp = new Date().toISOString();
      
      // Submit to Google Apps Script
      fetch('https://script.google.com/macros/s/AKfycbx4_PFaUYqJs1y_e0Mn8LoKf_YqGFzUU996HODqni2_dTEoSZSVQwj6YrRLuDriekP4/exec', {
        method: 'POST',
        mode: 'no-cors',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(data)
      })
      .then(() => {
        submitBtn.disabled = false;
        loadingIndicator.style.display = 'none';
        showStep(23); // Show completion section
      })
      .catch((error) => {
        console.error('Submission error:', error);
        submitBtn.disabled = false;
        loadingIndicator.style.display = 'none';
        // Still show completion since no-cors doesn't return errors properly
        showStep(23);
      });
    });

    // Simple ID upload functionality
    let idFrontUploaded = false;
    let idBackUploaded = false;

    function handleIDUpload(input, side) {
      const file = input.files[0];
      if (!file) return;

      // File size check (5MB limit for images)
      if (file.size > 5 * 1024 * 1024) {
        alert(`Image is too large. Maximum size is 5MB.`);
        input.value = '';
        return;
      }

      // File type check
      const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png'];
      if (!allowedTypes.includes(file.type)) {
        alert(`Please use JPG or PNG format only.`);
        input.value = '';
        return;
      }

      // Update preview
      const previewElement = document.getElementById(side + 'Preview');
      previewElement.innerHTML = `
        <div style="font-size:12px; color:#28a745; font-weight:600;">âœ“ ${file.name} uploaded</div>
        <div style="font-size:11px; color:#666;">${(file.size / 1024).toFixed(1)} KB</div>
      `;

      // Mark as uploaded
      if (side === 'front') {
        idFrontUploaded = true;
      } else {
        idBackUploaded = true;
      }

      // Update continue button
      updateUploadButton();
    }

    function updateUploadButton() {
      const uploadBtn = document.getElementById('uploadNextBtn');

      if (idFrontUploaded && idBackUploaded) {
        uploadBtn.textContent = 'Continue (ID Uploaded)';
        uploadBtn.style.background = '#28a745';
      } else if (idFrontUploaded || idBackUploaded) {
        uploadBtn.textContent = 'Continue (Partial Upload)';
        uploadBtn.style.background = '#F28C00';
      } else {
        uploadBtn.textContent = 'Continue';
        uploadBtn.style.background = '#F28C00';
      }
    }

  </script>

<!-- Chatbot Widget -->
<div class="chat-container">
  <button class="chat-button" id="chatButton">
    <span class="chat-icon">ðŸ’¬</span>
  </button>
  
  <div class="chat-interface" id="chatInterface">
    <div class="chat-header">
      <div class="chat-title-area">
        <div class="chat-title">AI Assistant</div>
        <div class="chat-subtitle">Ask about bail bonds</div>
      </div>
      <button class="chat-close" id="chatClose">Ã—</button>
    </div>
    
    <div class="chat-messages" id="chatMessages">
      <div class="welcome-message">
        ðŸ‘‹ Hi! I'm your AI assistant for <strong>Barbie's Bail Bonds</strong>.<br><br>
        Ask me anything about:<br>
        â€¢ Bail costs & processes<br>
        â€¢ Court requirements<br>
        â€¢ Payment options<br>
        â€¢ Release procedures
      </div>
    </div>
    
    <div class="typing-indicator" id="typingIndicator">
      ðŸ¤– Assistant is typing
      <div class="typing-dots">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
    
    <div class="chat-input-container">
      <input 
        type="text" 
        class="chat-input" 
        id="chatInput" 
        placeholder="Type your message..."
        maxlength="500"
      >
      <button class="chat-send" id="chatSend">â–¶</button>
    </div>
  </div>
</div>

<script>
(function() {
  const chatButton = document.getElementById('chatButton');
  const chatInterface = document.getElementById('chatInterface');
  const chatClose = document.getElementById('chatClose');
  const chatMessages = document.getElementById('chatMessages');
  const chatInput = document.getElementById('chatInput');
  const chatSend = document.getElementById('chatSend');
  const typingIndicator = document.getElementById('typingIndicator');
  const API_URL = 'https://script.google.com/macros/s/AKfycbwvJ8utZ62xKjZt2nz8wZnBJb5vbOsCD38RJnDZ0yFZGppsfWnmv7_YIuz5yV9lZz7z/exec';
  let isOpen = false;
  let conversationHistory = [];
  const MAX_HISTORY = 10;
  function toggleChat() {
    isOpen = !isOpen;
    if (isOpen) {
      chatInterface.style.display = 'flex';
      setTimeout(() => { chatInterface.classList.add('open'); }, 10);
      chatButton.classList.add('active');
      chatButton.innerHTML = '<span style="transform: rotate(45deg); display: inline-block;">âœ•</span>';
      setTimeout(() => chatInput.focus(), 300);
    } else {
      chatInterface.classList.remove('open');
      chatButton.classList.remove('active');
      chatButton.innerHTML = '<span class="chat-icon">ðŸ’¬</span>';
      setTimeout(() => { if (!isOpen) chatInterface.style.display = 'none'; }, 300);
    }
  }
  chatButton.addEventListener('click', toggleChat);
  chatClose.addEventListener('click', toggleChat);
  function sendMessage() {
    const message = chatInput.value.trim();
    if (!message || chatSend.disabled) return;
    addMessage('user', message);
    chatInput.value = '';
    chatSend.disabled = true;
    showTyping();
    const callbackName = 'chatCallback_' + Date.now();
    const script = document.createElement('script');
    script.src = `${API_URL}?action=chat&query=${encodeURIComponent(message)}&history=${encodeURIComponent(JSON.stringify(conversationHistory))}&format=jsonp&callback=${callbackName}`;
    window[callbackName] = function(response) {
      hideTyping();
      let assistantResponse = '';
      if (response && response.answer) {
        assistantResponse = response.answer;
        addMessage('assistant', assistantResponse);
      } else if (response && response.error) {
        assistantResponse = 'I apologize, but I encountered an error. Please try again or call us at 561-247-0018 for immediate assistance.';
        addMessage('assistant', assistantResponse);
        console.error('Chat API error:', response.error);
      } else {
        assistantResponse = 'I apologize, but I couldn\'t generate a response. Please try again or call us at 561-247-0018 for help.';
        addMessage('assistant', assistantResponse);
      }
      conversationHistory.push({user: message, assistant: assistantResponse});
      if (conversationHistory.length > MAX_HISTORY) {
        conversationHistory = conversationHistory.slice(-MAX_HISTORY);
      }
      document.head.removeChild(script);
      delete window[callbackName];
    };
    script.onerror = function() {
      hideTyping();
      const errorResponse = 'I\'m having trouble connecting right now. Please try again or call us directly at 561-247-0018 for assistance.';
      addMessage('assistant', errorResponse);
      conversationHistory.push({user: message, assistant: errorResponse});
      if (conversationHistory.length > MAX_HISTORY) {
        conversationHistory = conversationHistory.slice(-MAX_HISTORY);
      }
      document.head.removeChild(script);
      delete window[callbackName];
    };
    setTimeout(() => {
      if (window[callbackName]) {
        hideTyping();
        const timeoutResponse = 'Request timed out. Please call us at 561-247-0018 for immediate assistance.';
        addMessage('assistant', timeoutResponse);
        conversationHistory.push({user: message, assistant: timeoutResponse});
        if (conversationHistory.length > MAX_HISTORY) {
          conversationHistory = conversationHistory.slice(-MAX_HISTORY);
        }
        document.head.removeChild(script);
        delete window[callbackName];
      }
    }, 15000);
    document.head.appendChild(script);
  }
  function addMessage(sender, content) {
    const welcomeMsg = chatMessages.querySelector('.welcome-message');
    if (welcomeMsg) welcomeMsg.remove();
    const messageDiv = document.createElement('div');
    messageDiv.className = `message ${sender}`;
    const avatar = document.createElement('div');
    avatar.className = 'message-avatar';
    avatar.textContent = sender === 'user' ? 'ðŸ‘¤' : 'ðŸ¤–';
    const bubble = document.createElement('div');
    bubble.className = 'message-bubble';
    const paragraphs = content.split('\n').filter(p => p.trim());
    if (paragraphs.length > 1) {
      bubble.innerHTML = paragraphs.map(p => p.trim()).join('<br>');
    } else {
      bubble.textContent = content;
    }
    messageDiv.appendChild(avatar);
    messageDiv.appendChild(bubble);
    chatMessages.appendChild(messageDiv);
    chatMessages.scrollTop = chatMessages.scrollHeight;
  }
  function showTyping() {
    typingIndicator.style.display = 'block';
    chatMessages.scrollTop = chatMessages.scrollHeight;
  }
  function hideTyping() {
    typingIndicator.style.display = 'none';
    chatSend.disabled = false;
  }
  chatSend.addEventListener('click', sendMessage);
  chatInput.addEventListener('keypress', function(e) {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      sendMessage();
    }
  });
  document.addEventListener('click', function(e) {
    if (isOpen && !chatInterface.contains(e.target) && !chatButton.contains(e.target)) {
      // Uncomment the next line if you want to close chat when clicking outside
      // toggleChat();
    }
  });
})();
</script>

<div class="invisible-spacer"></div>

</body>
</html>