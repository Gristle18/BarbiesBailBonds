<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Check In ‚Ä¢ Barbie's Bail Bonds</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: system-ui, -apple-system, sans-serif;
            background: #000000;
            color: white;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            max-width: 500px;
            width: 100%;
            text-align: center;
        }

        h1 {
            color: #F28C00;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #ccc;
            margin-bottom: 40px;
            font-size: 1.1rem;
        }

        .camera-section {
            background: #111;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            border: 2px dashed #333;
        }

        #video {
            width: 100%;
            max-width: 300px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        #canvas {
            display: none;
        }

        .photo-preview {
            width: 100%;
            max-width: 300px;
            border-radius: 8px;
            margin: 20px auto;
            display: none;
        }

        .btn {
            background: #F28C00;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.1rem;
            cursor: pointer;
            margin: 10px;
            transition: background-color 0.3s;
        }

        .btn:hover {
            background: #D67700;
        }

        .btn:disabled {
            background: #666;
            cursor: not-allowed;
        }

        .location-info {
            background: #111;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            text-align: left;
        }

        .location-info h3 {
            color: #F28C00;
            margin-bottom: 10px;
        }

        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            display: none;
        }

        .success {
            background: #1a5d1a;
            color: #90EE90;
        }

        .error {
            background: #5d1a1a;
            color: #ffcccb;
        }

        .phone-link {
            color: #F28C00;
            text-decoration: none;
            font-weight: bold;
        }

        .instructions {
            color: #ccc;
            margin: 20px 0;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Check In</h1>
        <p class="subtitle">Take a photo to verify your location and check in</p>

        <div class="instructions">
            <p>This check-in requires a photo and location verification for compliance with your bond requirements.</p>
        </div>

        <div class="camera-section">
            <video id="video" autoplay playsinline></video>
            <canvas id="canvas"></canvas>
            <img id="photoPreview" class="photo-preview" alt="Photo preview">

            <div id="cameraControls">
                <button id="startCamera" class="btn">Start Camera</button>
                <button id="takePhoto" class="btn" style="display: none;">Take Photo</button>
                <button id="retakePhoto" class="btn" style="display: none;">Retake Photo</button>
            </div>
        </div>

        <div id="locationInfo" class="location-info" style="display: none;">
            <h3>üìç Location Captured</h3>
            <p id="locationText">Getting location...</p>
            <p id="accuracyText"></p>
        </div>

        <button id="submitCheckin" class="btn" style="display: none;">Submit Check-In</button>

        <div id="statusMessage" class="status"></div>

        <p style="margin-top: 30px;">
            Need help? Call us 24/7 at <a href="tel:561-247-0018" class="phone-link">561-247-0018</a>
        </p>
    </div>

    <script>
        let video, canvas, ctx;
        let photoTaken = false;
        let locationData = null;
        let stream = null;

        document.addEventListener('DOMContentLoaded', function() {
            video = document.getElementById('video');
            canvas = document.getElementById('canvas');
            ctx = canvas.getContext('2d');

            document.getElementById('startCamera').addEventListener('click', startCamera);
            document.getElementById('takePhoto').addEventListener('click', takePhoto);
            document.getElementById('retakePhoto').addEventListener('click', retakePhoto);
            document.getElementById('submitCheckin').addEventListener('click', submitCheckin);

            // Get location when page loads
            getLocation();
        });

        async function startCamera() {
            try {
                stream = await navigator.mediaDevices.getUserMedia({
                    video: { facingMode: 'user' },
                    audio: false
                });

                video.srcObject = stream;
                video.style.display = 'block';

                document.getElementById('startCamera').style.display = 'none';
                document.getElementById('takePhoto').style.display = 'inline-block';

            } catch (error) {
                showStatus('Camera access denied. Please allow camera access and try again.', 'error');
            }
        }

        function takePhoto() {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            ctx.drawImage(video, 0, 0);

            const photoData = canvas.toDataURL('image/jpeg', 0.8);

            document.getElementById('photoPreview').src = photoData;
            document.getElementById('photoPreview').style.display = 'block';

            video.style.display = 'none';
            document.getElementById('takePhoto').style.display = 'none';
            document.getElementById('retakePhoto').style.display = 'inline-block';

            photoTaken = true;
            checkSubmitReady();

            // Stop camera
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
            }
        }

        function retakePhoto() {
            document.getElementById('photoPreview').style.display = 'none';
            document.getElementById('retakePhoto').style.display = 'none';

            photoTaken = false;
            checkSubmitReady();

            startCamera();
        }

        function getLocation() {
            if (!navigator.geolocation) {
                showStatus('Geolocation is not supported by this browser.', 'error');
                return;
            }

            navigator.geolocation.getCurrentPosition(
                function(position) {
                    locationData = {
                        latitude: position.coords.latitude,
                        longitude: position.coords.longitude,
                        accuracy: position.coords.accuracy,
                        timestamp: new Date().toISOString()
                    };

                    document.getElementById('locationInfo').style.display = 'block';
                    document.getElementById('locationText').textContent =
                        `Lat: ${position.coords.latitude.toFixed(6)}, Lon: ${position.coords.longitude.toFixed(6)}`;
                    document.getElementById('accuracyText').textContent =
                        `Accuracy: ${Math.round(position.coords.accuracy)} meters`;

                    checkSubmitReady();
                },
                function(error) {
                    let message = 'Location access denied. ';
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            message += 'Please allow location access and refresh the page.';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            message += 'Location information is unavailable.';
                            break;
                        case error.TIMEOUT:
                            message += 'Location request timed out.';
                            break;
                    }
                    showStatus(message, 'error');
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 300000
                }
            );
        }

        function checkSubmitReady() {
            if (photoTaken && locationData) {
                document.getElementById('submitCheckin').style.display = 'inline-block';
            }
        }

        async function submitCheckin() {
            const submitBtn = document.getElementById('submitCheckin');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';

            try {
                const checkinData = {
                    photo: canvas.toDataURL('image/jpeg', 0.8),
                    location: locationData,
                    timestamp: new Date().toISOString(),
                    userAgent: navigator.userAgent
                };

                // For now, just simulate submission
                console.log('Check-in data:', checkinData);

                // Simulate API call
                await new Promise(resolve => setTimeout(resolve, 2000));

                showStatus('‚úÖ Check-in successful! Your photo and location have been recorded.', 'success');

                // Reset the form
                setTimeout(() => {
                    location.reload();
                }, 3000);

            } catch (error) {
                console.error('Error submitting check-in:', error);
                showStatus('‚ùå Check-in failed. Please try again or call us directly.', 'error');

                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit Check-In';
            }
        }

        function showStatus(message, type) {
            const statusEl = document.getElementById('statusMessage');
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
            statusEl.style.display = 'block';

            statusEl.scrollIntoView({ behavior: 'smooth' });
        }
    </script>
</body>
</html>