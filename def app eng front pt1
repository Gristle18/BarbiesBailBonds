<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bond Application</title>
  <style>
    * { box-sizing: border-box; }
    body { margin:0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background:transparent; color:#fff; }
    .wrap { max-width: 880px; margin: 24px auto 40px; padding: 0 16px; }
    .section { margin: 28px 0; padding: 20px; display:none; background:transparent; }
    .section.active { display:block; }
    .grid { display:grid; grid-template-columns: 1fr 1fr; gap: 14px; }
    .full { grid-column: 1 / -1; }
    label { display:block; font-weight: 600; font-size: 14px; margin-bottom: 6px; }
    .req { color: #ff6666; margin-left: 2px; }
    input, textarea, select { width: 100%; padding: 12px; border: 1px solid #555; border-radius: 10px; font-size: 15px; background:#222; color:#fff; }
    textarea { min-height: 120px; resize: vertical; }
    .actions, .step-actions { display:flex; gap:10px; margin-top:20px; }
    button { border:0; border-radius:10px; padding:12px 16px; font-weight:700; cursor:pointer; }
    .primary { background:#F5A00D; color:#111; }
    .ghost { background:#444; color:#fff; }
    .error { color:#ff6666; font-size:14px; display:none; }
    .hint { color:#bbb; font-size:13px; margin-top:-6px; margin-bottom:10px; }
    .checks { display:flex; flex-direction:column; gap:10px; padding:12px; border:1px solid #555; border-radius:10px; background:#222; }
    .checks label { font-weight:500; display:flex; align-items:center; gap:10px; margin:0; }
    @media (max-width: 880px) { .grid { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <div class="wrap">
    <form id="f" novalidate>

      <!-- STEP 1: Intake (2 questions) -->
      <div class="section active" data-step="0">
        <div class="grid">
          <div class="full">
            <label for="whoAreYou">Who are you?<span class="req">*</span></label>
            <select id="whoAreYou" name="whoAreYou" required>
              <option value="" hidden>Select…</option>
              <option value="Indemnitor">Indemnitor — financial guarantor who promises the court the defendant will appear</option>
              <option value="Defendant">Defendant — the person in jail / being bonded</option>
            </select>
          </div>
          <div class="full">
            <label for="howHeard">How did you hear about us?</label>
            <input id="howHeard" name="howHeard" />
          </div>
        </div>
        <div class="step-actions">
          <button class="primary" type="button" data-next>Next</button>
        </div>
      </div>

      <!-- STEP 2A: Indemnitor (first 5) -->
      <div class="section" data-step="1">
        <div class="grid">
          <div>
            <label for="indemnitorName">Indemnitor's Complete Name<span class="req">*</span></label>
            <input id="indemnitorName" name="indemnitorName" required />
          </div>
          <div>
            <label for="relation">Your Relation to Person in Jail and/or Being Bonded?<span class="req">*</span></label>
            <input id="relation" name="relation" required />
          </div>
          <div>
            <label for="indemnitorDob">What is Your Date of Birth</label>
            <input id="indemnitorDob" name="indemnitorDob" type="date" />
          </div>
          <div>
            <label for="indemnitorSsn">Social Security #</label>
            <input id="indemnitorSsn" name="indemnitorSsn" inputmode="numeric" />
          </div>
          <div>
            <label for="indemnitorDl">Driver's License (or ID) #</label>
            <input id="indemnitorDl" name="indemnitorDl" />
          </div>
        </div>
        <div class="step-actions">
          <button class="ghost" type="button" data-back>Back</button>
          <button class="primary" type="button" data-next>Next</button>
        </div>
      </div>

      <!-- STEP 2B: Indemnitor (next 5) -->
      <div class="section" data-step="2">
        <div class="grid">
          <div>
            <label for="indemnitorCell">Cell Phone #<span class="req">*</span></label>
            <input id="indemnitorCell" name="indemnitorCell" type="tel" inputmode="tel" data-phone required />
          </div>
          <div>
            <label for="indemnitorHomePhone">Home Phone #</label>
            <input id="indemnitorHomePhone" name="indemnitorHomePhone" type="tel" inputmode="tel" data-phone />
          </div>
          <div>
            <label for="indemnitorEmail">Email Address</label>
            <input id="indemnitorEmail" name="indemnitorEmail" type="email" />
          </div>
          <div class="full">
            <label for="indemnitorAddress">Home Address</label>
            <input id="indemnitorAddress" name="indemnitorAddress" />
          </div>
          <div>
            <label for="indemnitorHowLong">How Long Living at Current Address</label>
            <input id="indemnitorHowLong" name="indemnitorHowLong" />
          </div>
        </div>
        <div class="step-actions">
          <button class="ghost" type="button" data-back>Back</button>
          <button class="primary" type="button" data-next>Next</button>
        </div>
      </div>

      <!-- STEP 2C: Indemnitor (final 5) -->
      <div class="section" data-step="3">
        <div class="grid">
          <div>
            <label for="indemnitorWorkType">Type of Work</label>
            <input id="indemnitorWorkType" name="indemnitorWorkType" />
          </div>
          <div>
            <label for="indemnitorEmployer">Employer Name</label>
            <input id="indemnitorEmployer" name="indemnitorEmployer" />
          </div>
          <div>
            <label for="indemnitorWorkPhone">Work Phone # (will NOT be called)</label>
            <input id="indemnitorWorkPhone" name="indemnitorWorkPhone" type="tel" inputmode="tel" data-phone />
          </div>
          <div class="full">
            <label for="indemnitorWorkAddress">Work Address</label>
            <input id="indemnitorWorkAddress" name="indemnitorWorkAddress" />
          </div>
          <div class="full">
            <label for="indemnitorVehicle">Indemnitor's Vehicle</label>
            <input id="indemnitorVehicle" name="indemnitorVehicle" />
          </div>
        </div>
        <div class="step-actions">
          <button class="ghost" type="button" data-back>Back</button>
          <button class="primary" type="button" data-next>Next</button>
        </div>
      </div>

      <!-- STEP 3A: Defendant (first 5) -->
      <div class="section" data-step="4">
        <div class="grid">
          <div>
            <label for="defendantName">Defendant’s Complete Name<span class="req">*</span></label>
            <input id="defendantName" name="defendantName" required />
          </div>
          <div>
            <label for="defendantNick">Nick Name of Defendant (If not actual name)</label>
            <input id="defendantNick" name="defendantNick" />
          </div>
          <div>
            <label for="defendantDob">Date of Birth</label>
            <input id="defendantDob" name="defendantDob" type="date" />
          </div>
          <div>
            <label for="defendantSsn">Social Security # (optional)</label>
            <input id="defendantSsn" name="defendantSsn" inputmode="numeric" />
          </div>
          <div>
            <label for="defendantDl">Driver's License or ID # (optional)</label>
            <input id="defendantDl" name="defendantDl" />
          </div>
        </div>
        <div class="step-actions">
          <button class="ghost" type="button" data-back>Back</button>
          <button class="primary" type="button" data-next>Next</button>
        </div>
      </div>

      <!-- STEP 3B: Defendant (next 5) -->
      <div class="section" data-step="5">
        <div class="grid">
          <div>
            <label for="birthCityState">City & State of Birth</label>
            <input id="birthCityState" name="birthCityState" />
          </div>
          <div>
            <label for="citizenship">Country of Citizenship</label>
            <input id="citizenship" name="citizenship" />
          </div>
          <div>
            <label for="race">Race</label>
            <select id="race" name="race">
              <option value="" hidden>Select…</option>
              <option>White</option>
              <option>Black / African American</option>
              <option>Hispanic / Latino</option>
              <option>Asian</option>
              <option>Native American</option>
              <option>Pacific Islander</option>
              <option>Other</option>
            </select>
          </div>
          <div>
            <label for="defendantCell">Cell Phone #</label>
            <input id="defendantCell" name="defendantCell" type="tel" inputmode="tel" data-phone />
          </div>
          <div>
            <label for="defendantHomePhone">Home Phone # (Skip if none)</label>
            <input id="defendantHomePhone" name="defendantHomePhone" type="tel" inputmode="tel" data-phone />
          </div>
        </div>
        <div class="step-actions">
          <button class="ghost" type="button" data-back>Back</button>
          <button class="primary" type="button" data-next>Next</button>
        </div>
      </div>

      <!-- STEP 3C: Defendant (next 5) -->
      <div class="section" data-step="6">
        <div class="grid">
          <div>
            <label for="defendantEmail">Email Address</label>
            <input id="defendantEmail" name="defendantEmail" type="email" />
          </div>
          <div class="full">
            <label for="defendantAddress">Home Address</label>
            <input id="defendantAddress" name="defendantAddress" />
          </div>
          <div>
            <label for="defendantHowLong">How Long has Defendant Lived at Current Address</label>
            <input id="defendantHowLong" name="defendantHowLong" />
          </div>
          <div>
            <label for="homeStatus">Is This Home Owned or Rented?</label>
            <select id="homeStatus" name="homeStatus">
              <option value="" hidden>Select…</option>
              <option>Owned</option>
              <option>Rented</option>
              <option>Other</option>
            </select>
          </div>
          <div class="full">
            <label for="landlordName">Name of Community / Landlord / Owner</label>
            <input id="landlordName" name="landlordName" />
          </div>
        </div>
        <div class="step-actions">
          <button class="ghost" type="button" data-back>Back</button>
          <button class="primary" type="button" data-next>Next</button>
        </div>
      </div>

      <!-- STEP 3D: Defendant (next 5) -->
      <div class="section" data-step="7">
        <div class="grid">
          <div>
            <label for="defendantWorkType">Defendant's Type of Work</label>
            <input id="defendantWorkType" name="defendantWorkType" />
          </div>
          <div>
            <label for="defendantEmployer">Defendant's Employer Name</label>
            <input id="defendantEmployer" name="defendantEmployer" />
          </div>
          <div>
            <label for="defendantWorkPhone">Defendant's Work Phone # (will NOT be called)</label>
            <input id="defendantWorkPhone" name="defendantWorkPhone" type="tel" inputmode="tel" data-phone />
          </div>
          <div class="full">
            <label for="defendantWorkAddress">Defendant's Work Address</label>
            <input id="defendantWorkAddress" name="defendantWorkAddress" />
          </div>
          <div class="full">
            <label for="recentArrest">Defendant's Most Recent Arrest (Not including the Current Arrest)</label>
            <textarea id="recentArrest" name="recentArrest"></textarea>
          </div>
        </div>
        <div class="step-actions">
          <button class="ghost" type="button" data-back>Back</button>
          <button class="primary" type="button" data-next>Next</button>
        </div>
      </div>

      <!-- STEP 3E: Defendant (final 2 -> still <=5) -->
      <div class="section" data-step="8">
        <div class="grid">
          <div class="full">
            <label>Please Select or Tap with your Finger ONLY if the answer is "Yes":</label>
            <div class="hint">These questions are about the person being bonded</div>
            <div class="checks">
              <label><input type="checkbox" id="q_fta" name="q_fta" value="Yes"> Has Failed to Appear for Court in the Past?</label>
              <label><input type="checkbox" id="q_supervision" name="q_supervision" value="Yes"> Is Currently on Probation, Parole, or SOR?</label>
              <label><input type="checkbox" id="q_otherBond" name="q_otherBond" value="Yes"> Is Currently on Bond for Another Case?</label>
            </div>
          </div>
          <div class="full">
            <label for="defendantVehicle">Defendant's Vehicle to get to Court</label>
            <input id="defendantVehicle" name="defendantVehicle" />
          </div>
        </div>
        <div class="step-actions">
          <button class="ghost" type="button" data-back>Back</button>
          <button class="primary" type="button" data-next>Next</button>
        </div>
      </div>

      <!-- STEP 4A: Relationship (5) -->
      <div class="section" data-step="9">
        <div class="grid">
          <div>
            <label for="relationshipStatus">Relationship Status</label>
            <select id="relationshipStatus" name="relationshipStatus">
              <option value="" hidden>Select…</option>
              <option>Single</option>
              <option>Married</option>
              <option>Domestic Partnership</option>
              <option>Separated</option>
              <option>Divorced</option>
              <option>Widowed</option>
            </select>
          </div>
          <div>
            <label for="partnerName">Full Name of Defendant's Partner</label>
            <input id="partnerName" name="partnerName" />
          </div>
          <div>
            <label for="partnerDob">Partner Date of Birth</label>
            <input id="partnerDob" name="partnerDob" type="date" />
          </div>
          <div>
            <label for="partnerCell">Cell Phone # of Partner</label>
            <input id="partnerCell" name="partnerCell" type="tel" inputmode="tel" data-phone />
          </div>
          <div>
            <label for="partnerWorkType">Partner Type of Work</label>
            <input id="partnerWorkType" name="partnerWorkType" />
          </div>
        </div>
        <div class="step-actions">
          <button class="ghost" type="button" data-back>Back</button>
          <button class="primary" type="button" data-next>Next</button>
        </div>
      </div>

      <!-- STEP 4B: Relationship (1) -->
      <div class="section" data-step="10">
        <div class="grid">
          <div class="full">
            <label for="partnerWorkName">Partner Work Name</label>
            <input id="partnerWorkName" name="partnerWorkName" />
          </div>
        </div>
        <div class="step-actions">
          <button class="ghost" type="button" data-back>Back</button>
          <button class="primary" type="button" data-next>Next</button>
        </div>
      </div>

      <!-- STEP 5A: Parents (5) -->
      <div class="section" data-step="11">
        <div class="grid">
          <div>
            <label for="motherName">Mother's Name</label>
            <input id="motherName" name="motherName" />
          </div>
          <div>
            <label for="motherPhone">Mother's Phone #</label>
            <input id="motherPhone" name="motherPhone" type="tel" inputmode="tel" data-phone />
          </div>
          <div class="full">
            <label for="motherAddress">Mother's Home Address</label>
            <input id="motherAddress" name="motherAddress" />
          </div>
          <div>
            <label for="fatherName">Father's Name</label>
            <input id="fatherName" name="fatherName" />
          </div>
          <div>
            <label for="fatherPhone">Father's Phone #</label>
            <input id="fatherPhone" name="fatherPhone" type="tel" inputmode="tel" data-phone />
          </div>
        </div>
        <div class="step-actions">
          <button class="ghost" type="button" data-back>Back</button>
          <button class="primary" type="button" data-next>Next</button>
        </div>
      </div>

      <!-- STEP 5B: Parents (1) -->
      <div class="section" data-step="12">
        <div class="grid">
          <div class="full">
            <label for="fatherAddress">Father's Home Address</label>
            <input id="fatherAddress" name="fatherAddress" />
          </div>
        </div>
        <div class="step-actions">
          <button class="ghost" type="button" data-back>Back</button>
          <button class="primary" type="button" data-next>Next</button>
        </div>
      </div>

      <!-- STEP 6: Siblings (4) -->
      <div class="section" data-step="13">
        <div class="grid">
          <div>
            <label for="sibling1Name">1. Brother/Sister's Name</label>
            <input id="sibling1Name" name="sibling1Name" />
          </div>
          <div>
            <label for="sibling1Phone">1. Brother/Sister's Phone #</label>
            <input id="sibling1Phone" name="sibling1Phone" type="tel" inputmode="tel" data-phone />
          </div>
          <div>
            <label for="sibling2Name">2. Brother/Sister's Name</label>
            <input id="sibling2Name" name="sibling2Name" />
          </div>
          <div>
            <label for="sibling2Phone">2. Brother/Sister's Phone #</label>
            <input id="sibling2Phone" name="sibling2Phone" type="tel" inputmode="tel" data-phone />
          </div>
        </div>
        <div class="step-actions">
          <button class="ghost" type="button" data-back>Back</button>
          <button class="primary" type="button" data-next>Next</button>
        </div>
      </div>

      <!-- STEP 7A: References (5) -->
      <div class="section" data-step="14">
        <div class="grid">
          <div>
            <label for="ref1Name">Reference #1 - Full Name</label>
            <input id="ref1Name" name="ref1Name" />
          </div>
          <div>
            <label for="ref1Relation">Reference #1 - Relation</label>
            <input id="ref1Relation" name="ref1Relation" />
          </div>
          <div>
            <label for="ref1Phone">Reference #1 - Phone #</label>
            <input id="ref1Phone" name="ref1Phone" type="tel" inputmode="tel" data-phone />
          </div>
          <div>
            <label for="ref2Name">Reference #2 - Full Name</label>
            <input id="ref2Name" name="ref2Name" />
          </div>
          <div>
            <label for="ref2Relation">Reference #2 - Relation</label>
            <input id="ref2Relation" name="ref2Relation" />
          </div>
        </div>
        <div class="step-actions">
          <button class="ghost" type="button" data-back>Back</button>
          <button class="primary" type="button" data-next>Next</button>
        </div>
      </div>

      <!-- STEP 7B: References (4) -->
      <div class="section" data-step="15">
        <div class="grid">
          <div>
            <label for="ref2Phone">Reference #2 - Phone #</label>
            <input id="ref2Phone" name="ref2Phone" type="tel" inputmode="tel" data-phone />
          </div>
          <div>
            <label for="ref3Name">Reference #3 - Full Name</label>
            <input id="ref3Name" name="ref3Name" />
          </div>
          <div>
            <label for="ref3Relation">Reference #3 - Relation</label>
            <input id="ref3Relation" name="ref3Relation" />
          </div>
          <div>
            <label for="ref3Phone">Reference #3 - Phone #</label>
            <input id="ref3Phone" name="ref3Phone" type="tel" inputmode="tel" data-phone />
          </div>
        </div>
        <div class="step-actions">
          <button class="ghost" type="button" data-back>Back</button>
          <button class="primary" type="button" data-next>Next</button>
        </div>
      </div>

      <!-- STEP 8A: Emergency Contacts (5) -->
      <div class="section" data-step="16">
        <div class="grid">
          <div>
            <label for="emergency1Name">Emergency Contact #1 (REQUIRED)</label>
            <input id="emergency1Name" name="emergency1Name" required />
          </div>
          <div>
            <label for="emergency1Phone">Emergency #1 Phone<span class="req">*</span></label>
            <input id="emergency1Phone" name="emergency1Phone" type="tel" inputmode="tel" data-phone required />
          </div>
          <div class="full">
            <label for="emergency1Relation">Emergency #1 Relation</label>
            <input id="emergency1Relation" name="emergency1Relation" />
          </div>
          <div>
            <label for="emergency2Name">Emergency Contact #2 (REQUIRED)</label>
            <input id="emergency2Name" name="emergency2Name" required />
          </div>
          <div>
            <label for="emergency2Phone">Emergency #2 Phone<span class="req">*</span></label>
            <input id="emergency2Phone" name="emergency2Phone" type="tel" inputmode="tel" data-phone required />
          </div>
        </div>
        <div class="step-actions">
          <button class="ghost" type="button" data-back>Back</button>
          <button class="primary" type="button" data-next>Next</button>
        </div>
      </div>

      <!-- STEP 8B: Emergency Contacts (1) -->
      <div class="section" data-step="17">
        <div class="grid">
          <div class="full">
            <label for="emergency2Relation">Emergency #2 Relation</label>
            <input id="emergency2Relation" name="emergency2Relation" />
          </div>
        </div>
        <div class="step-actions">
          <button class="ghost" type="button" data-back>Back</button>
          <button class="primary" type="button" data-next>Next</button>
        </div>
      </div>

      <!-- STEP 9: Agreement (1) -->
      <div class="section" data-step="18">
        <div class="grid">
          <div class="full">
            <label for="agreeName">BY TYPING YOUR NAME AND SUBMITTING BELOW YOU AGREE TO ALL THE ABOVE TERMS AND CONDITIONS AND THAT THE INFORMATION IS ENTIRELY CORRECT AND TRUE AND THAT YOU ARE THE PERSON SUBMITTING THE APPLICATION.<span class="req">*</span></label>
            <input id="agreeName" name="agreeName" required />
          </div>
        </div>
        <div class="actions">
          <button class="ghost" type="button" data-back>Back</button>
          <button class="primary" id="submitBtn" type="submit">Submit</button>
          <button class="ghost" type="button" id="resetBtn">Clear</button>
          <div class="error" id="err">Please fill the required fields in this step.</div>
        </div>
      </div>

    </form>
  </div>

  <script>
    // Wizard logic
    const sections = Array.from(document.querySelectorAll('.section'));

    function showStep(idx){
      sections.forEach((s,i)=>{ s.classList.toggle('active', i===idx); });
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function validateStep(idx){
      const step = sections[idx];
      const fields = step.querySelectorAll('input, select, textarea');
      for (const el of fields) {
        if (!el.checkValidity()) { el.reportValidity(); return false; }
      }
      return true;
    }

    sections.forEach((sec, idx) => {
      const nextBtn = sec.querySelector('[data-next]');
      if (nextBtn) {
        nextBtn.addEventListener('click', () => {
          if (!validateStep(idx)) return;
          const next = idx + 1;
          if (next < sections.length) showStep(next);
        });
      }
      const backBtn = sec.querySelector('[data-back]');
      if (backBtn) {
        backBtn.addEventListener('click', () => {
          const prev = idx - 1;
          if (prev >= 0) showStep(prev);
        });
      }
    });

    // Start
    showStep(0);

    // Phone mask: digits -> (XXX) XXX-XXXX
    document.querySelectorAll('input[data-phone]').forEach(el => {
      el.addEventListener('blur', () => {
        const d = (el.value || '').replace(/[^0-9]/g, '');
        if (d.length === 10) el.value = `(${d.slice(0,3)}) ${d.slice(3,6)}-${d.slice(6)}`;
      });
    });

    // Submit
    const f = document.getElementById('f');
    const err = document.getElementById('err');
    const submitBtn = document.getElementById('submitBtn');

    f.addEventListener('submit', (e) => {
      e.preventDefault();
      if (!validateStep(sections.length - 1)) { err && (err.style.display = 'block'); return; }
      if (!f.checkValidity()) { f.reportValidity(); return; }

      submitBtn.disabled = true;
      const data = Object.fromEntries(new FormData(f).entries());

      if (window.google && google.script && google.script.run) {
        google.script.run
          .withSuccessHandler(() => { submitBtn.disabled = false; alert('Submitted!'); f.reset(); showStep(0); })
          .withFailureHandler(e => { submitBtn.disabled = false; alert(e && e.message ? e.message : 'Submission failed'); })
          .submitToSheet(data);
      } else {
        console.log('Dev mode: payload', data);
        setTimeout(() => { submitBtn.disabled = false; alert('Submitted!'); f.reset(); showStep(0); }, 300);
      }
    });

    document.getElementById('resetBtn')?.addEventListener('click', () => { f.reset(); showStep(0); });
  </script>
</body>
</html>
