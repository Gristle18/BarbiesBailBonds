<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>About Us ‚Ä¢ Barbie's Bail Bonds | 30+ Years Serving Florida</title>
    <style>
        :root {
            --brand: #F28C00;
            --brand-dark: #D67700;
            --dark: #111;
            --muted: #666;
            --light-gray: #eee;
            --white: #fff;
            --cream: #fff2d1;
            --black: #000;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
            line-height: 1.6;
            color: var(--dark);
            background: var(--white);
            /* Hide scrollbar but keep scrolling functionality */
            overflow: -moz-scrollbars-none; /* Firefox */
            -ms-overflow-style: none; /* IE/Edge */
        }
        
        /* Hide webkit scrollbar */
        body::-webkit-scrollbar {
            width: 0px;
            background: transparent;
        }
        
        /* Invisible spacer to double page height */
        .invisible-spacer {
            height: 200vh;
            width: 100%;
            background: #000000;
            visibility: visible;
            pointer-events: none;
        }

        /* Remove focus outline and prevent text editing cursor */
        * {
            outline: none;
            cursor: default;
        }

        /* Restore pointer cursor for interactive elements */
        a, button {
            cursor: pointer;
        }

        /* Hero Section - Dark Background with Overlay */
        .hero-section {
            background: linear-gradient(135deg, var(--dark) 0%, #000 100%);
            color: var(--white);
            padding: 80px 20px;
            text-align: left;
            position: relative;
            overflow: hidden;
        }

        .hero-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.4);
            z-index: 1;
        }

        .hero-content {
            position: relative;
            z-index: 2;
            max-width: 1200px;
            margin: 0 auto;
        }

        .main-title {
            font-size: 48px;
            font-weight: 800;
            margin-bottom: 20px;
            color: var(--white);
        }

        .hero-subtitle {
            font-size: 20px;
            line-height: 1.6;
            margin-bottom: 30px;
            color: rgba(255, 255, 255, 0.9);
            max-width: 600px;
        }

        .hero-cta {
            background: var(--brand);
            color: var(--white);
            padding: 15px 30px;
            font-size: 18px;
            font-weight: 600;
            text-decoration: none;
            border-radius: 6px;
            display: inline-block;
            transition: background-color 0.3s ease;
            white-space: nowrap;
        }

        .hero-cta:hover {
            background: var(--brand-dark);
        }

        /* Feature Cards Section */
        .features-section {
            background: var(--white);
            padding: 60px 20px;
        }

        .features-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .features-title {
            text-align: center;
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 50px;
            color: var(--dark);
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
        }

        .feature-card {
            background: var(--brand);
            color: var(--white);
            padding: 40px 30px;
            text-align: center;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(242, 140, 0, 0.3);
        }

        .feature-icon {
            font-size: 48px;
            margin-bottom: 20px;
            display: block;
        }

        .feature-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .feature-text {
            font-size: 16px;
            line-height: 1.5;
            opacity: 0.95;
        }

        /* Main Content Area - Two Column */
        .main-content {
            background: var(--white);
            padding: 60px 20px;
        }

        .content-container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 50px;
        }

        .content-main {
            font-size: 16px;
            line-height: 1.7;
            color: var(--white);
            background: var(--black);
            padding: 40px;
            border-radius: 8px;
        }

        .content-main p {
            margin-bottom: 20px;
        }

        .content-sidebar {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 8px;
            height: fit-content;
        }

        .sidebar-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--dark);
        }

        .sidebar-info {
            font-size: 16px;
            line-height: 1.6;
            color: var(--dark);
        }

        .sidebar-info p {
            margin-bottom: 15px;
        }

        .sidebar-phone {
            background: var(--brand);
            color: var(--white);
            padding: 15px 20px;
            text-align: center;
            border-radius: 6px;
            font-size: 24px;
            font-weight: 700;
            margin: 20px 0;
            text-decoration: none;
            display: block;
            white-space: nowrap;
        }

        .sidebar-phone:hover {
            background: var(--brand-dark);
        }

        /* Reviews Section */
        .bbb-reviews {
            margin: 60px 0;
            padding: 0 20px;
            background: var(--white);
        }
        
        .bbb-title {
            font-weight: 700;
            margin: 20px 0 40px;
            font-size: 36px;
            text-align: center;
            color: var(--dark);
        }

        .bbb-marquee {
            overflow: hidden;
            position: relative;
        }
        
        .bbb-track {
            display: flex;
            gap: 12px;
            width: max-content;
            will-change: transform;
        }

        .bbb-card {
            border: 1px solid var(--light-gray);
            border-radius: 16px;
            box-shadow: 0 4px 14px rgba(0,0,0,.06);
            padding: 16px;
            background: var(--white);
            flex: 0 0 clamp(260px, 60vw, 360px);
        }
        
        .bbb-stars {
            color: var(--brand);
            font-size: 18px;
            letter-spacing: 2px;
        }
        
        .bbb-text {
            margin: 8px 0 10px;
            line-height: 1.45;
            font-style: italic;
        }
        
        .bbb-meta {
            font-size: 13px;
            color: var(--muted);
        }

        @media (prefers-reduced-motion: reduce) {
            .bbb-marquee {
                overflow: auto;
            }
        }

        /* Process Steps Section */
        .process-section {
            background: var(--white);
            padding: 60px 20px;
        }

        .process-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .process-title {
            text-align: center;
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 50px;
            color: var(--dark);
        }

        .process-steps {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 40px;
        }

        .process-step {
            text-align: center;
            padding: 30px;
        }

        .step-number {
            background: var(--brand);
            color: var(--white);
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 700;
            margin: 0 auto 20px;
        }

        .step-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--dark);
        }

        .step-description {
            font-size: 16px;
            line-height: 1.6;
            color: var(--muted);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .main-title {
                font-size: 36px;
            }

            .hero-subtitle {
                font-size: 18px;
            }

            .content-container {
                grid-template-columns: 1fr;
                gap: 30px;
            }

            .features-grid,
            .testimonials-grid,
            .process-steps {
                grid-template-columns: 1fr;
            }
        }

        /* Chatbot Styles */
        .chat-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }

        .chat-button {
            width: clamp(60px, 9vw, 84px);
            height: clamp(60px, 9vw, 84px);
            background: linear-gradient(135deg, #F28C00, #D67700);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: clamp(22px, 4vw, 30px);
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 15px rgba(242, 140, 0, 0.4);
            transition: all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
            animation: pulse 2s infinite;
        }

        .chat-button:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(242, 140, 0, 0.6);
        }

        .chat-button.active {
            transform: rotate(45deg);
            background: #666;
        }

        @keyframes pulse {
            0% { box-shadow: 0 4px 15px rgba(242, 140, 0, 0.4); }
            50% { box-shadow: 0 4px 15px rgba(242, 140, 0, 0.7); }
            100% { box-shadow: 0 4px 15px rgba(242, 140, 0, 0.4); }
        }

        .chat-interface {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 350px;
            height: 500px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.2);
            display: none;
            flex-direction: column;
            transform: scale(0.8);
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
            z-index: 999;
        }

        .chat-interface.open {
            transform: scale(1);
            opacity: 1;
        }

        .chat-header {
            background: linear-gradient(135deg, #F28C00, #D67700);
            color: white;
            padding: 20px;
            border-radius: 16px 16px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-title {
            font-size: 18px;
            font-weight: 600;
            margin: 0;
        }

        .chat-subtitle {
            font-size: 12px;
            opacity: 0.9;
            margin: 2px 0 0;
        }

        .chat-close {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.2s;
        }

        .chat-close:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .chat-messages {
            flex: 1;
            padding: 16px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .welcome-message {
            background: transparent;
            padding: 16px;
            border-radius: 0;
            font-size: 14px;
            line-height: 1.5;
            color: #333;
            border-left: none;
        }

        .message {
            display: flex;
            gap: 8px;
            animation: fadeIn 0.3s ease-out;
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            flex-shrink: 0;
        }

        .message.user .message-avatar {
            background: #F28C00;
            color: white;
        }

        .message.assistant .message-avatar {
            background: #f0f0f0;
            color: #666;
        }

        .message-content {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 0;
            font-size: 14px;
            line-height: 1.4;
            background: transparent;
        }

        .message.user .message-content {
            background: transparent;
            color: #333;
            border-bottom-right-radius: 0;
        }

        .message.assistant .message-content {
            background: transparent;
            color: #333;
            border-bottom-left-radius: 0;
        }

        .typing-indicator {
            display: none;
            padding: 16px;
            border-top: none;
            background: transparent;
        }

        .chat-input-area {
            padding: 16px;
            border-top: 1px solid #eee;
            display: flex;
            gap: 8px;
        }

        .chat-input {
            flex: 1;
            border: 1px solid #ddd;
            border-radius: 20px;
            padding: 8px 16px;
            font-size: 14px;
            outline: none;
            resize: none;
            max-height: 100px;
        }

        .chat-send {
            background: #F28C00;
            border: none;
            color: white;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transition: all 0.2s;
        }

        .chat-send:hover:not(:disabled) {
            background: #D67700;
            transform: scale(1.05);
        }

        .chat-send:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @media (max-width: 600px) {
            .chat-interface {
                height: 400px !important;
            }

            .chat-container {
                bottom: 20px;
                right: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Hero Section -->
    <div class="hero-section">
        <div class="hero-content">
            <h1 class="main-title">About Barbie's Bail Bonds</h1>
            <p class="hero-subtitle">
                Licensed Palm Beach bail bonds agency providing fast, reliable service in Palm Beach County Florida and throughout most counties in the state. Since 1993, our family agency has been helping families bond out their loved ones with 24-hour emergency service.
            </p>
            <a href="tel:561-247-0018" class="hero-cta">Call 561-247-0018</a>
        </div>
    </div>

    <!-- Features Section -->
    <div class="features-section">
        <div class="features-container">
            <h2 class="features-title">Why Clients Trust Barbie's Bail Bonds</h2>
            <div class="features-grid">
                <div class="feature-card">
                    <span class="feature-icon">üèÜ</span>
                    <h3 class="feature-title">30+ Years Experience</h3>
                    <p class="feature-text">Serving Florida families since 1993 with trusted, reliable bail bond services.</p>
                </div>
                <div class="feature-card">
                    <span class="feature-icon">üïí</span>
                    <h3 class="feature-title">24/7 Emergency Service</h3>
                    <p class="feature-text">Available around the clock for immediate assistance when you need us most.</p>
                </div>
                <div class="feature-card">
                    <span class="feature-icon">üåê</span>
                    <h3 class="feature-title">Bilingual Service</h3>
                    <p class="feature-text">Our licensed agents speak both English and Spanish to better serve our community.</p>
                </div>
                <div class="feature-card">
                    <span class="feature-icon">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</span>
                    <h3 class="feature-title">Local Palm Beach Experts</h3>
                    <p class="feature-text">A trusted family business committed to helping other families in their time of need.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content Area -->
    <div class="main-content">
        <div class="content-container">
            <div class="content-main">
                <p>
                    Barbie's Bail Bonds is a licensed Palm Beach bail bonds agency providing fast, reliable service in Palm Beach County Florida and throughout most counties in the state. Since 1993 our family agency has been helping families bond out their loved ones.
                </p>
                <p>
                    Whether it be from Palm Beach County's Gun Club Jail or any other detention facility in Florida where we have 24 hour emergency service. Our licensed agents speak English and Spanish to help with any questions.
                </p>
                <p>
                    At Barbie's Bail Bonds you will never have to worry about posting bail because we take care of everything. Our comprehensive services include Bail Bonds in Palm Beach Jail and most other Florida counties, allowing you to complete the ENTIRE Bail Bonds Process from home.
                </p>
                <p>
                    We handle both Felony and Misdemeanor Bail Bonds, as well as Walkthrough Bail Bonds (No Arrest). You can use our Online Bail Bond application for immediate service. We accept Cash, Zelle, Credit Cards, and even Bitcoin with guaranteed confidentiality and a 100% Money-Back Guarantee.
                </p>
                <p>
                    With over 30 years of experience serving Florida families since 1993, we provide trusted, reliable bail bond services. We're available around the clock for immediate assistance when you need us most. As a trusted family business committed to helping other families in their time of need, our licensed agents speak both English and Spanish to better serve our community.
                </p>
                <p>
                    Don't let your loved one stay in jail longer than necessary. Our experienced team is ready to help you through the bail process quickly and efficiently.
                </p>
            </div>
            <div class="content-sidebar">
                <h3 class="sidebar-title">Quick Contact</h3>
                <div class="sidebar-info">
                    <p><strong>24/7 Emergency Service</strong></p>
                    <p>Available around the clock for immediate assistance</p>
                    <a href="tel:561-247-0018" class="sidebar-phone">561-247-0018</a>
                    <p><strong>Service Areas:</strong></p>
                    <p>Palm Beach County, Florida and most counties statewide</p>
                    <p><strong>Languages:</strong></p>
                    <p>English and Spanish</p>
                    <p><strong>Payment Methods:</strong></p>
                    <p>Cash, Zelle, Credit Cards, Bitcoin</p>
                    <p><strong>Guarantee:</strong></p>
                    <p>100% Money-Back Guarantee with guaranteed confidentiality</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Reviews Section -->
    <div class="bbb-reviews">
        <h2 class="bbb-title">What Our Clients Are Saying</h2>
        <div class="bbb-marquee" aria-label="Client reviews scrolling">
            <div class="bbb-track" id="bbb-track">
                <div class="bbb-card">
                    <div class="bbb-content">
                        <div class="bbb-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                        <div class="bbb-text">"Professional and fast service. They helped us through a very difficult time with compassion and efficiency. Highly recommended!"</div>
                        <div class="bbb-meta">‚Äî Maria S. ‚Ä¢ West Palm Beach</div>
                    </div>
                </div>

                <div class="bbb-card">
                    <div class="bbb-content">
                        <div class="bbb-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                        <div class="bbb-text">"Available 24/7 when we needed them most. The bilingual service was crucial for our family. Thank you Barbie's Bail Bonds!"</div>
                        <div class="bbb-meta">‚Äî Carlos R. ‚Ä¢ Lake Worth</div>
                    </div>
                </div>

                <div class="bbb-card">
                    <div class="bbb-content">
                        <div class="bbb-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                        <div class="bbb-text">"30+ years of experience shows. They handled everything professionally and got our son released quickly. Grateful for their service."</div>
                        <div class="bbb-meta">‚Äî Jennifer L. ‚Ä¢ Boynton Beach</div>
                    </div>
                </div>

                <div class="bbb-card">
                    <div class="bbb-content">
                        <div class="bbb-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                        <div class="bbb-text">"They made the whole process so easy and stress-free. Quick response time and very professional staff. Would definitely recommend!"</div>
                        <div class="bbb-meta">‚Äî Robert T. ‚Ä¢ Delray Beach</div>
                    </div>
                </div>

                <div class="bbb-card">
                    <div class="bbb-content">
                        <div class="bbb-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                        <div class="bbb-text">"Excellent customer service and they walked us through every step. Their Spanish-speaking agent was incredibly helpful for our family."</div>
                        <div class="bbb-meta">‚Äî Elena M. ‚Ä¢ Boca Raton</div>
                    </div>
                </div>

                <div class="bbb-card">
                    <div class="bbb-content">
                        <div class="bbb-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                        <div class="bbb-text">"Fast response and very knowledgeable staff. They made a stressful situation much easier to handle. Thank you for everything!"</div>
                        <div class="bbb-meta">‚Äî Michael D. ‚Ä¢ Palm Beach Gardens</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Process Steps Section -->
    <div class="process-section">
        <div class="process-container">
            <h2 class="process-title">Our Simple 3-Step Process</h2>
            <div class="process-steps">
                <div class="process-step">
                    <div class="step-number">1</div>
                    <h3 class="step-title">Call Us</h3>
                    <p class="step-description">Contact us at 561-247-0018 immediately. We're available 24/7 for emergency bail bond services.</p>
                </div>
                <div class="process-step">
                    <div class="step-number">2</div>
                    <h3 class="step-title">We Handle Everything</h3>
                    <p class="step-description">Our experienced agents handle all the paperwork and legal requirements. You can complete the entire process from home.</p>
                </div>
                <div class="process-step">
                    <div class="step-number">3</div>
                    <h3 class="step-title">Your Loved One Gets Released</h3>
                    <p class="step-description">We work quickly to secure release from Palm Beach County Jail or any detention facility in Florida.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Chatbot Widget -->
    <div class="chat-container">
        <!-- Floating Chat Button -->
        <button class="chat-button" id="chatButton">
            <span class="chat-icon">üí¨</span>
        </button>
        
        <!-- Expandable Chat Interface -->
        <div class="chat-interface" id="chatInterface">
            <div class="chat-header">
                <div class="chat-title-area">
                    <div class="chat-title">AI Assistant</div>
                    <div class="chat-subtitle">Ask about bail bonds</div>
                </div>
                <button class="chat-close" id="chatClose">√ó</button>
            </div>
            
            <div class="chat-messages" id="chatMessages">
                <div class="welcome-message">
                    üëã Hi! I'm your AI assistant for <strong>Barbie's Bail Bonds</strong>.<br><br>
                    I can help you with questions about:
                    <br>‚Ä¢ Bail bond process
                    <br>‚Ä¢ Pricing and payment options  
                    <br>‚Ä¢ Required paperwork
                    <br>‚Ä¢ Service areas
                    <br>‚Ä¢ Emergency services<br><br>
                    How can I assist you today?
                </div>
            </div>
            
            <div class="typing-indicator" id="typingIndicator">
                <span>AI is typing...</span>
            </div>
            
            <div class="chat-input-area">
                <textarea class="chat-input" id="chatInput" placeholder="Type your question here..." rows="1"></textarea>
                <button class="chat-send" id="chatSend">‚û§</button>
            </div>
        </div>
    </div>

    <!-- Invisible spacer -->
    <div class="invisible-spacer"></div>

    <script>
        // Chatbot functionality
        const chatButton = document.getElementById('chatButton');
        const chatInterface = document.getElementById('chatInterface');
        const chatClose = document.getElementById('chatClose');
        const chatInput = document.getElementById('chatInput');
        const chatSend = document.getElementById('chatSend');
        const chatMessages = document.getElementById('chatMessages');
        const typingIndicator = document.getElementById('typingIndicator');

        const API_URL = 'https://script.google.com/macros/s/AKfycbwvJ8utZ62xKjZt2nz8wZnBJb5vbOsCD38RJnDZ0yFZGppsfWnmv7_YIuz5yV9lZz7z/exec';
        
        let isOpen = false;
        let conversationHistory = [];

        // Toggle chat interface
        function toggleChat() {
            isOpen = !isOpen;
            if (isOpen) {
                chatInterface.style.display = 'flex';
                setTimeout(() => {
                    chatInterface.classList.add('open');
                }, 10);
                chatButton.classList.add('active');
                chatButton.innerHTML = '<span style="transform: rotate(45deg); display: inline-block;">‚úï</span>';
                setTimeout(() => chatInput.focus(), 300);
            } else {
                chatInterface.classList.remove('open');
                chatButton.classList.remove('active');
                chatButton.innerHTML = '<span class="chat-icon">üí¨</span>';
                setTimeout(() => {
                    if (!isOpen) chatInterface.style.display = 'none';
                }, 300);
            }
        }

        chatButton.addEventListener('click', toggleChat);
        chatClose.addEventListener('click', toggleChat);

        // Send message function
        function sendMessage() {
            const message = chatInput.value.trim();
            if (!message || chatSend.disabled) return;

            // Add user message to chat
            addMessage(message, 'user');
            
            // Add to conversation history
            conversationHistory.push({
                role: 'user',
                content: message
            });

            // Clear input and disable send button
            chatInput.value = '';
            chatSend.disabled = true;
            
            // Show typing indicator
            typingIndicator.style.display = 'flex';
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Call API
            callChatAPI(message);
        }

        // Call chat API using JSONP
        function callChatAPI(message) {
            const timeout = setTimeout(() => {
                handleAPIError('Request timeout - our AI assistant is busy. Please try again or call 561-247-0018 for immediate assistance.');
            }, 30000); // 30 second timeout

            const callbackName = 'chatCallback_' + Date.now();
            const script = document.createElement('script');
            
            script.src = `${API_URL}?source=AboutUs_chatbot&action=chat&query=${encodeURIComponent(message)}&history=${encodeURIComponent(JSON.stringify(conversationHistory))}&format=jsonp&callback=${callbackName}`;

            window[callbackName] = function(response) {
                clearTimeout(timeout);
                
                try {
                    // Clean up
                    document.head.removeChild(script);
                    delete window[callbackName];
                    
                    // Hide typing indicator
                    typingIndicator.style.display = 'none';
                    
                    // Handle response
                    if (response && response.answer) {
                        const assistantResponse = response.answer;
                        addMessage(assistantResponse, 'assistant');
                        
                        // Add to conversation history
                        conversationHistory.push({
                            role: 'assistant',
                            content: assistantResponse
                        });
                        
                        // Keep conversation history manageable
                        if (conversationHistory.length > 10) {
                            conversationHistory = conversationHistory.slice(-8);
                        }
                    } else {
                        handleAPIError('I apologize, but I encountered an issue processing your request. Please call us at 561-247-0018 for immediate assistance.');
                    }
                } catch (error) {
                    console.error('Chat API Error:', error);
                    handleAPIError('I apologize, but I encountered an issue. Please call us at 561-247-0018 for immediate assistance.');
                }
                
                // Re-enable send button
                chatSend.disabled = false;
            };

            script.onerror = function() {
                clearTimeout(timeout);
                handleAPIError('Connection error. Please call us at 561-247-0018 for immediate assistance.');
            };

            document.head.appendChild(script);
        }

        function handleAPIError(message) {
            typingIndicator.style.display = 'none';
            addMessage(message, 'assistant');
            chatSend.disabled = false;
            
            // Clean up any lingering scripts
            try {
                const scripts = document.querySelectorAll('script[src*="' + API_URL.split('/')[5] + '"]');
                scripts.forEach(script => {
                    if (script.parentNode) script.parentNode.removeChild(script);
                });
            } catch (e) {
                console.log('Script cleanup completed');
            }
        }

        // Add message to chat
        function addMessage(message, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message', sender);
            
            const avatar = document.createElement('div');
            avatar.classList.add('message-avatar');
            avatar.textContent = sender === 'user' ? 'You' : 'AI';
            
            const content = document.createElement('div');
            content.classList.add('message-content');
            content.innerHTML = message.replace(/\n/g, '<br>');
            
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(content);
            chatMessages.appendChild(messageDiv);
            
            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Event listeners
        chatSend.addEventListener('click', sendMessage);
        chatInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // Auto-resize textarea
        chatInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight) + 'px';
        });

        // Reviews marquee animation
        (function(){
            const SPEED = 20; 
            const marquee = document.querySelector('.bbb-marquee');
            const track = document.getElementById('bbb-track');
            if (!marquee || !track) return;

            if (window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;

            const originals = Array.from(track.children);
            function totalWidth(){ return track.scrollWidth; }
            function needMore(){ return totalWidth() < marquee.clientWidth * 2; }
            while (needMore()) {
                for (const el of originals) track.appendChild(el.cloneNode(true));
            }

            let x = 0;
            let last = performance.now();
            let paused = false;
            const gap = parseFloat(getComputedStyle(track).gap || '0');

            marquee.addEventListener('mouseenter', () => paused = true);
            marquee.addEventListener('mouseleave', () => paused = false);

            function step(t){
                const dt = (t - last) / 1000; 
                last = t;
                if (!paused) {
                    x += SPEED * dt;
                    const cardWidth = track.children[0].offsetWidth + gap;
                    if (x >= cardWidth) x -= cardWidth;
                }
                track.style.transform = `translateX(-${x}px)`;
                requestAnimationFrame(step);
            }
            requestAnimationFrame(step);
        })();
    </script>
</body>
</html>