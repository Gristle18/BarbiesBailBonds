<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Barbie's Bail Bonds - Formulario de Solicitud</title>
  <style>
    * { box-sizing: border-box; }
    body { margin:0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background:transparent; color:#fff; overflow: -moz-scrollbars-none; -ms-overflow-style: none; }
    body::-webkit-scrollbar { width: 0px; background: transparent; }
    .invisible-spacer { height: 200vh; width: 100%; background: #000000; visibility: visible; pointer-events: none; }
    .wrap { max-width: 880px; margin: 24px auto 40px; padding: 0 16px; }
    .section { margin: 28px 0; padding: 20px; display:none; background:transparent; }
    .section.active { display:block; }
    .grid { display:grid; grid-template-columns: 1fr 1fr; gap: 14px; }
    .full { grid-column: 1 / -1; }
    label { display:block; font-weight: 600; font-size: 14px; margin-bottom: 6px; }
    .req { color: #ff6666; margin-left: 2px; }
    input, textarea, select { width: 100%; padding: 12px; border: 1px solid #555; border-radius: 10px; font-size: 15px; background:#222; color:#fff; }
    textarea { min-height: 120px; resize: vertical; }
    .actions, .step-actions { display:flex; gap:10px; margin-top:20px; }
    button { border:0; border-radius:10px; padding:12px 16px; font-weight:700; cursor:pointer; }
    .primary { background:#F5A00D; color:#111; }
    .ghost { background:#444; color:#fff; }
    .error { color:#ff6666; font-size:14px; display:none; }
    .hint { color:#bbb; font-size:13px; margin-top:-6px; margin-bottom:10px; }
    .checks { display:flex; flex-direction:column; gap:10px; margin-top: 10px; }
    .checks label { font-weight:500; display:flex; align-items:center; gap:10px; margin:0; cursor:pointer; }
    .checks input[type="checkbox"] { margin: 0; width: auto; flex-shrink: 0; }
    .agreement-text { white-space: pre-line; font-size:14px; line-height:1.4; color:#ddd; padding:20px; border:1px solid #555; border-radius:10px; background:#222; max-height: 400px; overflow-y: auto; }
    input[type="date"]::-webkit-calendar-picker-indicator { filter: invert(1); }
    .loading-indicator { display: none; text-align: center; margin: 20px 0; color: #F5A00D; font-weight: 600; }
    @media (max-width: 880px) { .grid { grid-template-columns: 1fr; } }

    /* Chatbot Widget Styles */
    .chat-container { position: fixed !important; top: 550px !important; right: clamp(12px, 3vw, 28px) !important; bottom: auto !important; left: auto !important; transform: none !important; z-index: 1000; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    @media (max-width: 1024px) { .chat-container { top: 525px !important; } }
    @media (max-width: 600px) { .chat-container { top: 500px !important; } }
    .chat-button { width: clamp(60px, 9vw, 84px); height: clamp(60px, 9vw, 84px); background: linear-gradient(135deg, #F28C00, #D67700); border: none; border-radius: 50%; color: white; font-size: clamp(22px, 4vw, 30px); cursor: pointer; display: flex; justify-content: center; align-items: center; box-shadow: 0 4px 15px rgba(242, 140, 0, 0.4); transition: all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1); animation: pulse 2s infinite; }
    .chat-button:hover { transform: scale(1.1); box-shadow: 0 6px 20px rgba(242, 140, 0, 0.6); }
    .chat-button.active { transform: rotate(45deg); background: #666; }
    @keyframes pulse { 0%, 100% { box-shadow: 0 4px 15px rgba(242, 140, 0, 0.4); } 50% { box-shadow: 0 4px 15px rgba(242, 140, 0, 0.8), 0 0 0 10px rgba(242, 140, 0, 0.1); } }
    .chat-interface { display: none; position: absolute; bottom: 80px; right: 0; width: 350px; height: 500px; background: white; border-radius: 12px; box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15); overflow: hidden; opacity: 0; transform: translateY(20px) scale(0.9); transition: all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1); }
    .chat-interface.open { display: flex; flex-direction: column; opacity: 1; transform: translateY(0) scale(1); }
    .chat-header { background: linear-gradient(135deg, #F28C00, #D67700); color: white; padding: 16px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(255,255,255,0.1); }
    .chat-title { font-size: 16px; font-weight: 600; margin: 0; }
    .chat-subtitle { font-size: 12px; opacity: 0.8; margin: 2px 0 0 0; }
    .chat-close { background: none; border: none; color: white; font-size: 18px; cursor: pointer; padding: 4px 8px; border-radius: 4px; transition: background 0.2s; }
    .chat-close:hover { background: rgba(255,255,255,0.2); }
    .chat-messages { flex: 1; overflow-y: auto; padding: 16px; background: #f8f9fa; scrollbar-width: thin; scrollbar-color: #ddd transparent; }
    .chat-messages::-webkit-scrollbar { width: 4px; }
    .chat-messages::-webkit-scrollbar-track { background: transparent; }
    .chat-messages::-webkit-scrollbar-thumb { background: #ddd; border-radius: 2px; }
    .chat-input-container { padding: 12px 16px; background: white; border-top: 1px solid #eee; display: flex; gap: 8px; align-items: flex-end; }
    .chat-input { flex: 1; padding: 8px 12px; border: 2px solid #eee; border-radius: 20px; font-size: 14px; outline: none; resize: none; max-height: 80px; transition: border-color 0.2s; }
    .chat-input:focus { border-color: #F28C00; }
    .chat-send { background: #F28C00; color: white; border: none; width: 36px; height: 36px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; font-size: 16px; }
    .chat-send:hover:not(:disabled) { background: #D67700; transform: scale(1.1); }
    .chat-send:disabled { background: #ccc; cursor: not-allowed; transform: none; }
    .message { margin-bottom: 12px; display: flex; gap: 8px; align-items: flex-end; }
    .message.user { flex-direction: row-reverse; }
    .message-bubble { max-width: 75%; padding: 10px 14px; border-radius: 18px; font-size: 14px; line-height: 1.4; word-wrap: break-word; }
    .message.assistant .message-bubble { background: white; color: #333; border-bottom-left-radius: 4px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .message.user .message-bubble { background: linear-gradient(135deg, #F28C00, #D67700); color: white; border-bottom-right-radius: 4px; }
    .message-avatar { width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; flex-shrink: 0; }
    .message.assistant .message-avatar { background: #F28C00; color: white; }
    .message.user .message-avatar { background: #666; color: white; }
    .welcome-message { text-align: center; color: #666; padding: 30px 20px; font-size: 14px; line-height: 1.6; }
    .typing-indicator { display: none; padding: 8px 16px; color: #666; font-size: 12px; font-style: italic; }
    .typing-dots { display: inline-flex; gap: 2px; margin-left: 4px; }
    .typing-dots span { width: 4px; height: 4px; background: #666; border-radius: 50%; animation: typing 1.4s infinite ease-in-out; }
    .typing-dots span:nth-child(1) { animation-delay: -0.32s; }
    .typing-dots span:nth-child(2) { animation-delay: -0.16s; }
    @keyframes typing { 0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; } 40% { transform: scale(1); opacity: 1; } }
    @media (max-width: 600px) { .chat-interface { height: 400px !important; } }
    @media (max-width: 480px) { .chat-interface { width: calc(100vw - 40px); height: calc(100vh - 120px); bottom: 80px; right: -10px; } .chat-container { bottom: 20px; right: 20px; } }
  </style>
</head>
<body>
  <div class="wrap">
    <!-- Progress Bar -->
    <div style="background:#fff; padding:20px; border-radius:12px; margin-bottom:30px;">
      <div style="color:#333; font-size:16px; font-weight:600; margin-bottom:10px; text-align:center;">Progreso de la Solicitud</div>
      <div style="background:#eee; height:8px; border-radius:4px; overflow:hidden;">
        <div id="progressBar" style="background:#F28C00; height:100%; width:0%; transition:width 0.3s ease;"></div>
      </div>
    </div>

    <form id="f" novalidate>

      <!-- STEP 1: ID Upload -->
      <div class="section active" data-step="0">
        <div style="text-align:center; margin-bottom:30px;">
          <h2 style="color:#fff; font-size:28px; margin-bottom:15px; font-weight:700;">üì∏ Subir su Identificaci√≥n<span class="req">*</span></h2>
          <p style="color:#fff; font-size:16px; line-height:1.5;">
            Por favor tome una foto del frente de su identificaci√≥n emitida por el gobierno.
          </p>
        </div>

        <div style="background:#fff; padding:30px; border-radius:12px; margin:20px 0;">
          <div style="font-size:18px; font-weight:600; margin-bottom:15px; color:#333; text-align:center;">Subir Su Identificaci√≥n</div>
          <div onclick="document.getElementById('idFront').click()" style="border:2px dashed #ddd; padding:40px 20px; border-radius:8px; background:#f9f9f9; min-height:160px; display:flex; flex-direction:column; justify-content:center; cursor:pointer; transition: all 0.3s ease; text-align:center;" onmouseover="this.style.background='#f0f0f0'; this.style.borderColor='#F28C00';" onmouseout="this.style.background='#f9f9f9'; this.style.borderColor='#ddd';">
            <div style="font-size:18px; margin-bottom:10px; color:#333; font-weight:600;">Clic para Subir ID</div>
            <input type="file" id="idFront" accept="image/*" style="display:none;" onchange="handleIDUpload(this, 'front')">
            <div style="font-size:14px; color:#666;">Solo JPG, PNG</div>
          </div>
          <div id="frontPreview" style="margin-top:10px; text-align:center;"></div>
        </div>

        <div style="background:#fff2d1; padding:20px; border-radius:8px; margin:20px 0; text-align:center;">
          <div style="color:#333; font-weight:600; margin-bottom:8px;">¬øTiene Problemas?</div>
          <div style="color:#666;">Env√≠e fotos directamente por texto a <span style="color:#F28C00; font-weight:600; white-space: nowrap;">561-247-0018</span> o llame al <a href="tel:+15612470018" style="color:#F28C00; text-decoration:none; white-space: nowrap;">561-247-0018</a></div>
        </div>

        <div id="idUploadError" class="error" style="text-align:center; margin-bottom:10px; font-size:16px;">
          Se requiere foto de identificaci√≥n para continuar.
        </div>
        <div class="step-actions">
          <button class="primary" type="button" data-next id="uploadNextBtn">Continuar</button>
        </div>
      </div>

      <!-- STEP 2: Intake (2 questions) -->
      <div class="section" data-step="1">
        <div class="grid">
          <div class="full">
            <label for="whoAreYou">¬øQui√©n es usted?<span class="req">*</span></label>
            <select id="whoAreYou" name="whoAreYou" required>
              <option value="" hidden>Seleccionar‚Ä¶</option>
              <option value="Indemnitor">Garante ‚Äî garant√≠a financiera que promete al tribunal que el acusado comparecer√°</option>
              <option value="Defendant">Acusado ‚Äî la persona en la c√°rcel / siendo afianzado</option>
            </select>
          </div>
          <div class="full">
            <label for="howHeard">¬øC√≥mo se enter√≥ de nosotros?<span class="req">*</span></label>
            <input id="howHeard" name="howHeard" required />
          </div>
        </div>
        <div class="step-actions">
          <button class="primary" type="button" data-next>Siguiente</button>
        </div>
      </div>

      <!-- STEP 2A: Indemnitor (first 5) -->
      <div class="section" data-step="1">
        <div class="section-info" style="margin-bottom:20px; color:#fff; font-size:14px; line-height:1.4; text-align:center; font-weight:bold;">
          Por favor proporcione la siguiente informaci√≥n sobre la persona que est√° afianzando a la persona arrestada.
        </div>
        <div class="grid">
          <div>
            <label for="indemnitorName">Nombre Completo del Garante<span class="req">*</span></label>
            <input id="indemnitorName" name="indemnitorName" required />
          </div>
          <div>
            <label for="relation">Su Relaci√≥n con la Persona en la C√°rcel y/o Siendo Afianzado?<span class="req">*</span></label>
            <input id="relation" name="relation" required />
          </div>
          <div>
            <label for="indemnitorDob">¬øCu√°l es Su Fecha de Nacimiento<span class="req">*</span></label>
            <input id="indemnitorDob" name="indemnitorDob" type="date" required />
          </div>
          <div>
            <label for="indemnitorSsn">N√∫mero de Seguro Social</label>
            <input id="indemnitorSsn" name="indemnitorSsn" inputmode="numeric" />
          </div>
          <div>
            <label for="indemnitorDl">N√∫mero de Licencia de Conducir (o ID)</label>
            <input id="indemnitorDl" name="indemnitorDl" />
          </div>
        </div>
        <div class="step-actions">
          <button class="ghost" type="button" data-back>Atr√°s</button>
          <button class="primary" type="button" data-next>Siguiente</button>
        </div>
      </div>

      <!-- STEP 2B: Indemnitor (next 5) -->
      <div class="section" data-step="2">
        <div class="grid">
          <div>
            <label for="indemnitorCell">N√∫mero de Celular<span class="req">*</span></label>
            <input id="indemnitorCell" name="indemnitorCell" type="tel" inputmode="tel" data-phone required />
          </div>
          <div>
            <label for="indemnitorHomePhone">N√∫mero de Casa</label>
            <input id="indemnitorHomePhone" name="indemnitorHomePhone" type="tel" inputmode="tel" data-phone />
          </div>
          <div>
            <label for="indemnitorEmail">Direcci√≥n de Correo Electr√≥nico</label>
            <input id="indemnitorEmail" name="indemnitorEmail" type="email" />
          </div>
          <div class="full">
            <label for="indemnitorAddress">Direcci√≥n de Casa<span class="req">*</span></label>
            <input id="indemnitorAddress" name="indemnitorAddress" required />
          </div>
          <div>
            <label for="indemnitorHowLong">¬øCu√°nto Tiempo Viviendo en la Direcci√≥n Actual<span class="req">*</span></label>
            <div class="hint">Ejemplos: "2 a√±os", "6 meses", "Menos de 1 a√±o", "M√°s de 3 a√±os"</div>
            <input id="indemnitorHowLong" name="indemnitorHowLong" required />
          </div>
        </div>
        <div class="step-actions">
          <button class="ghost" type="button" data-back>Atr√°s</button>
          <button class="primary" type="button" data-next>Siguiente</button>
        </div>
      </div>

      <!-- STEP 2C: Indemnitor (final 5) -->
      <div class="section" data-step="3">
        <div class="grid">
          <div>
            <label for="indemnitorWorkType">Tipo de Trabajo<span class="req">*</span></label>
            <div class="hint">Ejemplos: "Gerente", "Trabajador de Construcci√≥n", "Enfermera", "Trabajador Independiente", "Jubilado"</div>
            <input id="indemnitorWorkType" name="indemnitorWorkType" required />
          </div>
          <div>
            <label for="indemnitorEmployer">Nombre del Empleador<span class="req">*</span></label>
            <input id="indemnitorEmployer" name="indemnitorEmployer" required />
          </div>
          <div>
            <label for="indemnitorWorkPhone">N√∫mero de Trabajo (NO ser√° llamado)</label>
            <input id="indemnitorWorkPhone" name="indemnitorWorkPhone" type="tel" inputmode="tel" data-phone />
          </div>
          <div class="full">
            <label for="indemnitorWorkAddress">Direcci√≥n de Trabajo</label>
            <input id="indemnitorWorkAddress" name="indemnitorWorkAddress" />
          </div>
          <div class="full">
            <label for="indemnitorVehicle">Veh√≠culo del Garante<span class="req">*</span></label>
            <div class="hint">Ejemplos: "Honda Civic 2018", "Ford F-150 2020", "Sin veh√≠culo"</div>
            <input id="indemnitorVehicle" name="indemnitorVehicle" required />
          </div>
        </div>
        <div class="step-actions">
          <button class="ghost" type="button" data-back>Atr√°s</button>
          <button class="primary" type="button" data-next>Siguiente</button>
        </div>
      </div>

      <!-- STEP 3A: Defendant (first 5) -->
      <div class="section" data-step="4">
        <div class="section-info" style="margin-bottom:20px; color:#fff; font-size:14px; line-height:1.4; text-align:center; font-weight:bold;">
          Las siguientes preguntas son sobre el acusado (la persona arrestada o persona que necesita una fianza).
        </div>
        <div class="grid">
          <div>
            <label for="defendantName">Nombre Completo del Acusado<span class="req">*</span></label>
            <input id="defendantName" name="defendantName" required />
          </div>
          <div>
            <label for="defendantNick">Apodo del Acusado (Si no es el nombre real)</label>
            <input id="defendantNick" name="defendantNick" />
          </div>
          <div>
            <label for="defendantDob">Fecha de Nacimiento<span class="req">*</span></label>
            <input id="defendantDob" name="defendantDob" type="date" required />
          </div>
          <div>
            <label for="defendantSsn">N√∫mero de Seguro Social (opcional)</label>
            <input id="defendantSsn" name="defendantSsn" inputmode="numeric" />
          </div>
          <div>
            <label for="defendantDl">N√∫mero de Licencia de Conducir o ID (opcional)</label>
            <input id="defendantDl" name="defendantDl" />
          </div>
        </div>
        <div class="step-actions">
          <button class="ghost" type="button" data-back>Atr√°s</button>
          <button class="primary" type="button" data-next>Siguiente</button>
        </div>
      </div>

      <!-- STEP 3B: Defendant (next 5) -->
      <div class="section" data-step="5">
        <div class="grid">
          <div>
            <label for="birthCityState">Ciudad y Estado de Nacimiento</label>
            <input id="birthCityState" name="birthCityState" />
          </div>
          <div>
            <label for="citizenship">Pa√≠s de Ciudadan√≠a</label>
            <input id="citizenship" name="citizenship" />
          </div>
          <div>
            <label for="race">Raza<span class="req">*</span></label>
            <select id="race" name="race" required>
              <option value="" hidden>Seleccionar‚Ä¶</option>
              <option>Blanco</option>
              <option>Negro / Afroamericano</option>
              <option>Hispano / Latino</option>
              <option>Asi√°tico</option>
              <option>Nativo Americano</option>
              <option>Isle√±o del Pac√≠fico</option>
              <option>Otro</option>
            </select>
          </div>
          <div>
            <label for="defendantCell">N√∫mero de Celular<span class="req">*</span></label>
            <input id="defendantCell" name="defendantCell" type="tel" inputmode="tel" data-phone required />
          </div>
          <div>
            <label for="defendantHomePhone">N√∫mero de Casa (Omitir si no tiene)</label>
            <input id="defendantHomePhone" name="defendantHomePhone" type="tel" inputmode="tel" data-phone />
          </div>
        </div>
        <div class="step-actions">
          <button class="ghost" type="button" data-back>Atr√°s</button>
          <button class="primary" type="button" data-next>Siguiente</button>
        </div>
      </div>

      <!-- STEP 3C: Defendant (next 5) -->
      <div class="section" data-step="6">
        <div class="grid">
          <div>
            <label for="defendantEmail">Direcci√≥n de Correo Electr√≥nico</label>
            <input id="defendantEmail" name="defendantEmail" type="email" />
          </div>
          <div class="full">
            <label for="defendantAddress">Direcci√≥n de Casa<span class="req">*</span></label>
            <input id="defendantAddress" name="defendantAddress" required />
          </div>
          <div>
            <label for="defendantHowLong">¬øCu√°nto Tiempo ha Vivido el Acusado en la Direcci√≥n Actual<span class="req">*</span></label>
            <div class="hint">Ejemplos: "2 a√±os", "6 meses", "Menos de 1 a√±o", "M√°s de 3 a√±os"</div>
            <input id="defendantHowLong" name="defendantHowLong" required />
          </div>
          <div>
            <label for="homeStatus">¬øEsta Casa es Propia o Alquilada?</label>
            <select id="homeStatus" name="homeStatus">
              <option value="" hidden>Seleccionar‚Ä¶</option>
              <option>Propia</option>
              <option>Alquilada</option>
              <option>Otro</option>
            </select>
          </div>
          <div class="full">
            <label for="landlordName">Nombre de la Comunidad / Propietario / Due√±o</label>
            <input id="landlordName" name="landlordName" />
          </div>
        </div>
        <div class="step-actions">
          <button class="ghost" type="button" data-back>Atr√°s</button>
          <button class="primary" type="button" data-next>Siguiente</button>
        </div>
      </div>

      <!-- STEP 3D: Defendant (next 5) -->
      <div class="section" data-step="7">
        <div class="grid">
          <div>
            <label for="defendantWorkType">Tipo de Trabajo del Acusado</label>
            <div class="hint">Ejemplos: "Gerente", "Trabajador de Construcci√≥n", "Enfermera", "Trabajador Independiente", "Desempleado"</div>
            <input id="defendantWorkType" name="defendantWorkType" />
          </div>
          <div>
            <label for="defendantEmployer">Nombre del Empleador del Acusado</label>
            <input id="defendantEmployer" name="defendantEmployer" />
          </div>
          <div>
            <label for="defendantWorkPhone">N√∫mero de Trabajo del Acusado (NO ser√° llamado)</label>
            <input id="defendantWorkPhone" name="defendantWorkPhone" type="tel" inputmode="tel" data-phone />
          </div>
          <div class="full">
            <label for="defendantWorkAddress">Direcci√≥n de Trabajo del Acusado</label>
            <input id="defendantWorkAddress" name="defendantWorkAddress" />
          </div>
          <div class="full">
            <label for="recentArrest">Arresto M√°s Reciente del Acusado (Sin incluir el Arresto Actual)</label>
            <textarea id="recentArrest" name="recentArrest"></textarea>
          </div>
        </div>
        <div class="step-actions">
          <button class="ghost" type="button" data-back>Atr√°s</button>
          <button class="primary" type="button" data-next>Siguiente</button>
        </div>
      </div>

      <!-- STEP 3E: Defendant (final 2) -->
      <div class="section" data-step="8">
        <div class="grid">
          <div class="full">
            <label>Por favor Seleccione o Toque con su Dedo SOLO si la respuesta es "S√≠":</label>
            <div class="hint">Estas preguntas son sobre la persona siendo afianzada. Solo marque las casillas si la respuesta es S√ç.</div>
            <div class="checks">
              <label><input type="checkbox" id="q_fta" name="q_fta" value="Yes"> ¬øHa Faltado a Comparecer ante el Tribunal en el Pasado?</label>
              <label><input type="checkbox" id="q_supervision" name="q_supervision" value="Yes"> ¬øEst√° Actualmente en Libertad Condicional, Libertad Vigilada, o SOR (Registro de Delincuente Sexual)?</label>
              <label><input type="checkbox" id="q_otherBond" name="q_otherBond" value="Yes"> ¬øEst√° Actualmente Bajo Fianza por Otro Caso?</label>
            </div>
          </div>
          <div class="full">
            <label for="defendantVehicle">Veh√≠culo del Acusado para ir al Tribunal<span class="req">*</span></label>
            <div class="hint">Ejemplos: "Honda Civic 2018", "Familiar lo llevar√°", "Transporte p√∫blico", "Uber/Taxi"</div>
            <input id="defendantVehicle" name="defendantVehicle" required />
          </div>
        </div>
        <div class="step-actions">
          <button class="ghost" type="button" data-back>Atr√°s</button>
          <button class="primary" type="button" data-next>Siguiente</button>
        </div>
      </div>

      <!-- STEP 4A: Relationship (5) -->
      <div class="section" data-step="9">
        <div class="grid">
          <div>
            <label for="relationshipStatus">Estado de la Relaci√≥n</label>
            <select id="relationshipStatus" name="relationshipStatus">
              <option value="" hidden>Seleccionar‚Ä¶</option>
              <option>Soltero</option>
              <option>Casado</option>
              <option>Uni√≥n Dom√©stica</option>
              <option>Separado</option>
              <option>Divorciado</option>
              <option>Viudo</option>
            </select>
          </div>
          <div>
            <label for="partnerName">Nombre Completo de la Pareja del Acusado</label>
            <input id="partnerName" name="partnerName" />
          </div>
          <div>
            <label for="partnerDob">Fecha de Nacimiento de la Pareja</label>
            <input id="partnerDob" name="partnerDob" type="date" />
          </div>
          <div>
            <label for="partnerCell">N√∫mero de Celular de la Pareja</label>
            <input id="partnerCell" name="partnerCell" type="tel" inputmode="tel" data-phone />
          </div>
          <div>
            <label for="partnerWorkType">Tipo de Trabajo de la Pareja</label>
            <div class="hint">Ejemplos: "Gerente", "Trabajador de Construcci√≥n", "Enfermera", "Trabajador Independiente", "Desempleado"</div>
            <input id="partnerWorkType" name="partnerWorkType" />
          </div>
        </div>
        <div class="step-actions">
          <button class="ghost" type="button" data-back>Atr√°s</button>
          <button class="primary" type="button" data-next>Siguiente</button>
        </div>
      </div>

      <!-- STEP 4B: Relationship (1) -->
      <div class="section" data-step="10">
        <div class="grid">
          <div class="full">
            <label for="partnerWorkName">Nombre del Trabajo de la Pareja</label>
            <input id="partnerWorkName" name="partnerWorkName" />
          </div>
        </div>
        <div class="step-actions">
          <button class="ghost" type="button" data-back>Atr√°s</button>
          <button class="primary" type="button" data-next>Siguiente</button>
        </div>
      </div>

      <!-- STEP 5A: Parents (5) -->
      <div class="section" data-step="11">
        <div class="grid">
          <div>
            <label for="motherName">Nombre de la Madre</label>
            <input id="motherName" name="motherName" />
          </div>
          <div>
            <label for="motherPhone">N√∫mero de la Madre</label>
            <input id="motherPhone" name="motherPhone" type="tel" inputmode="tel" data-phone />
          </div>
          <div class="full">
            <label for="motherAddress">Direcci√≥n de Casa de la Madre</label>
            <input id="motherAddress" name="motherAddress" />
          </div>
          <div>
            <label for="fatherName">Nombre del Padre</label>
            <input id="fatherName" name="fatherName" />
          </div>
          <div>
            <label for="fatherPhone">N√∫mero del Padre</label>
            <input id="fatherPhone" name="fatherPhone" type="tel" inputmode="tel" data-phone />
          </div>
        </div>
        <div class="step-actions">
          <button class="ghost" type="button" data-back>Atr√°s</button>
          <button class="primary" type="button" data-next>Siguiente</button>
        </div>
      </div>

      <!-- STEP 5B: Parents (1) -->
      <div class="section" data-step="12">
        <div class="grid">
          <div class="full">
            <label for="fatherAddress">Direcci√≥n de Casa del Padre</label>
            <input id="fatherAddress" name="fatherAddress" />
          </div>
        </div>
        <div class="step-actions">
          <button class="ghost" type="button" data-back>Atr√°s</button>
          <button class="primary" type="button" data-next>Siguiente</button>
        </div>
      </div>

      <!-- STEP 6: Siblings (4) -->
      <div class="section" data-step="13">
        <div class="grid">
          <div>
            <label for="sibling1Name">1. Nombre del Hermano/Hermana</label>
            <input id="sibling1Name" name="sibling1Name" />
          </div>
          <div>
            <label for="sibling1Phone">1. N√∫mero del Hermano/Hermana</label>
            <input id="sibling1Phone" name="sibling1Phone" type="tel" inputmode="tel" data-phone />
          </div>
          <div>
            <label for="sibling2Name">2. Nombre del Hermano/Hermana</label>
            <input id="sibling2Name" name="sibling2Name" />
          </div>
          <div>
            <label for="sibling2Phone">2. N√∫mero del Hermano/Hermana</label>
            <input id="sibling2Phone" name="sibling2Phone" type="tel" inputmode="tel" data-phone />
          </div>
        </div>
        <div class="step-actions">
          <button class="ghost" type="button" data-back>Atr√°s</button>
          <button class="primary" type="button" data-next>Siguiente</button>
        </div>
      </div>

      <!-- STEP 7A: References (5) -->
      <div class="section" data-step="14">
        <div class="grid">
          <div>
            <label for="ref1Name">Referencia #1 - Nombre Completo<span class="req">*</span></label>
            <input id="ref1Name" name="ref1Name" required />
          </div>
          <div>
            <label for="ref1Relation">Referencia #1 - Relaci√≥n<span class="req">*</span></label>
            <input id="ref1Relation" name="ref1Relation" required />
          </div>
          <div>
            <label for="ref1Phone">Referencia #1 - N√∫mero<span class="req">*</span></label>
            <input id="ref1Phone" name="ref1Phone" type="tel" inputmode="tel" data-phone required />
          </div>
          <div>
            <label for="ref2Name">Referencia #2 - Nombre Completo<span class="req">*</span></label>
            <input id="ref2Name" name="ref2Name" required />
          </div>
          <div>
            <label for="ref2Relation">Referencia #2 - Relaci√≥n<span class="req">*</span></label>
            <input id="ref2Relation" name="ref2Relation" required />
          </div>
        </div>
        <div class="step-actions">
          <button class="ghost" type="button" data-back>Atr√°s</button>
          <button class="primary" type="button" data-next>Siguiente</button>
        </div>
      </div>

      <!-- STEP 7B: References (4) -->
      <div class="section" data-step="15">
        <div class="grid">
          <div>
            <label for="ref2Phone">Referencia #2 - N√∫mero<span class="req">*</span></label>
            <input id="ref2Phone" name="ref2Phone" type="tel" inputmode="tel" data-phone required />
          </div>
          <div>
            <label for="ref3Name">Referencia #3 - Nombre Completo<span class="req">*</span></label>
            <input id="ref3Name" name="ref3Name" required />
          </div>
          <div>
            <label for="ref3Relation">Referencia #3 - Relaci√≥n<span class="req">*</span></label>
            <input id="ref3Relation" name="ref3Relation" required />
          </div>
          <div>
            <label for="ref3Phone">Referencia #3 - N√∫mero<span class="req">*</span></label>
            <input id="ref3Phone" name="ref3Phone" type="tel" inputmode="tel" data-phone required />
          </div>
        </div>
        <div class="step-actions">
          <button class="ghost" type="button" data-back>Atr√°s</button>
          <button class="primary" type="button" data-next>Siguiente</button>
        </div>
      </div>

      <!-- STEP 8A: Emergency Contacts (5) -->
      <div class="section" data-step="16">
        <div class="grid">
          <div>
            <label for="emergency1Name">Contacto de Emergencia #1<span class="req">*</span></label>
            <input id="emergency1Name" name="emergency1Name" required />
          </div>
          <div>
            <label for="emergency1Phone">N√∫mero de Emergencia #1<span class="req">*</span></label>
            <input id="emergency1Phone" name="emergency1Phone" type="tel" inputmode="tel" data-phone required />
          </div>
          <div>
            <label for="emergency2Name">Contacto de Emergencia #2<span class="req">*</span></label>
            <input id="emergency2Name" name="emergency2Name" required />
          </div>
          <div>
            <label for="emergency2Phone">N√∫mero de Emergencia #2<span class="req">*</span></label>
            <input id="emergency2Phone" name="emergency2Phone" type="tel" inputmode="tel" data-phone required />
          </div>
        </div>
        <div class="step-actions">
          <button class="ghost" type="button" data-back>Atr√°s</button>
          <button class="primary" type="button" data-next>Siguiente</button>
        </div>
      </div>


      <!-- STEP 9: Terms and Conditions -->
      <div class="section" data-step="18">
        <div class="agreement-text">
T√©rminos y Condiciones de Solicitud para Fianza de Comparecencia

Los siguientes t√©rminos y condiciones para la Fianza de Comparecencia para la cual U.S. Fire Insurance Company (USFIC) o su Agente y las partes acuerdan que dicha fianza de comparecencia est√° condicionada al cumplimiento completo de todos dichos t√©rminos y condiciones y es parte de dicha fianza y solicitud por lo tanto.

1. USFIC como la Compa√±√≠a de Fianzas, a trav√©s de su agente debidamente designado, tendr√° control y jurisdicci√≥n sobre el principal durante el t√©rmino por el cual se ejecuta la fianza y tendr√° el derecho de aprehender, arrestar y entregar al principal a los funcionarios apropiados en cualquier momento seg√∫n lo dispuesto por la ley.

2. En caso de que se haga la entrega del principal antes del tiempo establecido para las comparecencias del principal, y por razones distintas a las enumeradas a continuaci√≥n en el p√°rrafo 3, entonces el principal tendr√° derecho a un reembolso de la prima de la fianza.

3. Se entiende y acuerda que la ocurrencia de cualquiera de los siguientes eventos constituir√° un incumplimiento de la obligaci√≥n del principal hacia USFIC en este documento, y USFIC tendr√° el derecho de aprehender, arrestar y entregar inmediatamente al principal, y el principal no tendr√° derecho a ning√∫n reembolso de prima en absoluto. Dichos eventos que constituir√°n un incumplimiento de las obligaciones del principal en este documento son:
   (a) Si el principal se va de la jurisdicci√≥n del tribunal sin el consentimiento por escrito del tribunal y la Compa√±√≠a de Fianzas o su Agente.
   (b) Si el principal se muda de una direcci√≥n a otra sin notificar a la Compa√±√≠a de Fianzas o su Agente por escrito antes de dicha mudanza.
   (c) Si el principal comete cualquier acto que constituya evidencia razonable de la intenci√≥n del principal de causar una p√©rdida de dicha fianza.
   (d) Si el principal es arrestado y encarcelado por cualquier delito que no sea una violaci√≥n menor de tr√°nsito.
   (e) Si el principal hace cualquier declaraci√≥n material falsa en la solicitud para fianza de comparecencia.

Bajo penas de perjurio, declaro que he le√≠do lo anterior, y la informaci√≥n proporcionada es verdadera y correcta sin reserva. La informaci√≥n y representaciones hechas en esta Solicitud son con el prop√≥sito de inducir a la Fianza a emprender la(s) fianza(s) para la(s) cual(es) he solicitado con la intenci√≥n de que la Fianza conf√≠e completamente en la informaci√≥n y representaciones contenidas en este documento. Acepto indemnizar y eximir de responsabilidad a la Compa√±√≠a de Fianzas y sus Agentes por todas y cualquier p√©rdidas que puedan surgir de la ejecuci√≥n de la(s) fianza(s) solicitada(s) en este documento, a menos que est√© prohibido por ley o regulaci√≥n aplicable.

***SOLO PROCEDA SI EST√Å DE ACUERDO CON LO ANTERIOR***
        </div>
        <div class="checks">
          <label><input type="checkbox" id="termsRead" name="termsRead" value="Yes" required> He le√≠do y acepto los T√©rminos y Condiciones anteriores<span class="req">*</span></label>
        </div>
        <div class="step-actions">
          <button class="ghost" type="button" data-back>Atr√°s</button>
          <button class="primary" type="button" data-next>Siguiente</button>
        </div>
      </div>

      <!-- STEP 10: Contingent Promissory Note -->
      <div class="section" data-step="19">
        <div class="agreement-text">
Pagar√© Contingente

Por valor recibido el abajo firmante, conjunta y solidariamente promete(n) pagar a U.S. FIRE INSURANCE COMPANY o su Agente, Jerry Casal Bail Bonds, LLC a demanda la suma principal de la fianza si y solo si ocurre un incumplimiento de los t√©rminos y condiciones de la fianza de cauci√≥n o fianzas posteadas en nombre del acusado.

El acusado por el cual esto est√° siendo presentado escrito previamente en este formulario (en adelante "Acusado"), junto con cualquier continuaci√≥n y modificaci√≥n, cualquier extensi√≥n, sustituci√≥n, incremento o apelaci√≥n de los mismos (en adelante "Fianza"), o al pago de cualquier gasto incurrido por el beneficiario o tenedor (en adelante "Beneficiario") para producir al Acusado ante el tribunal o tribunales apropiados de jurisdicci√≥n competente en el caso anterior, con intereses sobre los mismos a la tasa de CATORCE por ciento (14%), por a√±o, desde la fecha de ocurrencia de la Contingencia arriba declarada, hasta que sea pagado completamente. Todos los otorgantes o endosantes, ahora o en el futuro convirti√©ndose en partes de este documento, conjunta y solidariamente renuncian a la demanda, aviso de no pago y protesta: y en caso de que esta nota entre en incumplimiento y sea colocada en manos de un abogado para cobranza, los anteriores acuerdan pagar honorarios razonables de abogado y todos los otros costos para hacer dicha cobranza y adem√°s acuerdan que los tribunales de jurisdicci√≥n original y tribunales de apelaci√≥n pueden otorgar honorarios razonables de abogado al Beneficiario en caso de litigio y/o apelaciones.

Se acuerda adem√°s y se entiende espec√≠ficamente entre las partes de este Pagar√© que actualmente no hay pr√©stamo o deuda pendiente representada por este Pagar√© Contingente, y que este Pagar√© se da para asegurar adelantos hasta e incluyendo la cantidad establecida anteriormente junto con intereses si y cuando hay un incumplimiento de los t√©rminos y condiciones, incluyendo pero no limitado a p√©rdida o estreatura, de la Fianza. Se acuerda adem√°s y se entiende espec√≠ficamente que este Pagar√© se volver√° nulo e inv√°lido en el momento en que todas las obligaciones bajo la Fianza posteada en nombre del Acusado hayan sido cumplidas y el Beneficiario haya sido liberado de toda responsabilidad y debidamente exonerado por escrito y hasta que ocurra dicho tiempo la nota permanecer√° en plena vigencia y efecto.

(a) Cualquier y toda responsabilidad, p√©rdida, costos, da√±os, gastos, primas y honorarios de abogados que surjan o sean incurridos por el Beneficiario en conexi√≥n con la Fianza arriba mencionada, o cualquier otra fianza, compromiso u otra obligaci√≥n, ejecutada, asumida o procurada por el Beneficiario a instancia o solicitud o en nombre del propietario de la propiedad gravada por la Hipoteca que asegura el Pagar√© (en adelante, "Propietario") o del nombre del principal; Este Pagar√© y la Hipoteca de igual fecha servir√°n para asegurar:
(b) Para el pago de todas las primas en dichas Fianzas;
(c) Para el cumplimiento de cada acuerdo (incluyendo continuaciones o modificaciones, cualquier extensi√≥n, sustituci√≥n, incremento o apelaci√≥n de los mismos, con o sin consentimiento del Propietario) hecho por el Propietario o Acusado en conexi√≥n con dichas Fianzas;
(d) Contra cualquier responsabilidad, p√©rdida, costos, gastos y honorarios de abogados en conexi√≥n con cualquier reclamo a la garant√≠a colateral por persona que reclame adversamente al Propietario o a los Principales nombrados en las Fianzas;
(e) Cualquier y todos los adelantos futuros hechos con o sin consentimiento del Propietario por el Beneficiario en nombre del Acusado incluyendo pero no necesariamente limitado a incrementos, modificaciones, extensiones o sustituciones, o la creaci√≥n de cualquier obligaci√≥n futura por el Beneficiario en conexi√≥n con el asunto arriba descrito, o cualquier fianza o obligaci√≥n emprendida por el Beneficiario en nombre del Acusado incluyendo, sin limitar, a la posici√≥n de una nueva fianza para y en nombre del Acusado en la naturaleza de una fianza de apelaci√≥n o sustituci√≥n extensi√≥n o modificaci√≥n de la Fianza existente.

Este Pagar√© es Ejecutado en la fecha en que este formulario es enviado.

***SOLO PROCEDA SI EST√Å DE ACUERDO CON LO ANTERIOR***
        </div>
        <div class="checks">
          <label><input type="checkbox" id="promissoryRead" name="promissoryRead" value="Yes" required> He le√≠do y acepto el Pagar√© Contingente anterior<span class="req">*</span></label>
        </div>
        <div class="step-actions">
          <button class="ghost" type="button" data-back>Atr√°s</button>
          <button class="primary" type="button" data-next>Siguiente</button>
        </div>
      </div>

      <!-- STEP 11: Indemnity Agreement -->
      <div class="section" data-step="20">
        <div class="agreement-text">
Acuerdo de Indemnizaci√≥n para Fianza

El(Los) abajo firmante(s) Indemnizador(es) ("Indemnizadores") hace(n) solicitud a U.S. Fire Insurance Company a trav√©s de su Agente Productor debidamente licenciado y designado Jerry Casal Bail Bonds, LLC (colectivamente referidos en este documento como "Fianza") para la ejecuci√≥n de un compromiso de fianza ("Fianza de Cauci√≥n") en el Monto Penal de la cantidad de fianza dada para el acusado en adelante referido como el "Principal" e "Indemnizador" y en consideraci√≥n de que la Fianza arregle para la ejecuci√≥n o continuaci√≥n de esta Fianza de Cauci√≥n, Indemnizador(es) conjunta y solidariamente acuerda(n) como sigue:

Por buena y valiosa consideraci√≥n, el Principal abajo firmante e Indemnizador(es) por este medio acuerdan indemnizar y eximir de responsabilidad a la compa√±√≠a de Fianza y/o su(s) agente(s) por todas las p√©rdidas no prohibidas de otra manera por ley o reglas del Departamento de Instituciones Financieras y Seguros de Florida, y

1) Pagar a la Fianza la prima establecida de Florida para esta Fianza de Cauci√≥n. La prima se gana al momento de la liberaci√≥n del Principal de la instalaci√≥n de detenci√≥n. El hecho de que el Acusado pueda haber sido arrestado inapropiadamente, o su fianza reducida o su caso desestimado, no obligar√° la devoluci√≥n de ninguna porci√≥n de dicha prima.

2) Reembolsar a la Fianza por gastos reales en que incurra causados por cualquier incumplimiento por el Principal de los t√©rminos de la solicitud y Fianza de Cauci√≥n, incluyendo gastos o responsabilidades incurridas como resultado de buscar, recapturar o devolver al Principal a custodia o en aprehender o intentar aprehender al Principal, incluyendo honorarios legales para hacer solicitud a un tribunal para una orden de anular o dejar de lado una orden de p√©rdida o juicio ingresado sobre la misma. En caso de que el Acusado falle en seguir cualquier y todas las instrucciones o si el tribunal pierde o revoca la fianza y se vuelve necesario para el Fiancista o Fianza investigar, aprehender y entregar al Acusado al tribunal, las Tarifas de Fugitivo ser√°n gobernadas por un Contrato de Tarifa de Fugitivo separado entre Indemnizador y Fianza.

3) Pagar a la Fianza un honorario razonable de abogado, no menos de Quinientos D√≥lares ($500.00), en caso de que sea necesario instituir acci√≥n legal que surja de este Acuerdo.

4) Proporcionar a la Fianza bajo demanda, una cantidad monetaria igual al Monto Penal para ser mantenida como garant√≠a si la Fianza descubre que cualquier informaci√≥n fue ocultada o tergiversada por el Indemnizador o Principal, o por otra causa razonable material al riesgo asumido de la Fianza. Si el tribunal aumenta el monto penal de la Fianza de Cauci√≥n sobre la cantidad establecida anteriormente, Indemnizador(es) y Principal acuerdan proporcionar garant√≠a adicional como la Fianza pueda requerir si la Fianza, a su sola discreci√≥n, desea permanecer en la Fianza de Cauci√≥n.

5) Pagar a la Fianza inmediatamente bajo demanda el monto penal de la Fianza de Cauci√≥n despu√©s de cualquier incumplimiento de condiciones de fianza o entrada de Estreatura (p√©rdida) conforme a los estatutos gobernantes.

6) Ayudar a la Fianza en asegurar liberaci√≥n o exoneraci√≥n de la Fianza de toda responsabilidad bajo la Fianza de Cauci√≥n, incluyendo la entrega del Principal al Tribunal bajo direcci√≥n de la Fianza.

7) Indemnizador(es) y Principal por este medio otorgan a la Fianza un Inter√©s de Seguridad en todo dinero u otra propiedad en su posesi√≥n o adquirida de vez en cuando conforme al Cap√≠tulo 679, Estatutos de Florida y/o Art√≠culo 9 del C√≥digo Comercial Uniforme. La Fianza est√° autorizada a gravar legalmente dicho dinero o propiedad en la manera provista por ley y a aplicar cualquier dep√≥sito(s) y/o productos sin aviso hacia cualquier responsabilidad, p√©rdida, costos, da√±os y gastos incurridos por la Fianza como se proporciona en este Acuerdo. Si la garant√≠a colocada con la Fianza est√° en exceso de la fianza perdida, dicho exceso ser√° devuelto oportunamente al Indemnizador y/o Principal seg√∫n sea apropiado despu√©s de primero aplicar la garant√≠a a cualquier p√©rdida y sujeto a cualquier reclamo de la Fianza por Prima impaga u otros cargos legales, incluyendo pero no limitado a reembolso de tarifas de registro de documentos y sellos y tarifas de archivo, cargos de tarjeta de cr√©dito, y cualquier cargo de monitoreo electr√≥nico.

8) Las obligaciones del(de los) Indemnizador(es) y Principal en este documento son conjuntas y solidarias. Cualquier cantidad debida llevar√° inter√©s a la tasa m√°xima permitida por ley. La Fianza no estar√° primero obligada a proceder contra el Principal en Fianza de Cauci√≥n antes de tener recurso contra el(los) Indemnizador(es) o cualquiera de ellos. Los Indemnizadores expresamente renuncian a cualquier beneficio de ley que requiera que la Fianza haga reclamo sobre o proceda o haga cumplir sus remedios contra el Principal antes de hacer demanda sobre o proceder y/o hacer cumplir sus remedios contra cualquiera o m√°s de los Indemnizador(es). Por buena y valiosa consideraci√≥n, el Principal abajo firmante por este medio acuerda indemnizar y/o eximir de responsabilidad a la Fianza por 100% de cualquier y todas las p√©rdidas no prohibidas de otra manera por ley o reglas y regulaciones promulgadas bajo cualquier estatuto aplicable.

9) Como una inducci√≥n para que la Fianza suscriba la Fianza de Cauci√≥n, Indemnizador(es) y Principal garantizan que todas las declaraciones hechas por ellos en la Solicitud para Fianza sean verdaderas y acuerdan avisar a la Fianza de cualquier cambio, incluyendo pero no limitado a cambio de n√∫mero de tel√©fono, direcci√≥n o empleo de ya sea el Principal o de cualquiera de los Indemnizador(es) o cualquier otro cambio material en circunstancias dentro de cuarenta y ocho (48) horas despu√©s de que dicho cambio haya ocurrido. CUALQUIER FALLA POR EL PRINCIPAL EN AS√ç NOTIFICAR A LA FIANZA CONSTITUIR√Å MOTIVOS PARA CREER QUE EL PRINCIPAL INTENTA HUIR Y SER√Å CAUSA PARA ENTREGA INMEDIATA DEL PRINCIPAL.

10) El abajo firmante acuerda que estas obligaciones se aplican a cualquier y todas las Fianzas de Cauci√≥n ejecutadas por el mismo cargo por el cual la Fianza de Cauci√≥n arriba mencionada fue ejecutada o cualquier cargo que surja de la misma transacci√≥n sin importar si dichas Fianzas de Cauci√≥n son archivadas antes o despu√©s de convicci√≥n, incluyendo apelaciones, pero no en una cantidad mayor.

11) El abajo firmante autoriza a cualquier persona, agencia, sociedad o corporaci√≥n que tenga cualquier informaci√≥n concerniente a mi car√°cter, cr√©dito, y reputaci√≥n financiera a liberar dicha informaci√≥n a la Fianza, incluyendo pero no limitado a reportes de cr√©dito e investigaciones de antecedentes. Dicha informaci√≥n es para ser usada para asegurar la comparecencia del Principal en tribunal o aprehensi√≥n en el caso de una estreatura de fianza. El abajo firmante por este medio libera a dicha persona, agencia, sociedad o corporaci√≥n de cualquier responsabilidad que pueda ser incurrida al liberar esta informaci√≥n a la Fianza incluyendo responsabilidad bajo Ley Federal.

HE LE√çDO ESTE ACUERDO DE INDEMNIZACI√ìN Y CONOZCO SUS CONTENIDOS. RECONOZCO RECIBO DE UNA COPIA DEL ACUERDO DE INDEMNIZACI√ìN O HE IMPRESO UNA COPIA. SOY EL VERDADERO Y LEG√çTIMO PROPIETARIO DE LA PROPIEDAD, YA SEA REAL O PERSONAL, ESTABLECIDA EN LA SOLICITUD PARA FIANZA (CUYA SOLICITUD ENTERA ES HECHA PARTE DE ESTE DOCUMENTO POR REFERENCIA). POSEO DICHA PROPIEDAD LIBRE Y CLARA DE TODOS LOS GRAV√ÅMENES O CARGAS EXCEPTO COMO HE REVELADO POR ESCRITO. PROMETO NO TRANSFERIR O GRAVAR CUALQUIERA DE DICHA PROPIEDAD HASTA QUE MI RESPONSABILIDAD BAJO ESTE ACUERDO DE INDEMNIZACI√ìN Y LA SOLICITUD PARA FIANZA HAYA SIDO LIBERADA. ENTIENDO QUE LA FIANZA EST√Å PERMITIENDO QUE LA FIANZA DE CAUCI√ìN PERMANEZCA EN VIGOR CONFIANDO EN LAS DECLARACIONES HECHAS POR M√ç.
        </div>
        <div class="checks">
          <label><input type="checkbox" id="indemnityRead" name="indemnityRead" value="Yes" required> He le√≠do y acepto el Acuerdo de Indemnizaci√≥n anterior<span class="req">*</span></label>
        </div>
        <div class="step-actions">
          <button class="ghost" type="button" data-back>Atr√°s</button>
          <button class="primary" type="button" data-next>Siguiente</button>
        </div>
      </div>

      <!-- STEP 12: Final Agreement (Signature) -->
      <div class="section" data-step="21">
        <div class="grid">
          <div class="full">
            <label for="agreeName">AL ESCRIBIR SU NOMBRE Y ENVIAR A CONTINUACI√ìN USTED ACEPTA TODOS LOS T√âRMINOS Y CONDICIONES ANTERIORES Y QUE LA INFORMACI√ìN ES ENTERAMENTE CORRECTA Y VERDADERA Y QUE USTED ES LA PERSONA QUE ENV√çA LA SOLICITUD.<span class="req">*</span></label>
            <input id="agreeName" name="agreeName" required />
          </div>
        </div>
        <div class="actions">
          <button class="ghost" type="button" data-back>Atr√°s</button>
          <button class="primary" id="submitBtn" type="submit">Enviar Solicitud</button>
          <div class="error" id="err">Por favor complete los campos requeridos en este paso.</div>
        </div>
        <div class="loading-indicator" id="loadingIndicator">
          Enviando su solicitud...
        </div>
      </div>


      <!-- STEP 13: Application Complete -->
      <div class="section" data-step="23" id="completionSection">
        <div style="text-align:center; padding:40px 20px;">
          <div style="font-size:48px; margin-bottom:20px;">‚ö†Ô∏è</div>
          <h2 style="color:#fff; font-size:24px; margin-bottom:20px; font-weight:700;">Siguiente Paso: Le Llamaremos</h2>
          <p style="color:#fff; font-size:16px; line-height:1.5; margin-bottom:20px;">
            No se preocupe, ya est√° todo listo. Le llamaremos inmediatamente despu√©s de recibir para completar su proceso de fianza.
          </p>
          <p style="color:#fff; font-size:16px; line-height:1.5; margin-bottom:30px;">
            üëâ Si a√∫n no ha hablado con nosotros, env√≠e un texto r√°pido al <span style="color:#F5A00D; font-weight:bold;">561-247-0018</span> para que sepamos contactarle r√°pido.
          </p>
          <a href="sms:561-247-0018" style="display:inline-block; background:#F5A00D; color:#111; padding:16px 32px; border-radius:10px; font-weight:700; font-size:16px; text-decoration:none; cursor:pointer;">
            ENV√çANOS TEXTO
          </a>
        </div>
      </div>

    </form>
  </div>

  <script>
    // Wizard logic
    const sections = Array.from(document.querySelectorAll('.section'));
    let userRole = ''; // 'Indemnitor' or 'Defendant'

    function showStep(idx) {
      sections.forEach((s, i) => {
        s.classList.toggle('active', i === idx);
      });

      // Update progress bar
      const totalSteps = 23; // Total steps including upload and completion
      const currentStep = idx + 1;
      const progressPercent = (currentStep / totalSteps) * 100;

      const progressBar = document.getElementById('progressBar');

      if (progressBar) {
        progressBar.style.width = `${progressPercent}%`;
      }

      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // Update labels based on user role
    function updateLabelsForRole(role) {
      userRole = role;

      if (role === 'Indemnitor') {
        // Update indemnitor section labels (steps 1-3) to refer to "Your" info
        document.querySelector('label[for="indemnitorName"]').innerHTML = 'Su Nombre Completo<span class="req">*</span>';
        document.querySelector('label[for="indemnitorDob"]').innerHTML = 'Su Fecha de Nacimiento<span class="req">*</span>';
        document.querySelector('label[for="indemnitorCell"]').innerHTML = 'Su N√∫mero de Celular<span class="req">*</span>';
        document.querySelector('label[for="indemnitorEmail"]').innerHTML = 'Su Direcci√≥n de Correo Electr√≥nico';
        document.querySelector('label[for="indemnitorAddress"]').innerHTML = 'Su Direcci√≥n de Casa<span class="req">*</span>';
        document.querySelector('label[for="indemnitorHowLong"]').innerHTML = '¬øCu√°nto Tiempo Ha Vivido en la Direcci√≥n Actual<span class="req">*</span>';
        document.querySelector('label[for="indemnitorWorkType"]').innerHTML = 'Su Tipo de Trabajo<span class="req">*</span>';
        document.querySelector('label[for="indemnitorEmployer"]').innerHTML = 'Su Nombre del Empleador<span class="req">*</span>';
        document.querySelector('label[for="indemnitorWorkPhone"]').innerHTML = 'Su N√∫mero de Trabajo (NO ser√° llamado)';
        document.querySelector('label[for="indemnitorWorkAddress"]').innerHTML = 'Su Direcci√≥n de Trabajo';
        document.querySelector('label[for="indemnitorVehicle"]').innerHTML = 'Su Veh√≠culo<span class="req">*</span>';
        document.querySelector('label[for="indemnitorHomePhone"]').innerHTML = 'Su N√∫mero de Casa';
        document.querySelector('label[for="relation"]').innerHTML = 'Su Relaci√≥n con la Persona en la C√°rcel y/o Siendo Afianzado?<span class="req">*</span>';

        // Keep checkbox section hint as default for indemnitors (about defendant)
        const checkboxHint = document.querySelector('.section[data-step="8"] .hint');
        if (checkboxHint) {
          checkboxHint.innerHTML = 'Estas preguntas son sobre la persona siendo afianzada';
        }

        // Update section info messages for indemnitors
        const indemnitorSectionInfo = document.querySelector('.section[data-step="1"] .section-info');
        if (indemnitorSectionInfo) {
          indemnitorSectionInfo.innerHTML = 'Por favor proporcione la siguiente informaci√≥n sobre usted mismo (la persona afianzando a la persona arrestada).';
        }

        const defendantSectionInfo = document.querySelector('.section[data-step="4"] .section-info');
        if (defendantSectionInfo) {
          defendantSectionInfo.innerHTML = 'Las siguientes preguntas son sobre el acusado (la persona arrestada o persona que necesita una fianza).';
        }

        // Defendant section labels remain as "Defendant's"
      } else if (role === 'Defendant') {
        // Update indemnitor section labels (steps 1-3) to refer to "Indemnitor's" info
        document.querySelector('label[for="indemnitorName"]').innerHTML = 'Nombre Completo del Garante<span class="req">*</span>';
        document.querySelector('label[for="indemnitorDob"]').innerHTML = 'Fecha de Nacimiento del Garante<span class="req">*</span>';
        document.querySelector('label[for="indemnitorCell"]').innerHTML = 'N√∫mero de Celular del Garante<span class="req">*</span>';
        document.querySelector('label[for="indemnitorEmail"]').innerHTML = 'Direcci√≥n de Correo Electr√≥nico del Garante';
        document.querySelector('label[for="indemnitorAddress"]').innerHTML = 'Direcci√≥n de Casa del Garante<span class="req">*</span>';
        document.querySelector('label[for="indemnitorHowLong"]').innerHTML = '¬øCu√°nto Tiempo Ha Vivido el Garante en la Direcci√≥n Actual<span class="req">*</span>';
        document.querySelector('label[for="indemnitorWorkType"]').innerHTML = 'Tipo de Trabajo del Garante<span class="req">*</span>';
        document.querySelector('label[for="indemnitorEmployer"]').innerHTML = 'Nombre del Empleador del Garante<span class="req">*</span>';
        document.querySelector('label[for="indemnitorWorkPhone"]').innerHTML = 'N√∫mero de Trabajo del Garante (NO ser√° llamado)';
        document.querySelector('label[for="indemnitorWorkAddress"]').innerHTML = 'Direcci√≥n de Trabajo del Garante';
        document.querySelector('label[for="indemnitorVehicle"]').innerHTML = 'Veh√≠culo del Garante<span class="req">*</span>';
        document.querySelector('label[for="indemnitorHomePhone"]').innerHTML = 'N√∫mero de Casa del Garante';
        document.querySelector('label[for="relation"]').innerHTML = 'Relaci√≥n del Garante con Usted?<span class="req">*</span>';

        // Update defendant section labels to refer to "Your" info
        document.querySelector('label[for="defendantName"]').innerHTML = 'Su Nombre Completo<span class="req">*</span>';
        document.querySelector('label[for="defendantNick"]').innerHTML = 'Su Apodo (Si no es el nombre real)';
        document.querySelector('label[for="defendantDob"]').innerHTML = 'Su Fecha de Nacimiento<span class="req">*</span>';
        document.querySelector('label[for="defendantSsn"]').innerHTML = 'Su N√∫mero de Seguro Social (opcional)';
        document.querySelector('label[for="defendantDl"]').innerHTML = 'Su N√∫mero de Licencia de Conducir o ID (opcional)';
        document.querySelector('label[for="defendantCell"]').innerHTML = 'Su N√∫mero de Celular<span class="req">*</span>';
        document.querySelector('label[for="defendantHomePhone"]').innerHTML = 'Su N√∫mero de Casa (Omitir si no tiene)';
        document.querySelector('label[for="defendantEmail"]').innerHTML = 'Su Direcci√≥n de Correo Electr√≥nico';
        document.querySelector('label[for="defendantAddress"]').innerHTML = 'Su Direcci√≥n de Casa<span class="req">*</span>';
        document.querySelector('label[for="defendantHowLong"]').innerHTML = '¬øCu√°nto Tiempo Ha Vivido en la Direcci√≥n Actual<span class="req">*</span>';
        document.querySelector('label[for="defendantWorkType"]').innerHTML = 'Su Tipo de Trabajo';
        document.querySelector('label[for="defendantEmployer"]').innerHTML = 'Su Nombre del Empleador';
        document.querySelector('label[for="defendantWorkPhone"]').innerHTML = 'Su N√∫mero de Trabajo (NO ser√° llamado)';
        document.querySelector('label[for="defendantWorkAddress"]').innerHTML = 'Su Direcci√≥n de Trabajo';
        document.querySelector('label[for="defendantVehicle"]').innerHTML = 'Su Veh√≠culo para ir al Tribunal<span class="req">*</span>';
        document.querySelector('label[for="recentArrest"]').innerHTML = 'Su Arresto M√°s Reciente (Sin incluir el Arresto Actual)';

        // Update checkbox section hint for defendants
        const checkboxHint = document.querySelector('.section[data-step="8"] .hint');
        if (checkboxHint) {
          checkboxHint.innerHTML = 'Estas preguntas son sobre usted';
        }

        // Update section info messages for defendants
        const indemnitorSectionInfo = document.querySelector('.section[data-step="1"] .section-info');
        if (indemnitorSectionInfo) {
          indemnitorSectionInfo.innerHTML = 'Por favor proporcione la siguiente informaci√≥n sobre su garante (la persona afianz√°ndole).';
        }

        const defendantSectionInfo = document.querySelector('.section[data-step="4"] .section-info');
        if (defendantSectionInfo) {
          defendantSectionInfo.innerHTML = 'Las siguientes preguntas son sobre usted (el acusado o persona que necesita una fianza).';
        }
      }
    }

    function validateStep(idx) {
      const step = sections[idx];

      // Special validation for upload step (step 0) - require front ID only
      if (idx === 0) {
        const errorDiv = document.getElementById('idUploadError');
        if (!storedIDFiles.front) {
          if (errorDiv) errorDiv.style.display = 'block';
          return false; // Front ID upload is required
        }
        if (errorDiv) errorDiv.style.display = 'none';
        return true;
      }

      // Special validation for intake step (step 1) - ensure role is selected and labels are updated
      if (idx === 1) {
        const whoAreYouSelect = document.getElementById('whoAreYou');
        if (!whoAreYouSelect.value) {
          whoAreYouSelect.reportValidity();
          return false;
        }

        // Ensure labels have been updated for the selected role
        if (whoAreYouSelect.value && !userRole) {
          updateLabelsForRole(whoAreYouSelect.value);
        }
      }

      const fields = step.querySelectorAll('input[required], select[required], textarea[required]');
      for (const el of fields) {
        if (!el.checkValidity()) {
          el.reportValidity();
          return false;
        }
      }
      return true;
    }

    // Setup navigation buttons
    sections.forEach((sec, idx) => {
      const nextBtn = sec.querySelector('[data-next]');
      if (nextBtn) {
        nextBtn.addEventListener('click', () => {
          if (!validateStep(idx)) return;
          const next = idx + 1;

          // Send ID data to IDUpload endpoint when we complete step 2 (have user info)
          if (idx === 2) {
            sendIDDataToUploadEndpoint();
          }

          if (next < sections.length) showStep(next);
        });
      }

      const backBtn = sec.querySelector('[data-back]');
      if (backBtn) {
        backBtn.addEventListener('click', () => {
          const prev = idx - 1;
          if (prev >= 0) showStep(prev);
        });
      }
    });

    // Add listener to "Who are you?" dropdown to update labels
    const whoAreYouSelect = document.getElementById('whoAreYou');
    whoAreYouSelect.addEventListener('change', function() {
      if (this.value) {
        updateLabelsForRole(this.value);
      }
    });

    // Start at first step
    showStep(0);

    // Phone formatting: (XXX) XXX-XXXX
    document.querySelectorAll('input[data-phone]').forEach(el => {
      el.addEventListener('blur', () => {
        const digits = (el.value || '').replace(/[^0-9]/g, '');
        if (digits.length === 10) {
          el.value = `(${digits.slice(0, 3)}) ${digits.slice(3, 6)}-${digits.slice(6)}`;
        }
      });
    });

    // Form submission
    const form = document.getElementById('f');
    const errorDiv = document.getElementById('err');
    const submitBtn = document.getElementById('submitBtn');
    const loadingIndicator = document.getElementById('loadingIndicator');

    form.addEventListener('submit', (e) => {
      e.preventDefault();

      // Ensure ID data is sent before final submission (fallback)
      sendIDDataToUploadEndpoint();

      // Validate final step
      if (!validateStep(sections.length - 2)) {
        if (errorDiv) errorDiv.style.display = 'block';
        return;
      }

      // Check form validity
      if (!form.checkValidity()) {
        form.reportValidity();
        return;
      }

      // Disable submit button and show loading
      submitBtn.disabled = true;
      loadingIndicator.style.display = 'block';

      // Collect form data
      const formData = new FormData(form);
      const data = Object.fromEntries(formData.entries());

      // Add timestamp
      data.timestamp = new Date().toISOString();

      // Submit to Google Apps Script
      fetch('https://script.google.com/macros/s/AKfycbx4_PFaUYqJs1y_e0Mn8LoKf_YqGFzUU996HODqni2_dTEoSZSVQwj6YrRLuDriekP4/exec', {
        method: 'POST',
        mode: 'no-cors',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(data)
      })
      .then(() => {
        submitBtn.disabled = false;
        loadingIndicator.style.display = 'none';
        showStep(23); // Show completion section
      })
      .catch((error) => {
        console.error('Submission error:', error);
        submitBtn.disabled = false;
        loadingIndicator.style.display = 'none';
        // Still show completion since no-cors doesn't return errors properly
        showStep(23);
      });
    });

    // ID upload functionality - stores files and sends to IDUpload endpoint when user info is available
    let storedIDFiles = {
      front: null,
      back: null
    };
    let idDataSent = false;

    function handleIDUpload(input, side) {
      const file = input.files[0];
      if (!file) return;

      // File size check (5MB limit for images)
      if (file.size > 5 * 1024 * 1024) {
        alert(`La imagen es demasiado grande. Tama√±o m√°ximo es 5MB.`);
        input.value = '';
        return;
      }

      // File type check
      const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png'];
      if (!allowedTypes.includes(file.type)) {
        alert(`Por favor use solo formato JPG o PNG.`);
        input.value = '';
        return;
      }

      // Store the file
      storedIDFiles[side] = file;

      // Update preview
      const previewElement = document.getElementById(side + 'Preview');
      previewElement.innerHTML = `
        <div style="font-size:12px; color:#28a745; font-weight:600;">‚úì ${file.name} almacenado</div>
        <div style="font-size:11px; color:#666;">${(file.size / 1024).toFixed(1)} KB</div>
      `;

      // Update continue button
      updateUploadButton();
    }

    function updateUploadButton() {
      const uploadBtn = document.getElementById('uploadNextBtn');
      const errorDiv = document.getElementById('idUploadError');
      const hasFiles = storedIDFiles.front || storedIDFiles.back;

      if (storedIDFiles.front) {
        uploadBtn.textContent = 'Continuar (ID Subida)';
        uploadBtn.style.background = '#28a745';
        uploadBtn.disabled = false;
        if (errorDiv) errorDiv.style.display = 'none';
      } else {
        uploadBtn.textContent = 'Se Requiere Subir ID';
        uploadBtn.style.background = '#666';
        uploadBtn.disabled = true;
      }
    }

    // Send ID data to IDUpload endpoint when we have user info
    async function sendIDDataToUploadEndpoint() {
      if (idDataSent || (!storedIDFiles.front && !storedIDFiles.back)) {
        return; // Already sent or no files to send
      }

      try {
        // Get user info from form
        const yourName = document.getElementById('indemnitorName')?.value ||
                         document.getElementById('defendantName')?.value || '';
        const yourPhone = document.getElementById('indemnitorCell')?.value ||
                          document.getElementById('defendantCell')?.value || '';
        const defendantName = document.getElementById('defendantName')?.value || '';

        if (!yourName || !yourPhone) {
          console.log('User info not yet available, will try again later');
          return;
        }

        // Create FormData for IDUpload endpoint
        const formData = new FormData();
        formData.append('yourName', yourName);
        formData.append('yourPhone', yourPhone);
        formData.append('defendantName', defendantName);
        formData.append('caseNumber', ''); // Not collected in bail bond app
        formData.append('timestamp', new Date().toISOString());

        // Add files if available
        if (storedIDFiles.front) {
          formData.append('files', storedIDFiles.front, 'id-front.jpg');
        }
        if (storedIDFiles.back) {
          formData.append('files', storedIDFiles.back, 'id-back.jpg');
        }

        // Send to IDUpload endpoint
        const response = await fetch('https://script.google.com/macros/s/AKfycbztNOgs3JN4ksI0xX66UOh0VeS_Sg31dUJKpM2OLd3BwEh-iJIElwX2XXUOBiSJTiBC/exec', {
          method: 'POST',
          mode: 'no-cors',
          body: formData
        });

        idDataSent = true;
        console.log('ID data sent successfully to IDUpload endpoint');

        // Update previews to show sent status
        if (storedIDFiles.front) {
          document.getElementById('frontPreview').innerHTML = `
            <div style="font-size:12px; color:#007bff; font-weight:600;">‚úì Enviado al sistema de ID</div>
          `;
        }
        if (storedIDFiles.back) {
          document.getElementById('backPreview').innerHTML = `
            <div style="font-size:12px; color:#007bff; font-weight:600;">‚úì Enviado al sistema de ID</div>
          `;
        }

      } catch (error) {
        console.error('Failed to send ID data:', error);
      }
    }

  </script>

<!-- Chatbot Widget -->
<div class="chat-container">
  <button class="chat-button" id="chatButton">
    <span class="chat-icon">üí¨</span>
  </button>

  <div class="chat-interface" id="chatInterface">
    <div class="chat-header">
      <div class="chat-title-area">
        <div class="chat-title">Asistente AI</div>
        <div class="chat-subtitle">Pregunte sobre fianzas</div>
      </div>
      <button class="chat-close" id="chatClose">√ó</button>
    </div>

    <div class="chat-messages" id="chatMessages">
      <div class="welcome-message">
        üëã ¬°Hola! Soy su asistente AI para <strong>Barbie's Bail Bonds</strong>.<br><br>
        Preg√∫nteme sobre:<br>
        ‚Ä¢ Costos y procesos de fianza<br>
        ‚Ä¢ Requisitos del tribunal<br>
        ‚Ä¢ Opciones de pago<br>
        ‚Ä¢ Procedimientos de liberaci√≥n
      </div>
    </div>

    <div class="typing-indicator" id="typingIndicator">
      ü§ñ Asistente est√° escribiendo
      <div class="typing-dots">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>

    <div class="chat-input-container">
      <input
        type="text"
        class="chat-input"
        id="chatInput"
        placeholder="Escriba su mensaje..."
        maxlength="500"
      >
      <button class="chat-send" id="chatSend">‚ñ∂</button>
    </div>
  </div>
</div>

<script>
(function() {
  const chatButton = document.getElementById('chatButton');
  const chatInterface = document.getElementById('chatInterface');
  const chatClose = document.getElementById('chatClose');
  const chatMessages = document.getElementById('chatMessages');
  const chatInput = document.getElementById('chatInput');
  const chatSend = document.getElementById('chatSend');
  const typingIndicator = document.getElementById('typingIndicator');
  const API_URL = 'https://script.google.com/macros/s/AKfycbwvJ8utZ62xKjZt2nz8wZnBJb5vbOsCD38RJnDZ0yFZGppsfWnmv7_YIuz5yV9lZz7z/exec';
  let isOpen = false;
  let conversationHistory = [];
  const MAX_HISTORY = 10;
  function toggleChat() {
    isOpen = !isOpen;
    if (isOpen) {
      chatInterface.style.display = 'flex';
      setTimeout(() => { chatInterface.classList.add('open'); }, 10);
      chatButton.classList.add('active');
      chatButton.innerHTML = '<span style="transform: rotate(45deg); display: inline-block;">‚úï</span>';
      setTimeout(() => chatInput.focus(), 300);
    } else {
      chatInterface.classList.remove('open');
      chatButton.classList.remove('active');
      chatButton.innerHTML = '<span class="chat-icon">üí¨</span>';
      setTimeout(() => { if (!isOpen) chatInterface.style.display = 'none'; }, 300);
    }
  }
  chatButton.addEventListener('click', toggleChat);
  chatClose.addEventListener('click', toggleChat);
  function sendMessage() {
    const message = chatInput.value.trim();
    if (!message || chatSend.disabled) return;
    addMessage('user', message);
    chatInput.value = '';
    chatSend.disabled = true;
    showTyping();
    const callbackName = 'chatCallback_' + Date.now();
    const script = document.createElement('script');
    script.src = `${API_URL}?action=chat&query=${encodeURIComponent(message)}&history=${encodeURIComponent(JSON.stringify(conversationHistory))}&format=jsonp&callback=${callbackName}`;
    window[callbackName] = function(response) {
      hideTyping();
      let assistantResponse = '';
      if (response && response.answer) {
        assistantResponse = response.answer;
        addMessage('assistant', assistantResponse);
      } else if (response && response.error) {
        assistantResponse = 'Me disculpo, pero encontr√© un error. Por favor intente de nuevo o ll√°menos al 561-247-0018 para asistencia inmediata.';
        addMessage('assistant', assistantResponse);
        console.error('Chat API error:', response.error);
      } else {
        assistantResponse = 'Me disculpo, pero no pude generar una respuesta. Por favor intente de nuevo o ll√°menos al 561-247-0018 para ayuda.';
        addMessage('assistant', assistantResponse);
      }
      conversationHistory.push({user: message, assistant: assistantResponse});
      if (conversationHistory.length > MAX_HISTORY) {
        conversationHistory = conversationHistory.slice(-MAX_HISTORY);
      }
      document.head.removeChild(script);
      delete window[callbackName];
    };
    script.onerror = function() {
      hideTyping();
      const errorResponse = 'Estoy teniendo problemas conectando ahora. Por favor intente de nuevo o ll√°menos directamente al 561-247-0018 para asistencia.';
      addMessage('assistant', errorResponse);
      conversationHistory.push({user: message, assistant: errorResponse});
      if (conversationHistory.length > MAX_HISTORY) {
        conversationHistory = conversationHistory.slice(-MAX_HISTORY);
      }
      document.head.removeChild(script);
      delete window[callbackName];
    };
    setTimeout(() => {
      if (window[callbackName]) {
        hideTyping();
        const timeoutResponse = 'Se agot√≥ el tiempo de respuesta. Por favor ll√°menos al 561-247-0018 para asistencia inmediata.';
        addMessage('assistant', timeoutResponse);
        conversationHistory.push({user: message, assistant: timeoutResponse});
        if (conversationHistory.length > MAX_HISTORY) {
          conversationHistory = conversationHistory.slice(-MAX_HISTORY);
        }
        document.head.removeChild(script);
        delete window[callbackName];
      }
    }, 15000);
    document.head.appendChild(script);
  }
  function addMessage(sender, content) {
    const welcomeMsg = chatMessages.querySelector('.welcome-message');
    if (welcomeMsg) welcomeMsg.remove();
    const messageDiv = document.createElement('div');
    messageDiv.className = `message ${sender}`;
    const avatar = document.createElement('div');
    avatar.className = 'message-avatar';
    avatar.textContent = sender === 'user' ? 'üë§' : 'ü§ñ';
    const bubble = document.createElement('div');
    bubble.className = 'message-bubble';
    const paragraphs = content.split('\n').filter(p => p.trim());
    if (paragraphs.length > 1) {
      bubble.innerHTML = paragraphs.map(p => p.trim()).join('<br>');
    } else {
      bubble.textContent = content;
    }
    messageDiv.appendChild(avatar);
    messageDiv.appendChild(bubble);
    chatMessages.appendChild(messageDiv);
    chatMessages.scrollTop = chatMessages.scrollHeight;
  }
  function showTyping() {
    typingIndicator.style.display = 'block';
    chatMessages.scrollTop = chatMessages.scrollHeight;
  }
  function hideTyping() {
    typingIndicator.style.display = 'none';
    chatSend.disabled = false;
  }
  chatSend.addEventListener('click', sendMessage);
  chatInput.addEventListener('keypress', function(e) {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      sendMessage();
    }
  });
  document.addEventListener('click', function(e) {
    if (isOpen && !chatInterface.contains(e.target) && !chatButton.contains(e.target)) {
      // Uncomment the next line if you want to close chat when clicking outside
      // toggleChat();
    }
  });
})();
</script>

<div class="invisible-spacer"></div>

</body>
</html>